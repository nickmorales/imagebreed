
use strict;
use warnings;

#use lib 't/lib';
#use SGN::Test::Fixture;
use Test::More;
use Test::WWW::Mechanize;

#Needed to update IO::Socket::SSL
use Data::Dumper;
use JSON;
local $Data::Dumper::Indent = 0;

my $mech = Test::WWW::Mechanize->new;
my $response; my $searchId;

$mech->post_ok('http://localhost:3010/brapi/v1/token', [ "username"=> "janedoe", "password"=> "secretpw", "grant_type"=> "password" ]);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[0]->{'message'}, 'Login Successfull');
is($response->{'userDisplayName'}, 'Jane Doe');
is($response->{'expires_in'}, '7200');

$mech->delete_ok('http://localhost:3010/brapi/v1/token');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[0]->{'message'}, 'User Logged Out');

$mech->post_ok('http://localhost:3010/brapi/v1/token', [ "username"=> "janedoe", "password"=> "secretpw", "grant_type"=> "password" ]);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[0]->{'message'}, 'Login Successfull');
is($response->{'userDisplayName'}, 'Jane Doe');
is($response->{'expires_in'}, '7200');
my $access_token = $response->{access_token};

$mech->default_header("Content-Type" => "application/json");
$mech->default_header('Authorization'=> 'Bearer ' . $access_token);

$mech->get_ok('http://localhost:3010/brapi/v1/calls');
$response = decode_json $mech->content;
print STDERR Dumper $response;

is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Calls'},{'message' => 'Calls result constructed','messageType' => 'INFO'}],'pagination' => {'pageSize' => 1000,'totalPages' => 1,'totalCount' => 90,'currentPage' => 0}},'result' => {'data' => [{'call' => 'token','methods' => ['POST','DELETE'],'datatypes' => ['json'],'versions' => ['1.0','1.2','1.3']},{'versions' => ['1.0','1.2','1.3'],'datatypes' => ['json'],'methods' => ['GET'],'call' => 'calls'},{'versions' => ['1.0','1.2','1.3'],'datatypes' => ['json'],'methods' => ['GET'],'call' => 'observationlevels'},{'versions' => ['1.0','1.2'],'datatypes' => ['json'],'call' => 'germplasm-search','methods' => ['GET','POST']},{'call' => 'search/germplasm','methods' => ['GET','POST'],'datatypes' => ['json'],'versions' => ['1.3']},{'versions' => ['1.3'],'methods' => ['GET'],'call' => 'germplasm','datatypes' => ['json']},{'versions' => ['1.0','1.2','1.3'],'methods' => ['GET'],'call' => 'germplasm/{germplasmDbId}','datatypes' => ['json']},{'versions' => ['1.0','1.2','1.3'],'datatypes' => ['json'],'call' => 'germplasm/{germplasmDbId}/pedigree','methods' => ['GET']},{'datatypes' => ['json'],'methods' => ['GET'],'call' => 'germplasm/{germplasmDbId}/progeny','versions' => ['1.0','1.2','1.3']},{'datatypes' => ['json'],'methods' => ['GET'],'call' => 'germplasm/{germplasmDbId}/markerprofiles','versions' => ['1.0','1.2','1.3']},{'datatypes' => ['json'],'methods' => ['GET'],'call' => 'germplasm/{germplasmDbId}/attributes','versions' => ['1.0','1.2']},{'versions' => ['1.0','1.2','1.3'],'datatypes' => ['json'],'methods' => ['GET'],'call' => 'attributes'},{'call' => 'attributes/categories','methods' => ['GET'],'datatypes' => ['json'],'versions' => ['1.0','1.2','1.3']},{'datatypes' => ['json'],'methods' => ['GET'],'call' => 'markerprofiles','versions' => ['1.0','1.2','1.3']},{'versions' => ['1.0','1.2','1.3'],'datatypes' => ['json'],'call' => 'markerprofiles/{markerprofileDbId}','methods' => ['GET']},{'datatypes' => ['json'],'call' => 'markerprofiles/methods','methods' => ['GET'],'versions' => ['1.0','1.2','1.3']},{'versions' => ['1.0','1.2'],'datatypes' => ['json','tsv','csv','xls'],'methods' => ['GET','POST'],'call' => 'allelematrix-search'},{'versions' => ['1.0','1.2'],'datatypes' => ['json','tsv','csv','xls'],'methods' => ['GET','POST'],'call' => 'allelematrices-search'},{'datatypes' => ['json'],'call' => 'search/allelematrices','methods' => ['GET','POST'],'versions' => ['1.3']},{'call' => 'allelematrices','methods' => ['GET'],'datatypes' => ['json'],'versions' => ['1.3']},{'call' => 'programs','methods' => ['GET','POST'],'datatypes' => ['json'],'versions' => ['1.0','1.2','1.3']},{'datatypes' => ['json'],'call' => 'crops','methods' => ['GET'],'versions' => ['1.0','1.2','1.3']},{'methods' => ['GET','POST'],'call' => 'seasons','datatypes' => ['json'],'versions' => ['1.0','1.2','1.3']},{'methods' => ['GET','POST'],'call' => 'studytypes','datatypes' => ['json'],'versions' => ['1.0','1.2','1.3']},{'datatypes' => ['json'],'call' => 'trials','methods' => ['GET','POST'],'versions' => ['1.0','1.2','1.3']},{'versions' => ['1.0','1.2','1.3'],'call' => 'trials/{trialDbId}','methods' => ['GET'],'datatypes' => ['json']},{'datatypes' => ['json'],'methods' => ['GET','POST'],'call' => 'studies-search','versions' => ['1.0','1.2']},{'versions' => ['1.3'],'methods' => ['GET','POST'],'call' => 'search/studies','datatypes' => ['json']},{'methods' => ['GET'],'call' => 'studies','datatypes' => ['json'],'versions' => ['1.3']},{'versions' => ['1.0','1.2','1.3'],'call' => 'studies/{studyDbId}','methods' => ['GET'],'datatypes' => ['json']},{'call' => 'studies/{studyDbId}/germplasm','methods' => ['GET'],'datatypes' => ['json'],'versions' => ['1.0','1.2','1.3']},{'versions' => ['1.0','1.2','1.3'],'methods' => ['GET'],'call' => 'studies/{studyDbId}/observationvariables','datatypes' => ['json']},{'versions' => ['1.0','1.2','1.3'],'call' => 'studies/{studyDbId}/observationunits','methods' => ['GET'],'datatypes' => ['json']},{'datatypes' => ['json','csv','xls','tsv'],'methods' => ['GET'],'call' => 'studies/{studyDbId}/table','versions' => ['1.0','1.2','1.3']},{'versions' => ['1.0','1.2'],'datatypes' => ['json'],'call' => 'studies/{studyDbId}/layout','methods' => ['GET']},{'methods' => ['GET'],'call' => 'studies/{studyDbId}/layouts','datatypes' => ['json'],'versions' => ['1.3']},{'datatypes' => ['json'],'call' => 'studies/{studyDbId}/observations','methods' => ['GET'],'versions' => ['1.0','1.2','1.3']},{'versions' => ['1.0','1.2'],'call' => 'phenotypes-search','methods' => ['GET','POST'],'datatypes' => ['json']},{'call' => 'search/phenotypes','methods' => ['GET','POST'],'datatypes' => ['json'],'versions' => ['1.3']},{'versions' => ['1.3'],'datatypes' => ['json'],'methods' => ['GET','POST'],'call' => 'phenotypes'},{'datatypes' => ['json'],'call' => 'phenotypes-search/table','methods' => ['GET','POST'],'versions' => ['1.0','1.2']},{'methods' => ['GET','POST'],'call' => 'phenotypes-search/tsv','datatypes' => ['json'],'versions' => ['1.0','1.2']},{'versions' => ['1.0','1.2'],'datatypes' => ['json'],'methods' => ['GET','POST'],'call' => 'phenotypes-search/csv'},{'call' => 'observationunits','methods' => ['GET'],'datatypes' => ['json'],'versions' => ['1.3']},{'datatypes' => ['json'],'methods' => ['GET','POST'],'call' => 'search/observationunits','versions' => ['1.3']},{'versions' => ['1.3'],'datatypes' => ['json'],'methods' => ['GET'],'call' => 'observationtables'},{'versions' => ['1.3'],'datatypes' => ['json'],'call' => 'search/observationtables','methods' => ['GET','POST']},{'methods' => ['GET'],'call' => 'traits','datatypes' => ['json'],'versions' => ['1.0','1.2','1.3']},{'datatypes' => ['json'],'call' => 'traits','methods' => ['POST'],'versions' => ['1.3']},{'versions' => ['1.0','1.2'],'datatypes' => ['json'],'call' => 'traits/{traitDbId}','methods' => ['GET']},{'datatypes' => ['json'],'call' => 'traits/{traitDbId}','methods' => ['PUT'],'versions' => ['1.3']},{'call' => 'maps','methods' => ['GET'],'datatypes' => ['json'],'versions' => ['1.0','1.2','1.3']},{'versions' => ['1.0','1.2','1.3'],'call' => 'maps/{mapDbId}','methods' => ['GET'],'datatypes' => ['json']},{'datatypes' => ['json'],'methods' => ['GET'],'call' => 'maps/{mapDbId}/positions','versions' => ['1.0','1.2','1.3']},{'datatypes' => ['json'],'call' => 'maps/{mapDbId}/positions/id','methods' => ['GET'],'versions' => ['1.0','1.2','1.3']},{'datatypes' => ['json'],'call' => 'locations','methods' => ['GET'],'versions' => ['1.0','1.2','1.3']},{'datatypes' => ['json'],'methods' => ['GET'],'call' => 'variables/datatypes','versions' => ['1.0','1.2','1.3']},{'methods' => ['GET'],'call' => 'ontologies','datatypes' => ['json'],'versions' => ['1.0','1.2','1.3']},{'versions' => ['1.0','1.2','1.3'],'call' => 'variables','methods' => ['GET'],'datatypes' => ['json']},{'versions' => ['1.0','1.2','1.3'],'datatypes' => ['json'],'methods' => ['GET'],'call' => 'variables/{observationVariableDbId}'},{'datatypes' => ['json'],'call' => 'variables-search','methods' => ['GET','POST'],'versions' => ['1.0','1.2']},{'datatypes' => ['json'],'methods' => ['GET','POST'],'call' => 'samples-search','versions' => ['1.0','1.2']},{'datatypes' => ['json'],'call' => 'search/samples','methods' => ['GET','POST'],'versions' => ['1.3']},{'versions' => ['1.3'],'datatypes' => ['json'],'call' => 'samples','methods' => ['GET']},{'versions' => ['1.0','1.2','1.3'],'methods' => ['GET'],'call' => 'samples/{sampleDbId}','datatypes' => ['json']},{'datatypes' => ['json'],'call' => 'images','methods' => ['GET','POST'],'versions' => ['1.3']},{'versions' => ['1.3'],'datatypes' => ['json'],'methods' => ['GET','PUT'],'call' => 'images/{imageDbId}'},{'versions' => ['1.3'],'datatypes' => ['json'],'methods' => ['PUT'],'call' => 'images/{imageDbId}/imagecontent'},{'versions' => ['1.3'],'datatypes' => ['json'],'methods' => ['GET','POST'],'call' => 'lists'},{'versions' => ['1.3'],'datatypes' => ['json'],'call' => 'lists/{listDbId}','methods' => ['GET','PUT']},{'call' => 'lists/{listDbId}/items','methods' => ['POST'],'datatypes' => ['json'],'versions' => ['1.3']},{'methods' => ['GET'],'call' => 'markers','datatypes' => ['json'],'versions' => ['1.0','1.3']},{'methods' => ['GET'],'call' => 'markers/{markerDbId}','datatypes' => ['json'],'versions' => ['1.0','1.1','1.2','1.3']},{'methods' => ['GET','POST'],'call' => 'methods','datatypes' => ['json'],'versions' => ['1.3']},{'call' => 'methods/{methodDbId}','methods' => ['GET','PUT'],'datatypes' => ['json'],'versions' => ['1.3']},{'datatypes' => ['json'],'call' => 'people','methods' => ['GET','POST'],'versions' => ['1.3']},{'datatypes' => ['json'],'call' => 'people/{personDbId}','methods' => ['GET','PUT'],'versions' => ['1.3']},{'versions' => ['1.3'],'call' => 'scales','methods' => ['GET','POST'],'datatypes' => ['json']},{'versions' => ['1.3'],'methods' => ['GET','PUT'],'call' => 'scales/{scaleDbId}','datatypes' => ['json']},{'versions' => ['1.3'],'datatypes' => ['json'],'methods' => ['GET'],'call' => 'search/germplasm/{searchResultsDbId}'},{'datatypes' => ['json'],'call' => 'search/images','methods' => ['POST'],'versions' => ['1.3']},{'datatypes' => ['json'],'call' => 'search/images/{searchResultsDbId}','methods' => ['GET'],'versions' => ['1.3']},{'call' => 'search/markers','methods' => ['POST'],'datatypes' => ['json'],'versions' => ['1.3']},{'datatypes' => ['json'],'methods' => ['GET'],'call' => 'search/markers/{searchResultsDbId}','versions' => ['1.3']},{'call' => 'search/observationtables/{searchResultsDbId}','methods' => ['GET'],'datatypes' => ['json'],'versions' => ['1.3']},{'methods' => ['GET'],'call' => 'search/observationunits/searchResultsDbId','datatypes' => ['json'],'versions' => ['1.3']},{'versions' => ['1.3'],'call' => 'search/programs','methods' => ['POST'],'datatypes' => ['json']},{'methods' => ['GET'],'call' => 'search/programs/{searchResultsDbId}','datatypes' => ['json'],'versions' => ['1.3']},{'datatypes' => ['json'],'call' => 'search/samples/{searchResultsDbId}','methods' => ['GET'],'versions' => ['1.3']},{'versions' => ['1.3'],'datatypes' => ['json'],'methods' => ['GET'],'call' => 'search/studies/{searchResultsDbId}'}]}}, 'check calls response content');

$mech->get_ok('http://localhost:3010/brapi/v1/calls?pageSize=50&datatype=tsv');
$response = decode_json $mech->content;
print STDERR Dumper $response;

is_deeply($response, {'metadata' => {'pagination' => {'totalCount' => 3,'pageSize' => 1000,'totalPages' => 1,'currentPage' => 0},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=50','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::Calls','messageType' => 'INFO'},{'message' => 'Calls result constructed','messageType' => 'INFO'}]},'result' => {'data' => [{'methods' => ['GET','POST'],'call' => 'allelematrix-search','versions' => ['1.0','1.2'],'datatypes' => ['json','tsv','csv','xls']},{'call' => 'allelematrices-search','methods' => ['GET','POST'],'datatypes' => ['json','tsv','csv','xls'],'versions' => ['1.0','1.2']},{'methods' => ['GET'],'call' => 'studies/{studyDbId}/table','versions' => ['1.0','1.2','1.3'],'datatypes' => ['json','csv','xls','tsv']}]}}, 'check calls response content');


$mech->get_ok('http://localhost:3010/brapi/v1/observationlevels');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::ObservationVariables','messageType' => 'INFO'},{'message' => 'Observation Levels result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'pageSize' => 10,'totalCount' => 4,'currentPage' => 0}},'result' => {'data' => ['plant','plot','tissue_sample','all']}}, 'observationlevels');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=3&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','germplasmGenus' => 'Lycopersicon','breedingMethodDbId' =>''||undef,'germplasmPUI' => '','subtaxa' => undef,'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP002','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','species' => 'Solanum lycopersicum','defaultDisplayName' => 'new_test_crossP002','germplasmDbId' => 38847,'speciesAuthority' => undef,'synonyms' => [],'commonCropName' => 'tomato','donors' => [],'instituteCode' => '','genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','subtaxaAuthority' => undef,'biologicalStatusOfAccessionCode' => '0','accessionNumber' => '','documentationURL' =>undef,'seedSource' => '','germplasmSpecies' => 'Solanum lycopersicum'},{'typeOfGermplasmStorageCode' => [],'germplasmName' => 'new_test_crossP003','germplasmSeedSource' => '','subtaxa' => undef,'countryOfOriginCode' => '','germplasmGenus' => 'Lycopersicon','breedingMethodDbId' =>''||undef,'germplasmPUI' => '','pedigree' => 'test_accession4/test_accession5','speciesAuthority' => undef,'defaultDisplayName' => 'new_test_crossP003','germplasmDbId' => 38848,'species' => 'Solanum lycopersicum','acquisitionDate' => '','donors' => [],'instituteCode' => '','synonyms' => [],'commonCropName' => 'tomato','accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','subtaxaAuthority' => undef,'instituteName' => '','taxonIds' => [],'genus' => 'Lycopersicon','documentationURL' =>undef,'seedSource' => '','germplasmSpecies' => 'Solanum lycopersicum'}]},'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 240,'pageSize' => 2,'totalCount' => 479,'currentPage' => 3},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=3, pageSize=2'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'messageType' => 'INFO','message' => 'Germplasm-search result constructed'}]}}, 'germplasm-search');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=5&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'pedigree' => 'test_accession4/test_accession5','countryOfOriginCode' => '','germplasmPUI' => '','subtaxa' => undef,'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP006','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','species' => 'Solanum lycopersicum','defaultDisplayName' => 'new_test_crossP006','germplasmDbId' => 38851,'speciesAuthority' => undef,'synonyms' => [],'commonCropName' => 'tomato','instituteCode' => '','donors' => [],'genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','subtaxaAuthority' => undef,'biologicalStatusOfAccessionCode' => '0','accessionNumber' => '','germplasmSpecies' => 'Solanum lycopersicum','breedingMethodDbId' =>undef,'documentationURL' =>undef,'seedSource' => '','germplasmGenus' => 'Lycopersicon'},{'subtaxa' => undef,'countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','germplasmPUI' => '','typeOfGermplasmStorageCode' => [],'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP007','species' => 'Solanum lycopersicum','germplasmDbId' => 38852,'defaultDisplayName' => 'new_test_crossP007','acquisitionDate' => '','speciesAuthority' => undef,'donors' => [],'instituteCode' => '','commonCropName' => 'tomato','synonyms' => [],'subtaxaAuthority' => undef,'genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','germplasmSpecies' => 'Solanum lycopersicum','breedingMethodDbId' =>undef,'documentationURL' =>undef,'seedSource' => '','germplasmGenus' => 'Lycopersicon'}]},'metadata' => {'pagination' => {'currentPage' => 5,'totalCount' => 479,'pageSize' => 2,'totalPages' => 240},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=5, pageSize=2'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'messageType' => 'INFO','message' => 'Germplasm-search result constructed'}]}}, 'germplasm-search');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=0&germplasmDbId=38849&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'subtaxa' => undef,'germplasmPUI' => '','pedigree' => 'test_accession4/test_accession5','countryOfOriginCode' => '','typeOfGermplasmStorageCode' => [],'germplasmName' => 'new_test_crossP004','germplasmSeedSource' => '','germplasmDbId' => 38849,'defaultDisplayName' => 'new_test_crossP004','species' => 'Solanum lycopersicum','acquisitionDate' => '','speciesAuthority' => undef,'donors' => [],'instituteCode' => '','commonCropName' => 'tomato','synonyms' => [],'subtaxaAuthority' => undef,'instituteName' => '','taxonIds' => [],'genus' => 'Lycopersicon','accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','breedingMethodDbId' =>undef,'documentationURL' =>undef,'seedSource' => '','germplasmGenus' => 'Lycopersicon','germplasmSpecies' => 'Solanum lycopersicum'}]},'metadata' => {'pagination' => {'totalPages' => 1,'pageSize' => 2,'currentPage' => 0,'totalCount' => 1},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=2','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'messageType' => 'INFO','message' => 'Germplasm-search result constructed'}]}}, 'germplasm-search');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm-search?pageSize=2&page=4&germplasmName=te%&matchMethod=wildcard&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'currentPage' => 4,'totalCount' => 25,'pageSize' => 2,'totalPages' => 13},'status' => [{'message' => 'BrAPI base call found with page=4, pageSize=2','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'message' => 'Germplasm-search result constructed','messageType' => 'INFO'}]},'result' => {'data' => [{'donors' => [],'instituteCode' => '','commonCropName' => 'tomato','synonyms' => [],'accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','subtaxaAuthority' => undef,'genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','typeOfGermplasmStorageCode' => [],'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP009','subtaxa' => undef,'germplasmPUI' => '','countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','speciesAuthority' => undef,'species' => 'Solanum lycopersicum','germplasmDbId' => 38854,'defaultDisplayName' => 'new_test_crossP009','acquisitionDate' => '','breedingMethodDbId' =>undef,'documentationURL' =>undef,'seedSource' => '','germplasmGenus' => 'Lycopersicon','germplasmSpecies' => 'Solanum lycopersicum'},{'accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','subtaxaAuthority' => undef,'genus' => 'Lycopersicon','taxonIds' => [],'instituteName' => '','instituteCode' => '','donors' => [],'commonCropName' => 'tomato','synonyms' => [],'speciesAuthority' => undef,'defaultDisplayName' => 'new_test_crossP010','germplasmDbId' => 38855,'species' => 'Solanum lycopersicum','acquisitionDate' => '','typeOfGermplasmStorageCode' => [],'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP010','subtaxa' => undef,'pedigree' => 'test_accession4/test_accession5','germplasmPUI' => '','countryOfOriginCode' => '','breedingMethodDbId' =>undef,'documentationURL' =>undef,'seedSource' => '','germplasmGenus' => 'Lycopersicon','germplasmSpecies' => 'Solanum lycopersicum'}]}}, 'germplasm-search');

$mech->post_ok('http://localhost:3010/brapi/v1/germplasm-search', ['access_token'=>$access_token, 'pageSize'=>'1', 'page'=>'5', 'germplasmNames'=>['t%'], 'matchMethod'=>'wildcard'] );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=5, pageSize=1','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'message' => 'Germplasm-search result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'totalCount' => 31,'currentPage' => 5,'pageSize' => 1,'totalPages' => 31}},'result' => {'data' => [{'commonCropName' => 'tomato','synonyms' => [],'donors' => [],'instituteCode' => '','genus' => 'Lycopersicon','instituteName' => '','taxonIds' => [],'subtaxaAuthority' => undef,'biologicalStatusOfAccessionCode' => '0','accessionNumber' => '','countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','germplasmPUI' => '','subtaxa' => undef,'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP002','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','species' => 'Solanum lycopersicum','defaultDisplayName' => 'new_test_crossP002','germplasmDbId' => 38847,'speciesAuthority' => undef,'breedingMethodDbId' =>undef,'documentationURL' =>undef,'seedSource' => '','germplasmGenus' => 'Lycopersicon','germplasmSpecies' => 'Solanum lycopersicum'}]}}, 'germplasm-search post');

$mech->post_ok('http://localhost:3010/brapi/v1/search/germplasm', ['access_token'=>$access_token, 'pageSize'=>'1', 'page'=>'5', 'germplasmNames'=>['t%'], 'matchMethod'=>'wildcard'] );
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultsDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v1/search/germplasm/'. $searchId . '?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=5, pageSize=1','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'message' => 'Germplasm-search result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'totalCount' => 31,'currentPage' => 5,'pageSize' => 1,'totalPages' => 31}},'result' => {'data' => [{'commonCropName' => 'tomato','synonyms' => [],'donors' => [],'instituteCode' => '','genus' => 'Lycopersicon','instituteName' => '','taxonIds' => [],'subtaxaAuthority' => undef,'biologicalStatusOfAccessionCode' => '0','accessionNumber' => '','countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','germplasmPUI' => '','subtaxa' => undef,'germplasmSeedSource' => '','germplasmName' => 'new_test_crossP002','typeOfGermplasmStorageCode' => [],'acquisitionDate' => '','species' => 'Solanum lycopersicum','defaultDisplayName' => 'new_test_crossP002','germplasmDbId' => 38847,'speciesAuthority' => undef,'breedingMethodDbId' =>undef,'documentationURL' =>undef,'seedSource' => '','germplasmGenus' => 'Lycopersicon','germplasmSpecies' => 'Solanum lycopersicum'}]}}, 'germplasm-search post');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38876?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 1,'pageSize' => 1,'totalCount' => 1,'currentPage' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::Germplasm','messageType' => 'INFO'},{'message' => 'Germplasm detail result constructed','messageType' => 'INFO'}]},'result' => {'instituteCode' => '','donors' => [],'commonCropName' => 'tomato','synonyms' => [],'accessionNumber' => '','biologicalStatusOfAccessionCode' => '0','subtaxaAuthority' => undef,'instituteName' => '','taxonIds' => [],'genus' => 'Lycopersicon','typeOfGermplasmStorageCode' => [],'germplasmName' => 'test5P004','germplasmSeedSource' => '','subtaxa' => undef,'germplasmPUI' => '','countryOfOriginCode' => '','pedigree' => 'test_accession4/test_accession5','speciesAuthority' => undef,'defaultDisplayName' => 'test5P004','species' => 'Solanum lycopersicum','germplasmDbId' => 38876,'acquisitionDate' => ''}}, 'germplasm detail');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38876/pedigree?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Germplasm'},{'messageType' => 'INFO','message' => 'Germplasm pedigree result constructed'}],'pagination' => {'pageSize' => 1,'totalPages' => 1,'currentPage' => 0,'totalCount' => 1}},'result' => {'familyCode' => undef,'pedigree' => 'test_accession4/test_accession5','parent2Id' => 38844,'parent1Id' => 38843,'crossingPlan' => undef,'parent1Type' => 'FEMALE','parent2Type' => 'MALE','parent2Name' => 'test_accession5','germplasmDbId' => '38876','parent2DbId' => 38844,'parent1DbId' => 38843,'crossingYear' => undef,'defaultDisplayName' => 'test5P004','parent1Name' => 'test_accession4','siblings' => [{'defaultDisplayName' => 'new_test_crossP001','germplasmDbId' => '38846'},{'germplasmDbId' => '38847','defaultDisplayName' => 'new_test_crossP002'},{'defaultDisplayName' => 'new_test_crossP003','germplasmDbId' => '38848'},{'defaultDisplayName' => 'new_test_crossP004','germplasmDbId' => '38849'},{'germplasmDbId' => '38850','defaultDisplayName' => 'new_test_crossP005'},{'germplasmDbId' => '38851','defaultDisplayName' => 'new_test_crossP006'},{'germplasmDbId' => '38852','defaultDisplayName' => 'new_test_crossP007'},{'defaultDisplayName' => 'new_test_crossP008','germplasmDbId' => '38853'},{'germplasmDbId' => '38854','defaultDisplayName' => 'new_test_crossP009'},{'defaultDisplayName' => 'new_test_crossP010','germplasmDbId' => '38855'},{'defaultDisplayName' => 'test5P001','germplasmDbId' => '38873'},{'defaultDisplayName' => 'test5P002','germplasmDbId' => '38874'},{'germplasmDbId' => '38875','defaultDisplayName' => 'test5P003'},{'defaultDisplayName' => 'test5P005','germplasmDbId' => '38877'}]}}, 'germplasm pedigree');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38843/progeny?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'progenyGermplasmDbId' => 38846,'defaultDisplayName' => 'new_test_crossP001','germplasmDbId' => 38846,'parentType' => 'FEMALE'},{'defaultDisplayName' => 'new_test_crossP002','germplasmDbId' => 38847,'progenyGermplasmDbId' => 38847,'parentType' => 'FEMALE'},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38848,'defaultDisplayName' => 'new_test_crossP003','germplasmDbId' => 38848},{'progenyGermplasmDbId' => 38849,'defaultDisplayName' => 'new_test_crossP004','germplasmDbId' => 38849,'parentType' => 'FEMALE'},{'progenyGermplasmDbId' => 38850,'defaultDisplayName' => 'new_test_crossP005','germplasmDbId' => 38850,'parentType' => 'FEMALE'},{'progenyGermplasmDbId' => 38851,'defaultDisplayName' => 'new_test_crossP006','germplasmDbId' => 38851,'parentType' => 'FEMALE'},{'parentType' => 'FEMALE','defaultDisplayName' => 'new_test_crossP007','germplasmDbId' => 38852,'progenyGermplasmDbId' => 38852},{'germplasmDbId' => 38853,'defaultDisplayName' => 'new_test_crossP008','progenyGermplasmDbId' => 38853,'parentType' => 'FEMALE'},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38854,'defaultDisplayName' => 'new_test_crossP009','germplasmDbId' => 38854},{'germplasmDbId' => 38855,'defaultDisplayName' => 'new_test_crossP010','progenyGermplasmDbId' => 38855,'parentType' => 'FEMALE'}],'progeny' => [{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38846,'germplasmDbId' => 38846,'defaultDisplayName' => 'new_test_crossP001'},{'parentType' => 'FEMALE','germplasmDbId' => 38847,'defaultDisplayName' => 'new_test_crossP002','progenyGermplasmDbId' => 38847},{'progenyGermplasmDbId' => 38848,'defaultDisplayName' => 'new_test_crossP003','germplasmDbId' => 38848,'parentType' => 'FEMALE'},{'germplasmDbId' => 38849,'defaultDisplayName' => 'new_test_crossP004','progenyGermplasmDbId' => 38849,'parentType' => 'FEMALE'},{'parentType' => 'FEMALE','defaultDisplayName' => 'new_test_crossP005','germplasmDbId' => 38850,'progenyGermplasmDbId' => 38850},{'parentType' => 'FEMALE','progenyGermplasmDbId' => 38851,'germplasmDbId' => 38851,'defaultDisplayName' => 'new_test_crossP006'},{'progenyGermplasmDbId' => 38852,'germplasmDbId' => 38852,'defaultDisplayName' => 'new_test_crossP007','parentType' => 'FEMALE'},{'defaultDisplayName' => 'new_test_crossP008','germplasmDbId' => 38853,'progenyGermplasmDbId' => 38853,'parentType' => 'FEMALE'},{'germplasmDbId' => 38854,'defaultDisplayName' => 'new_test_crossP009','progenyGermplasmDbId' => 38854,'parentType' => 'FEMALE'},{'defaultDisplayName' => 'new_test_crossP010','germplasmDbId' => 38855,'progenyGermplasmDbId' => 38855,'parentType' => 'FEMALE'}],'defaultDisplayName' => 'test_accession4','germplasmDbId' => '38843'},'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::Germplasm','messageType' => 'INFO'},{'message' => 'Germplasm progeny result constructed','messageType' => 'INFO'}],'pagination' => {'totalCount' => 15,'currentPage' => 0,'pageSize' => 10,'totalPages' => 2},'datafiles' => []}}, 'germplasm progeny');

$mech->get_ok('http://localhost:3010/brapi/v1/germplasm/38937/markerprofiles?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'markerprofileDbIds' => [1622,1934],'germplasmDbId' => '38937'},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::Germplasm','messageType' => 'INFO'},{'message' => 'Germplasm markerprofiles result constructed','messageType' => 'INFO'}],'pagination' => {'totalCount' => 2,'currentPage' => 0,'pageSize' => 10,'totalPages' => 1},'datafiles' => []}}, 'germplasm markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles?pageSize=2&page=3&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=3, pageSize=2'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'message' => 'Markerprofiles-search result constructed','messageType' => 'INFO'}],'pagination' => {'pageSize' => 2,'totalCount' => 535,'totalPages' => 268,'currentPage' => 3},'datafiles' => []},'result' => {'data' => [{'uniqueDisplayName' => 'UG120004|78264','analysisMethod' => 'GBS ApeKI genotyping v4','extractDbId' => '38881','germplasmDbId' => '38881','resultCount' => 500,'sampleDbId' => '38881','markerprofileDbId' => '533'},{'markerprofileDbId' => '837','sampleDbId' => '38881','uniqueDisplayName' => 'UG120004|79798','resultCount' => 500,'analysisMethod' => 'GBS ApeKI genotyping v4','extractDbId' => '38881','germplasmDbId' => '38881'}]}}, 'markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles?pageSize=1&page=1&germplasmDbId=38937&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'uniqueDisplayName' => 'UG120066|79802','analysisMethod' => 'GBS ApeKI genotyping v4','extractDbId' => '38937','germplasmDbId' => '38937','resultCount' => 500,'sampleDbId' => '38937','markerprofileDbId' => '841'}]},'metadata' => {'datafiles' => [],'pagination' => {'currentPage' => 1,'totalPages' => 2,'totalCount' => 2,'pageSize' => 1},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=1, pageSize=1'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'message' => 'Markerprofiles-search result constructed','messageType' => 'INFO'}]}}, 'markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles?pageSize=2&page=3&methodDbId=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'analysisMethod' => 'GBS ApeKI genotyping v4','extractDbId' => '38881','sampleDbId' => '38881','markerprofileDbId' => '533','germplasmDbId' => '38881','resultCount' => 500,'uniqueDisplayName' => 'UG120004|78264'},{'markerprofileDbId' => '837','sampleDbId' => '38881','extractDbId' => '38881','germplasmDbId' => '38881','analysisMethod' => 'GBS ApeKI genotyping v4','uniqueDisplayName' => 'UG120004|79798','resultCount' => 500}]},'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=3, pageSize=2','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::Markerprofiles','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Markerprofiles-search result constructed'}],'datafiles' => [],'pagination' => {'pageSize' => 2,'totalPages' => 268,'totalCount' => 535,'currentPage' => 3}}}, 'markerprofile');

$mech->get_ok('http://localhost:3010/brapi/v1/markerprofiles/533?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::Markerprofiles','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Markerprofiles detail result constructed'}],'datafiles' => [],'pagination' => undef},'result' => {'uniqueDisplayName' => 'UG120004|78264','sampleDbId' => '38881','extractDbId' => '38881','markerprofileDbId' => '533','germplasmDbId' => '38881','data' => [{'S5_36739' => '0'},{'S13_92567' => '1'},{'S69_57277' => '0'},{'S80_224901' => '1'},{'S80_232173' => '1'},{'S80_265728' => '0'},{'S97_219243' => '1'},{'S224_309814' => '0'},{'S248_174244' => '1'},{'S318_245078' => '2'}],'analysisMethod' => 'GBS ApeKI genotyping v4'}}, 'markerprofile');

$mech->post_ok('http://localhost:3010/brapi/v1/allelematrices-search?access_token='.$access_token, ['markerprofileDbId'=>[841,533], 'format'=>'json'] );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [['S10114_185859','533','0'],['S10173_777651','533','0'],['S10173_899514','533','0'],['S10241_146006','533','1'],['S1027_465354','533','1'],['S10367_21679','533','1'],['S1046_216535','533','2'],['S10493_191533','533','0'],['S10493_282956','533','2'],['S10493_529025','533','0']]},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Markerprofiles'},{'messageType' => 'INFO','message' => 'Markerprofiles allelematrix result constructed'}],'datafiles' => [],'pagination' => {'pageSize' => 10,'totalCount' => 1000,'totalPages' => 100,'currentPage' => 0}}}, 'allelematrices-search');

$mech->get_ok('http://localhost:3010/brapi/v1/programs?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'objective' => 'test','programDbId' => '134','abbreviation' => '','programName' => 'test','commonCropName' => 'Cassava','leadPerson' => ''}]},'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 10,'totalPages' => 1,'totalCount' => 1,'currentPage' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Programs'},{'message' => 'Program list result constructed','messageType' => 'INFO'}]}}, 'programs');

$mech->get_ok('http://localhost:3010/brapi/v1/crops?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => ['Cassava']},'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 10,'totalPages' => 1,'currentPage' => 0,'totalCount' => 1},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Crops'},{'message' => 'Crops result constructed','messageType' => 'INFO'}]}}, 'crops');

$mech->get_ok('http://localhost:3010/brapi/v1/seasons?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'seasonDbId' => '2014','season' => '','year' => '2014'},{'season' => '','year' => '2015','seasonDbId' => '2015'},{'seasonDbId' => '2016','year' => '2016','season' => ''},{'seasonDbId' => '2017','year' => '2017','season' => ''}]},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Seasons list result constructed'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'currentPage' => 0,'pageSize' => 10,'totalCount' => 4}}}, 'seasons');

$mech->get_ok('http://localhost:3010/brapi/v1/studytypes?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'description' => 'seedling','name' => 'Seedling Nursery'},{'description' => 'phenotyping_trial','name' => 'phenotyping_trial'},{'name' => 'genotyping_trial','description' => 'genotyping_trial'},{'name' => 'Advanced Yield Trial','description' => ''},{'description' => '','name' => 'Preliminary Yield Trial'},{'name' => 'Uniform Yield Trial','description' => ''},{'description' => '','name' => 'Variety Release Trial'},{'description' => '','name' => 'Clonal Evaluation'},{'name' => 'genetic_gain_trial','description' => ''},{'name' => 'storage_trial','description' => ''}]},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','messageType' => 'INFO'},{'message' => 'StudyTypes list result constructed','messageType' => 'INFO'}],'pagination' => {'currentPage' => 0,'totalCount' => 22,'pageSize' => 10,'totalPages' => 3},'datafiles' => []}}, 'studyTypes');

$mech->get_ok('http://localhost:3010/brapi/v1/studytypes?pageSize=2&page=2&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'description' => '','name' => 'Preliminary Yield Trial'},{'description' => '','name' => 'Uniform Yield Trial'}]},'metadata' => {'pagination' => {'currentPage' => 2,'pageSize' => 2,'totalCount' => 22,'totalPages' => 11},'status' => [{'message' => 'BrAPI base call found with page=2, pageSize=2','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Studies'},{'messageType' => 'INFO','message' => 'StudyTypes list result constructed'}],'datafiles' => []}}, 'studyTypes');

# $mech->get_ok('http://localhost:3010/brapi/v1/trials?pageSize=2&page=0&access_token='.$access_token);
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# is_deeply($response, {}, 'trials');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=2&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"trialDbId"=>"","studyType"=>undef,"studyDbId"=>"137","programName"=>"test","commonCropName"=>"Cassava","studyTypeName"=>"","programDbId"=>"134","locationName"=>"test_location","startDate"=>"2017-07-04","endDate"=>"2017-07-21","studyTypeDbId"=>"","additionalInfo"=>{"description"=>"test trial","design"=>"CRD"},"active"=>JSON::true,"trialName"=>undef,"name"=>"test_trial","documentationURL"=>"","seasons"=>[{"seasonDbId"=>"","year"=>"2014","season"=>""}],"locationDbId"=>"23","studyName"=>"test_trial"},{"studyName"=>"trial2 NaCRRI","name"=>"trial2 NaCRRI","trialName"=>undef,"seasons"=>[{"season"=>"","year"=>"2014","seasonDbId"=>""}],"documentationURL"=>"","locationDbId"=>"23","programDbId"=>"134","locationName"=>"test_location","startDate"=>undef,"active"=>JSON::true,"endDate"=>undef,"studyTypeDbId"=>"","additionalInfo"=>{"description"=>"another trial for solGS","design"=>"CRD"},"studyDbId"=>"141","programName"=>"test","trialDbId"=>"","studyType"=>undef,"commonCropName"=>"Cassava","studyTypeName"=>""}]},"metadata"=>{"datafiles"=>[],"pagination"=>{"currentPage"=>2,"totalPages"=>3,"totalCount"=>6,"pageSize"=>2},"status"=>[{"messageType"=>"INFO","message"=>"BrAPI base call found with page=2, pageSize=2"},{"messageType"=>"INFO","message"=>"Loading CXGN::BrAPI::v1::Studies"},{"message"=>"Studies-search result constructed","messageType"=>"INFO"}]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/search/studies?access_token='.$access_token , ['pageSize'=>'2', 'page'=>'2']);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultsDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v1/search/studies/'. $searchId . '?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"trialDbId"=>"","studyType"=>undef,"studyDbId"=>"137","programName"=>"test","commonCropName"=>"Cassava","studyTypeName"=>"","programDbId"=>"134","locationName"=>"test_location","startDate"=>"2017-07-04","endDate"=>"2017-07-21","studyTypeDbId"=>"","additionalInfo"=>{"description"=>"test trial","design"=>"CRD"},"active"=>JSON::true,"trialName"=>undef,"name"=>"test_trial","documentationURL"=>"","seasons"=>[{"seasonDbId"=>"","year"=>"2014","season"=>""}],"locationDbId"=>"23","studyName"=>"test_trial"},{"studyName"=>"trial2 NaCRRI","name"=>"trial2 NaCRRI","trialName"=>undef,"seasons"=>[{"season"=>"","year"=>"2014","seasonDbId"=>""}],"documentationURL"=>"","locationDbId"=>"23","programDbId"=>"134","locationName"=>"test_location","startDate"=>undef,"active"=>JSON::true,"endDate"=>undef,"studyTypeDbId"=>"","additionalInfo"=>{"description"=>"another trial for solGS","design"=>"CRD"},"studyDbId"=>"141","programName"=>"test","trialDbId"=>"","studyType"=>undef,"commonCropName"=>"Cassava","studyTypeName"=>""}]},"metadata"=>{"datafiles"=>[],"pagination"=>{"currentPage"=>2,"totalPages"=>3,"totalCount"=>6,"pageSize"=>2},"status"=>[{"messageType"=>"INFO","message"=>"BrAPI base call found with page=2, pageSize=2"},{"messageType"=>"INFO","message"=>"Loading CXGN::BrAPI::v1::Studies"},{"message"=>"Studies-search result constructed","messageType"=>"INFO"}]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&programDbIds=100&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[]},"metadata"=>{"status"=>[{"message"=>"BrAPI base call found with page=0, pageSize=2","messageType"=>"INFO"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","messageType"=>"INFO"},{"message"=>"Studies-search result constructed","messageType"=>"INFO"}],"pagination"=>{"totalCount"=>0,"pageSize"=>2,"totalPages"=>0,"currentPage"=>0},"datafiles"=>[]}}, 'studies-search with program');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&programDbIds=134&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"datafiles"=>[],"status"=>[{"messageType"=>"INFO","message"=>"BrAPI base call found with page=0, pageSize=2"},{"messageType"=>"INFO","message"=>"Loading CXGN::BrAPI::v1::Studies"},{"message"=>"Studies-search result constructed","messageType"=>"INFO"}],"pagination"=>{"currentPage"=>0,"pageSize"=>2,"totalCount"=>6,"totalPages"=>3}},"result"=>{"data"=>[{"studyTypeName"=>"","name"=>"CASS_6Genotypes_Sampling_2015","additionalInfo"=>{"design"=>"RCBD","description"=>"Copy of trial with postcomposed phenotypes from cassbase."},"commonCropName"=>"Cassava","documentationURL"=>"","active"=>JSON::true,"locationName"=>"test_location","trialName"=>undef,"startDate"=>undef,"seasons"=>[{"season"=>"","seasonDbId"=>"","year"=>"2017"}],"programName"=>"test","studyDbId"=>"165","studyName"=>"CASS_6Genotypes_Sampling_2015","studyTypeDbId"=>"","trialDbId"=>"","programDbId"=>"134","locationDbId"=>"23","endDate"=>undef,"studyType"=>"Preliminary Yield Trial"},{"studyType"=>"Clonal Evaluation","endDate"=>undef,"programDbId"=>"134","locationDbId"=>"23","studyName"=>"Kasese solgs trial","trialDbId"=>"","studyTypeDbId"=>"","programName"=>"test","seasons"=>[{"season"=>"","year"=>"2014","seasonDbId"=>""}],"studyDbId"=>"139","startDate"=>undef,"active"=>JSON::true,"locationName"=>"test_location","trialName"=>undef,"additionalInfo"=>{"design"=>"Alpha","description"=>"This trial was loaded into the fixture to test solgs."},"commonCropName"=>"Cassava","documentationURL"=>"","studyTypeName"=>"","name"=>"Kasese solgs trial"}]}}, 'studies-search with program');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&trialDbIds=167&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"datafiles"=>[],"status"=>[{"message"=>"BrAPI base call found with page=0, pageSize=2","messageType"=>"INFO"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","messageType"=>"INFO"},{"messageType"=>"INFO","message"=>"Studies-search result constructed"}],"pagination"=>{"currentPage"=>0,"totalPages"=>0,"totalCount"=>0,"pageSize"=>2}},"result"=>{"data"=>[]}}, 'studies-search with trial');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&studyLocations=test_location&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"datafiles"=>[],"status"=>[{"messageType"=>"INFO","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","messageType"=>"INFO"},{"messageType"=>"INFO","message"=>"Studies-search result constructed"}],"pagination"=>{"totalPages"=>3,"totalCount"=>6,"currentPage"=>0,"pageSize"=>2}},"result"=>{"data"=>[{"studyName"=>"CASS_6Genotypes_Sampling_2015","documentationURL"=>"","seasons"=>[{"season"=>"","year"=>"2017","seasonDbId"=>""}],"locationDbId"=>"23","name"=>"CASS_6Genotypes_Sampling_2015","trialName"=>undef,"studyTypeDbId"=>"","additionalInfo"=>{"description"=>"Copy of trial with postcomposed phenotypes from cassbase.","design"=>"RCBD"},"endDate"=>undef,"active"=>JSON::true,"programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location","commonCropName"=>"Cassava","studyTypeName"=>"","studyType"=>"Preliminary Yield Trial","trialDbId"=>"","programName"=>"test","studyDbId"=>"165"},{"name"=>"Kasese solgs trial","trialName"=>undef,"seasons"=>[{"seasonDbId"=>"","season"=>"","year"=>"2014"}],"documentationURL"=>"","locationDbId"=>"23","studyName"=>"Kasese solgs trial","programName"=>"test","studyDbId"=>"139","trialDbId"=>"","studyType"=>"Clonal Evaluation","studyTypeName"=>"","commonCropName"=>"Cassava","programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location","active"=>JSON::true,"studyTypeDbId"=>"","endDate"=>undef,"additionalInfo"=>{"design"=>"Alpha","description"=>"This trial was loaded into the fixture to test solgs."}}]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&locationName=test_location&studyType=Clonal%20Evaluation&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"documentationURL"=>"","seasons"=>[{"year"=>"2014","season"=>"","seasonDbId"=>""}],"locationDbId"=>"23","trialName"=>undef,"name"=>"Kasese solgs trial","studyName"=>"Kasese solgs trial","studyTypeName"=>"","commonCropName"=>"Cassava","trialDbId"=>"","studyType"=>"Clonal Evaluation","programName"=>"test","studyDbId"=>"139","studyTypeDbId"=>"","endDate"=>undef,"additionalInfo"=>{"design"=>"Alpha","description"=>"This trial was loaded into the fixture to test solgs."},"active"=>JSON::true,"programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location"}]},"metadata"=>{"pagination"=>{"currentPage"=>0,"totalPages"=>1,"totalCount"=>1,"pageSize"=>2},"status"=>[{"messageType"=>"INFO","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","messageType"=>"INFO"},{"message"=>"Studies-search result constructed","messageType"=>"INFO"}],"datafiles"=>[]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&programName=test&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"metadata"=>{"pagination"=>{"currentPage"=>0,"totalCount"=>6,"totalPages"=>3,"pageSize"=>2},"status"=>[{"messageType"=>"INFO","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","messageType"=>"INFO"},{"messageType"=>"INFO","message"=>"Studies-search result constructed"}],"datafiles"=>[]},"result"=>{"data"=>[{"seasons"=>[{"year"=>"2017","season"=>"","seasonDbId"=>""}],"documentationURL"=>"","locationDbId"=>"23","trialName"=>undef,"name"=>"CASS_6Genotypes_Sampling_2015","studyName"=>"CASS_6Genotypes_Sampling_2015","commonCropName"=>"Cassava","studyTypeName"=>"","studyDbId"=>"165","programName"=>"test","studyType"=>"Preliminary Yield Trial","trialDbId"=>"","active"=>JSON::true,"studyTypeDbId"=>"","endDate"=>undef,"additionalInfo"=>{"description"=>"Copy of trial with postcomposed phenotypes from cassbase.","design"=>"RCBD"},"programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location"},{"commonCropName"=>"Cassava","studyTypeName"=>"","studyDbId"=>"139","programName"=>"test","trialDbId"=>"","studyType"=>"Clonal Evaluation","active"=>JSON::true,"studyTypeDbId"=>"","endDate"=>undef,"additionalInfo"=>{"description"=>"This trial was loaded into the fixture to test solgs.","design"=>"Alpha"},"programDbId"=>"134","startDate"=>undef,"locationName"=>"test_location","seasons"=>[{"seasonDbId"=>"","season"=>"","year"=>"2014"}],"documentationURL"=>"","locationDbId"=>"23","trialName"=>undef,"name"=>"Kasese solgs trial","studyName"=>"Kasese solgs trial"}]}}, 'studies-search');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&germplasmNames=TMEB693&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"studyTypeDbId"=>"","trialDbId"=>"","studyName"=>"CASS_6Genotypes_Sampling_2015","studyDbId"=>"165","programName"=>"test","seasons"=>[{"season"=>"","seasonDbId"=>"","year"=>"2017"}],"endDate"=>undef,"studyType"=>"Preliminary Yield Trial","locationDbId"=>"23","programDbId"=>"134","documentationURL"=>"","commonCropName"=>"Cassava","additionalInfo"=>{"description"=>"Copy of trial with postcomposed phenotypes from cassbase.","design"=>"RCBD"},"name"=>"CASS_6Genotypes_Sampling_2015","studyTypeName"=>"","startDate"=>undef,"trialName"=>undef,"locationName"=>"test_location","active"=>JSON::true}]},"metadata"=>{"datafiles"=>[],"pagination"=>{"currentPage"=>0,"pageSize"=>2,"totalCount"=>1,"totalPages"=>1},"status"=>[{"messageType"=>"INFO","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","messageType"=>"INFO"},{"messageType"=>"INFO","message"=>"Studies-search result constructed"}]}}, 'studies-search with germplasm name');

$mech->post_ok('http://localhost:3010/brapi/v1/studies-search?pageSize=2&page=0&observationVariableDbIds=77549&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"data"=>[{"name"=>"CASS_6Genotypes_Sampling_2015","studyTypeName"=>"","documentationURL"=>"","commonCropName"=>"Cassava","additionalInfo"=>{"design"=>"RCBD","description"=>"Copy of trial with postcomposed phenotypes from cassbase."},"trialName"=>undef,"locationName"=>"test_location","active"=>JSON::true,"startDate"=>undef,"studyDbId"=>"165","seasons"=>[{"season"=>"","year"=>"2017","seasonDbId"=>""}],"programName"=>"test","trialDbId"=>"","studyTypeDbId"=>"","studyName"=>"CASS_6Genotypes_Sampling_2015","locationDbId"=>"23","programDbId"=>"134","endDate"=>undef,"studyType"=>"Preliminary Yield Trial"}]},"metadata"=>{"datafiles"=>[],"pagination"=>{"currentPage"=>0,"pageSize"=>2,"totalCount"=>1,"totalPages"=>1},"status"=>[{"messageType"=>"INFO","message"=>"BrAPI base call found with page=0, pageSize=2"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","messageType"=>"INFO"},{"messageType"=>"INFO","message"=>"Studies-search result constructed"}]}}, 'studies-search with trait');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/139?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response,{'metadata' => {'pagination' => {'totalCount' => 1,'totalPages' => 1,'currentPage' => 0,'pageSize' => 10},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Studies'},{'message' => 'Studies detail result constructed','messageType' => 'INFO'}]},'result' => {'startDate' => undef,'studyName' => 'Kasese solgs trial','studyTypeName' => '','studyDescription' => 'This trial was loaded into the fixture to test solgs.','seasons' => ['2014'],'contacts' => undef,'additionalInfo' => {},'programName' => 'test','trialName' => 'test','endDate' => undef,'active' => JSON::true,'lastUpdate' => {'timestamp' => undef,'version' => ''},'studyTypeDbId' => '','studyDbId' => '139','studyType' => 'Clonal Evaluation','license' => '','documentationURL' => '','programDbId' => '134','location' => {'abbreviation' => '','locationName' => 'test_location','locationDbId' => '23','documentationURL' => '','locationType' => '','countryCode' => 'USA','countryName' => 'United States','longitude' => '-115.86428','additionalInfo' => {'geodetic datum' => undef,'breeding_program' => '134'},'latitude' => '32.61359','altitude' => '109','name' => 'test_location','instituteName' => '','instituteAddress' => ''},'dataLinks' => [],'trialDbId' => '134','commonCropName' => 'Cassava'}}, 'study details');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/139/germplasm?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'studyName' => 'Kasese solgs trial','data' => [{'accessionNumber' => '','germplasmDbId' => '38878','seedSource' => '','entryNumber' => '','germplasmName' => 'UG120001','synonyms' => [],'pedigree' => '','germplasmPUI' => ''},{'germplasmDbId' => '38879','accessionNumber' => '','pedigree' => '','germplasmPUI' => '','seedSource' => '','entryNumber' => '','germplasmName' => 'UG120002','synonyms' => []},{'accessionNumber' => '','germplasmDbId' => '38880','entryNumber' => '','seedSource' => '','synonyms' => [],'germplasmName' => 'UG120003','pedigree' => '','germplasmPUI' => ''},{'germplasmDbId' => '38881','accessionNumber' => '','germplasmPUI' => '','pedigree' => '','synonyms' => [],'germplasmName' => 'UG120004','entryNumber' => '','seedSource' => ''},{'germplasmDbId' => '38882','accessionNumber' => '','germplasmPUI' => '','pedigree' => '','germplasmName' => 'UG120005','synonyms' => [],'entryNumber' => '','seedSource' => ''},{'synonyms' => [],'germplasmName' => 'UG120006','seedSource' => '','entryNumber' => '','germplasmPUI' => '','pedigree' => '','accessionNumber' => '','germplasmDbId' => '38883'},{'pedigree' => '','germplasmPUI' => '','germplasmName' => 'UG120007','synonyms' => [],'seedSource' => '','entryNumber' => '','germplasmDbId' => '38884','accessionNumber' => ''},{'accessionNumber' => '','germplasmDbId' => '38885','entryNumber' => '','seedSource' => '','synonyms' => [],'germplasmName' => 'UG120008','germplasmPUI' => '','pedigree' => ''},{'accessionNumber' => '','germplasmDbId' => '38886','entryNumber' => '','seedSource' => '','synonyms' => [],'germplasmName' => 'UG120009','pedigree' => '','germplasmPUI' => ''},{'seedSource' => '','entryNumber' => '','germplasmName' => 'UG120010','synonyms' => [],'germplasmPUI' => '','pedigree' => '','accessionNumber' => '','germplasmDbId' => '38887'}],'studyDbId' => '139'},'metadata' => {'pagination' => {'totalPages' => 38,'pageSize' => 10,'totalCount' => 374,'currentPage' => 0},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Studies-germplasm result constructed'}]}}, 'study germplasm');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/observationvariables?pageSize=2&page=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {"result"=>{"studyDbId"=>"165","studyName"=>"CASS_6Genotypes_Sampling_2015","data"=>[{"ontologyReference"=>{"ontologyName"=>"COMP","documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyDbId"=>"305"},"observationVariableName"=>"cass sink leaf|ADP|ug/g|week 16","submissionTimeStamp"=>undef,"institution"=>"","ontologyName"=>"COMP","crop"=>"Cassava","synonyms"=>[],"contextOfUse"=>[],"observationVariableDbId"=>"cass sink leaf|ADP|ug/g|week 16|COMP:0000010","xref"=>"COMP:0000010","documentationURL"=>"","method"=>{"class"=>"","description"=>"","reference"=>"","formula"=>"","methodDbId"=>"","ontologyReference"=>{"ontologyName"=>"COMP","documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyDbId"=>"305"},"name"=>"","methodName"=>""},"language"=>"EN","growthStage"=>"","scale"=>{"validValues"=>{"min"=>undef,"categories"=>[],"max"=>undef},"scaleName"=>"","xref"=>"","dataType"=>"Numerical","ontologyReference"=>{"ontologyName"=>"COMP","documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyDbId"=>"305"},"scaleDbId"=>"","decimalPlaces"=>undef,"name"=>""},"scientist"=>"","name"=>"cass sink leaf|ADP|ug/g|week 16|COMP:0000010","ontologyDbId"=>"305","trait"=>{"ontologyReference"=>{"ontologyName"=>"COMP","documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyDbId"=>"305"},"entity"=>"","mainAbbreviation"=>"","alternativeAbbreviations"=>[],"traitName"=>"cass sink leaf|ADP|ug/g|week 16","name"=>"cass sink leaf|ADP|ug/g|week 16","traitDbId"=>"COMP:0000010","status"=>JSON::true,"class"=>"","description"=>undef,"synonyms"=>[],"xref"=>"COMP:0000010"},"status"=>JSON::true,"defaultValue"=>""},{"method"=>{"name"=>"","methodName"=>"","ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyName"=>"COMP","ontologyDbId"=>"305"},"reference"=>"","formula"=>"","methodDbId"=>"","class"=>"","description"=>""},"language"=>"EN","growthStage"=>"","scale"=>{"scaleName"=>"","xref"=>"","dataType"=>"Numerical","validValues"=>{"min"=>undef,"categories"=>[],"max"=>undef},"name"=>"","ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyName"=>"COMP","ontologyDbId"=>"305"},"scaleDbId"=>"","decimalPlaces"=>undef},"scientist"=>"","ontologyDbId"=>"305","name"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002","trait"=>{"status"=>JSON::true,"class"=>"","description"=>undef,"synonyms"=>[],"xref"=>"COMP:0000002","entity"=>"","ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyName"=>"COMP","ontologyDbId"=>"305"},"mainAbbreviation"=>"","alternativeAbbreviations"=>[],"traitName"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16","name"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16","traitDbId"=>"COMP:0000002"},"status"=>JSON::true,"defaultValue"=>"","ontologyReference"=>{"documentationURL"=>{"URL"=>"","type"=>""},"version"=>"","ontologyName"=>"COMP","ontologyDbId"=>"305"},"observationVariableName"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16","submissionTimeStamp"=>undef,"institution"=>"","ontologyName"=>"COMP","crop"=>"Cassava","synonyms"=>[],"contextOfUse"=>[],"observationVariableDbId"=>"cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002","documentationURL"=>"","xref"=>"COMP:0000002"}]},"metadata"=>{"status"=>[{"message"=>"BrAPI base call found with page=1, pageSize=2","messageType"=>"INFO"},{"message"=>"Loading CXGN::BrAPI::v1::Studies","messageType"=>"INFO"},{"message"=>"Studies observation variables result constructed","messageType"=>"INFO"}],"pagination"=>{"totalPages"=>6,"currentPage"=>1,"pageSize"=>2,"totalCount"=>12},"datafiles"=>[]}}, 'study variables');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/observationunits?pageSize=1&page=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 19,'pageSize' => 1,'totalCount' => 19,'currentPage' => 1},'status' => [{'message' => 'BrAPI base call found with page=1, pageSize=1','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Studies observations result constructed'}],'datafiles' => []},'result' => {'data' => [{'observationLevel' => 'plot','studyName' => 'CASS_6Genotypes_Sampling_2015','studyDbId' => '165','programName' => 'test','pedigree' => 'NA/NA','entryNumber' => '','observationUnitXref' => [],'Y' => undef,'studyLocationDbId' => '23','replicate' => undef,'X' => undef,'observationUnitDbId' => '41295','blockNumber' => undef,'treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}],'observationLevels' => 'plot','plotNumber' => '104','studyLocation' => 'test_location','germplasmName' => 'IITA-TMS-IBA980002','observations' => [{'observationTimestamp' => 'NA2017-04-21_21:11:28Z','value' => '221.6135','observationVariableDbId' => '77559','collector' => 'johndoe','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','season' => {'season' => '','year' => '2017','seasonDbId' => ''},'observationDbId' => '740348'},{'observationDbId' => '740349','collector' => 'johndoe','observationTimestamp' => 'NA2017-04-21_21:11:28Z','season' => {'seasonDbId' => '','year' => '2017','season' => ''},'observationVariableDbId' => '77557','value' => '36.12425','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011'},{'observationVariableDbId' => '77556','value' => '316.489','observationTimestamp' => 'NA2017-04-21_21:11:28Z','collector' => 'johndoe','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','season' => {'seasonDbId' => '','year' => '2017','season' => ''},'observationDbId' => '740350'},{'collector' => 'johndoe','value' => '908.9045','observationVariableDbId' => '77548','observationTimestamp' => 'NA2017-04-21_21:11:28Z','observationDbId' => '740351','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','season' => {'seasonDbId' => '','season' => '','year' => '2017'}},{'collector' => 'johndoe','observationDbId' => '740352','observationTimestamp' => 'NA2017-04-21_21:11:28Z','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','value' => '29.6934','observationVariableDbId' => '77553','season' => {'season' => '','year' => '2017','seasonDbId' => ''}},{'season' => {'year' => '2017','season' => '','seasonDbId' => ''},'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationDbId' => '740353','observationTimestamp' => 'NA2017-04-21_21:11:28Z','value' => '162.9475','observationVariableDbId' => '77549','collector' => 'johndoe'},{'observationDbId' => '740354','season' => {'season' => '','year' => '2017','seasonDbId' => ''},'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','collector' => 'johndoe','observationVariableDbId' => '77552','value' => '23.09545','observationTimestamp' => 'NA2017-04-21_21:11:28Z'},{'value' => '14.3795','observationVariableDbId' => '77550','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','season' => {'seasonDbId' => '','season' => '','year' => '2017'},'observationTimestamp' => 'NA2017-04-21_21:11:28Z','collector' => 'johndoe','observationDbId' => '740355'},{'observationDbId' => '740356','observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','season' => {'season' => '','year' => '2017','seasonDbId' => ''},'collector' => 'johndoe','observationTimestamp' => 'NA2017-04-21_21:11:28Z','observationVariableDbId' => '77551','value' => '85.9106'},{'observationDbId' => '740357','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','season' => {'season' => '','year' => '2017','seasonDbId' => ''},'collector' => 'johndoe','value' => '54.2099','observationVariableDbId' => '77558','observationTimestamp' => 'NA2017-04-21_21:11:28Z'},{'value' => '13.8628','observationVariableDbId' => '77554','observationTimestamp' => 'NA2017-04-21_21:11:28Z','collector' => 'johndoe','season' => {'seasonDbId' => '','year' => '2017','season' => ''},'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationDbId' => '740358'},{'season' => {'season' => '','year' => '2017','seasonDbId' => ''},'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationDbId' => '740359','value' => '341.041','observationVariableDbId' => '77555','observationTimestamp' => 'NA2017-04-21_21:11:28Z','collector' => 'johndoe'}],'entryType' => 'test','observationUnitName' => 'CASS_6Genotypes_104','plantNumber' => undef,'germplasmDbId' => '41282'}]}}, 'study observation units');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/table?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalCount' => 19,'totalPages' => 2},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Studies observations table result constructed'}],'datafiles' => []},'result' => {'observationVariableNames' => ['cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','cass sink leaf|ADP|ug/g|week 16|COMP:0000010','cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','cass source leaf|ADP|ug/g|week 16|COMP:0000003','cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','cass storage root|ADP|ug/g|week 16|COMP:0000005','cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','cass upper stem|ADP|ug/g|week 16|COMP:0000009','notes'],'data' => [['studyYear','programDbId','programName','programDescription','studyDbId','studyName','studyDescription','studyDesign','plotWidth','plotLength','fieldSize','fieldTrialIsPlannedToBeGenotyped','fieldTrialIsPlannedToCross','plantingDate','harvestDate','locationDbId','locationName','germplasmDbId','germplasmName','germplasmSynonyms','observationLevel','observationUnitDbId','observationUnitName','replicate','blockNumber','plotNumber','rowNumber','colNumber','entryType','plantNumber','plantedSeedlotStockDbId','plantedSeedlotStockUniquename','plantedSeedlotCurrentCount','plantedSeedlotCurrentWeightGram','plantedSeedlotBoxName','plantedSeedlotTransactionCount','plantedSeedlotTransactionWeight','plantedSeedlotTransactionDescription','availableGermplasmSeedlotUniquenames','cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','cass sink leaf|ADP|ug/g|week 16|COMP:0000010','cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','cass source leaf|ADP|ug/g|week 16|COMP:0000003','cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','cass storage root|ADP|ug/g|week 16|COMP:0000005','cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','cass upper stem|ADP|ug/g|week 16|COMP:0000009','notes'],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41283,'IITA-TMS-IBA980581','','plot',41284,'CASS_6Genotypes_103','1','1','103',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','601.518','39.84365','655.92','1259.08','17.38275','192.1495','67.9959','20.3038','102.0875','108.56995','28.83915','379.16',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41282,'IITA-TMS-IBA980002','','plot',41295,'CASS_6Genotypes_104','1','1','104',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','221.6135','36.12425','316.489','908.9045','29.6934','162.9475','23.09545','14.3795','85.9106','54.2099','13.8628','341.041',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41279,'IITA-TMS-IBA30572','','plot',41296,'CASS_6Genotypes_105','1','1','105',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','662.087','46.1458','559.441','1974.265','38.1064','484.765','33.1455','16.7238','98.71395','97.8179','35.4435','439.9695',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41281,'IITA-TMS-IBA011412','','plot',41297,'CASS_6Genotypes_106','1','1','106',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','612.37','23.788','604.5625','646.902','26.60415','192.46','39.6698','16.78125','107.74','78.72305','28.3805','469.818',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41280,'TMEB693','','plot',41298,'CASS_6Genotypes_107','1','1','107',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','198.089','47.64845','485.944','779.191','21.12875','147.0405','31.554','10.59626','46.41935','101.7506','30.86975','423.355',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',40326,'BLANK','','plot',41299,'CASS_6Genotypes_201','1','2','201',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'',undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41280,'TMEB693','','plot',41300,'CASS_6Genotypes_202','1','2','202',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','250.228','39.2627','478.0445','1295.29','21.56485','169.757','26.2744','5.31292','39.4774','61.51325','36.2316','241.418',undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41282,'IITA-TMS-IBA980002','','plot',41301,'CASS_6Genotypes_203','1','2','203',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','245.679','29.4029','299.096','1013.111','17.04795','202.893','40.306','7.442495','75.2132','57.47695','20.43645','303.3225',undef]],'observationVariableDbIds' => [77559,77557,77556,77548,77553,77549,77552,77550,77551,77558,77554,77555,0],'headerRow' => ['studyYear','programDbId','programName','programDescription','studyDbId','studyName','studyDescription','studyDesign','plotWidth','plotLength','fieldSize','fieldTrialIsPlannedToBeGenotyped','fieldTrialIsPlannedToCross','plantingDate','harvestDate','locationDbId','locationName','germplasmDbId','germplasmName','germplasmSynonyms','observationLevel','observationUnitDbId','observationUnitName','replicate','blockNumber','plotNumber','rowNumber','colNumber','entryType','plantNumber','plantedSeedlotStockDbId','plantedSeedlotStockUniquename','plantedSeedlotCurrentCount','plantedSeedlotCurrentWeightGram','plantedSeedlotBoxName','plantedSeedlotTransactionCount','plantedSeedlotTransactionWeight','plantedSeedlotTransactionDescription','availableGermplasmSeedlotUniquenames']}}, 'study table');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/layout?pageSize=2&page=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 10,'currentPage' => 1,'totalCount' => 19,'pageSize' => 2},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=1, pageSize=2'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','messageType' => 'INFO'},{'message' => 'Studies layout result constructed','messageType' => 'INFO'}],'datafiles' => []},'result' => {'data' => [{'observationUnitDbId' => '41296','entryType' => 'Test','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA30572','additionalInfo' => {'designType' => 'RCBD','plotNumber' => '105','seedLotDbId' => undef,'plantDbIds' => [],'plotImageDbIds' => [],'plantNames' => [],'seedLotName' => undef},'X' => '','observationLevel' => 'plot','Y' => '','observationUnitName' => 'CASS_6Genotypes_105','germplasmDbId' => 41279,'blockNumber' => '1','replicate' => '1'},{'observationUnitDbId' => '41297','studyDbId' => '165','entryType' => 'Test','additionalInfo' => {'seedLotName' => undef,'plantNames' => [],'plotImageDbIds' => [],'plantDbIds' => [],'plotNumber' => '106','seedLotDbId' => undef,'designType' => 'RCBD'},'germplasmName' => 'IITA-TMS-IBA011412','observationLevel' => 'plot','X' => '','Y' => '','observationUnitName' => 'CASS_6Genotypes_106','germplasmDbId' => 41281,'replicate' => '1','blockNumber' => '1'}]}}, 'study layout');

$mech->get_ok('http://localhost:3010/brapi/v1/studies/165/observations?pageSize=2&page=1&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'observationDbId' => 740338,'observationUnitName' => 'CASS_6Genotypes_103','germplasmDbId' => 41283,'observationTimestamp' => 'NA2017-04-21_21:11:28Z','germplasmName' => 'IITA-TMS-IBA980581','observationVariableDbId' => 77556,'uploadedBy' => 'johndoe','operator' => 'johndoe','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationUnitDbId' => 41284,'season' => {},'observationLevel' => 'plot','studyDbId' => 165,'value' => '655.92'},{'observationTimestamp' => 'NA2017-04-21_21:11:28Z','observationVariableDbId' => 77548,'germplasmName' => 'IITA-TMS-IBA980581','uploadedBy' => 'johndoe','observationDbId' => 740339,'observationUnitName' => 'CASS_6Genotypes_103','germplasmDbId' => 41283,'observationLevel' => 'plot','studyDbId' => 165,'value' => '1259.08','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','operator' => 'johndoe','season' => {},'observationUnitDbId' => 41284}]},'metadata' => {'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=1, pageSize=2'},{'message' => 'Loading CXGN::BrAPI::v1::Studies','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Studies observations granular result constructed'}],'pagination' => {'currentPage' => 1,'totalCount' => 198,'pageSize' => 2,'totalPages' => 99}}}, 'study observations');

$mech->get_ok('http://localhost:3010/brapi/v1/phenotypes-search?pageSize=2&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'entryType' => 'test','studyName' => 'CASS_6Genotypes_Sampling_2015','replicate' => '1','germplasmDbId' => '41283','programName' => 'test','plotNumber' => '103','observationUnitPosition' => {'positionCoordinateY' => undef,'observationLevel' => {'levelOrder' => 2,'levelName' => 'plot','levelCode' => '103'},'positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW','observationLevelRelationships' => [{'levelName' => 'replicate','levelOrder' => 0,'levelCode' => '1'},{'levelOrder' => 1,'levelName' => 'block','levelCode' => '1'},{'levelCode' => '103','levelName' => 'plot','levelOrder' => 2}],'positionCoordinateX' => undef,'geoCoordinates' => undef,'entryType' => 'test'},'blockNumber' => '1','observationLevels' => 'plot','treatments' => [{'factor' => 'No ManagementFactor','modality' => ''}],'entryNumber' => '','observationUnitXref' => [],'studyLocation' => 'test_location','X' => undef,'pedigree' => undef,'observationUnitDbId' => '41284','locationDbId' => '23','observationUnitName' => 'CASS_6Genotypes_103','germplasmName' => 'IITA-TMS-IBA980581','plantNumber' => undef,'locationName' => 'test_location','observations' => [{'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationDbId' => '740336','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77559','season' => [{'seasonDbId' => undef,'season' => undef,'year' => '2017'}],'collector' => 'johndoe','value' => '601.518'},{'season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableDbId' => '77557','observationDbId' => '740337','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','collector' => 'johndoe','value' => '39.84365'},{'season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableDbId' => '77556','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740338','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','collector' => 'johndoe','value' => '655.92'},{'collector' => 'johndoe','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationVariableDbId' => '77548','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740339','season' => [{'seasonDbId' => undef,'season' => undef,'year' => '2017'}],'value' => '1259.08'},{'value' => '17.38275','collector' => 'johndoe','season' => [{'year' => '2017','season' => undef,'seasonDbId' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77553','observationDbId' => '740340','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007'},{'value' => '192.1495','collector' => 'johndoe','season' => [{'year' => '2017','season' => undef,'seasonDbId' => undef}],'observationDbId' => '740341','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77549','observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003'},{'value' => '67.9959','collector' => 'johndoe','observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationVariableDbId' => '77552','observationDbId' => '740342','observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'year' => '2017','season' => undef,'seasonDbId' => undef}]},{'collector' => 'johndoe','season' => [{'seasonDbId' => undef,'season' => undef,'year' => '2017'}],'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77550','observationDbId' => '740343','value' => '20.3038'},{'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationVariableDbId' => '77551','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740344','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'collector' => 'johndoe','value' => '102.0875'},{'collector' => 'johndoe','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationDbId' => '740345','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77558','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','value' => '108.56995'},{'season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationVariableDbId' => '77554','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740346','collector' => 'johndoe','value' => '28.83915'},{'value' => '379.16','collector' => 'johndoe','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740347','observationVariableDbId' => '77555','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}]}],'additionalInfo' => undef,'Y' => undef,'observationLevel' => 'plot','studyLocationDbId' => '23','studyDbId' => '165'}]},'metadata' => {'pagination' => {'currentPage' => 0,'totalPages' => 977,'pageSize' => 2,'totalCount' => 1954},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=2'},{'message' => 'Loading CXGN::BrAPI::v1::ObservationUnits','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Phenotype search result constructed'}],'datafiles' => []}}, 'phenotype search');

$mech->post_ok('http://localhost:3010/brapi/v1/search/observationunits?access_token='.$access_token, ['pageSize'=>'2']);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultsDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v1/search/observationunits/'. $searchId . '?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'locationName' => 'test_location','plantNumber' => undef,'germplasmName' => 'IITA-TMS-IBA980581','observationUnitName' => 'CASS_6Genotypes_103','locationDbId' => '23','studyDbId' => '165','studyLocationDbId' => '23','observationLevel' => 'plot','additionalInfo' => undef,'Y' => undef,'observations' => [{'value' => '601.518','collector' => 'johndoe','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740336','observationVariableDbId' => '77559'},{'season' => [{'seasonDbId' => undef,'season' => undef,'year' => '2017'}],'observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','observationDbId' => '740337','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77557','value' => '39.84365','collector' => 'johndoe'},{'collector' => 'johndoe','season' => [{'year' => '2017','season' => undef,'seasonDbId' => undef}],'observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationDbId' => '740338','observationVariableDbId' => '77556','observationTimeStamp' => 'NA2017-04-21_21:11:28','value' => '655.92'},{'value' => '1259.08','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationDbId' => '740339','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77548','collector' => 'johndoe'},{'observationVariableDbId' => '77553','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740340','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','season' => [{'year' => '2017','season' => undef,'seasonDbId' => undef}],'collector' => 'johndoe','value' => '17.38275'},{'collector' => 'johndoe','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationDbId' => '740341','observationVariableDbId' => '77549','observationTimeStamp' => 'NA2017-04-21_21:11:28','value' => '192.1495'},{'collector' => 'johndoe','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableDbId' => '77552','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740342','observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','value' => '67.9959'},{'season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationVariableDbId' => '77550','observationDbId' => '740343','observationTimeStamp' => 'NA2017-04-21_21:11:28','collector' => 'johndoe','value' => '20.3038'},{'value' => '102.0875','observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationDbId' => '740344','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77551','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'collector' => 'johndoe'},{'observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationVariableDbId' => '77558','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740345','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'collector' => 'johndoe','value' => '108.56995'},{'value' => '28.83915','collector' => 'johndoe','season' => [{'year' => '2017','season' => undef,'seasonDbId' => undef}],'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77554','observationDbId' => '740346'},{'season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableDbId' => '77555','observationDbId' => '740347','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','collector' => 'johndoe','value' => '379.16'}],'plotNumber' => '103','programName' => 'test','germplasmDbId' => '41283','replicate' => '1','studyName' => 'CASS_6Genotypes_Sampling_2015','entryType' => 'test','observationUnitDbId' => '41284','pedigree' => undef,'X' => undef,'studyLocation' => 'test_location','observationUnitXref' => [],'entryNumber' => '','treatments' => [{'modality' => '','factor' => 'No ManagementFactor'}],'blockNumber' => '1','observationUnitPosition' => {'entryType' => 'test','geoCoordinates' => undef,'observationLevelRelationships' => [{'levelOrder' => 0,'levelName' => 'replicate','levelCode' => '1'},{'levelName' => 'block','levelOrder' => 1,'levelCode' => '1'},{'levelName' => 'plot','levelOrder' => 2,'levelCode' => '103'}],'positionCoordinateX' => undef,'positionCoordinateYType' => 'GRID_ROW','observationLevel' => {'levelOrder' => 2,'levelName' => 'plot','levelCode' => '103'},'positionCoordinateXType' => 'GRID_COL','positionCoordinateY' => undef},'observationLevels' => 'plot'}]},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=2'},{'message' => 'Loading CXGN::BrAPI::v1::ObservationUnits','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Phenotype search result constructed'}],'pagination' => {'pageSize' => 2,'totalCount' => 1954,'currentPage' => 0,'totalPages' => 977},'datafiles' => []}}, 'phenotype search');

$mech->get_ok('http://localhost:3010/brapi/v1/phenotypes-search?pageSize=2&studyDbId=165&observationVariableDbId=77551&access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 10,'currentPage' => 0,'totalCount' => 19,'pageSize' => 2},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=2'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::ObservationUnits'},{'messageType' => 'INFO','message' => 'Phenotype search result constructed'}],'datafiles' => []},'result' => {'data' => [{'locationName' => 'test_location','observationUnitName' => 'CASS_6Genotypes_103','locationDbId' => '23','plantNumber' => undef,'germplasmName' => 'IITA-TMS-IBA980581','studyLocationDbId' => '23','observationLevel' => 'plot','studyDbId' => '165','Y' => undef,'additionalInfo' => undef,'observations' => [{'season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableDbId' => '77559','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740336','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','value' => '601.518','collector' => 'johndoe'},{'value' => '39.84365','collector' => 'johndoe','season' => [{'year' => '2017','season' => undef,'seasonDbId' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77557','observationDbId' => '740337','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011'},{'value' => '655.92','observationDbId' => '740338','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77556','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'collector' => 'johndoe'},{'collector' => 'johndoe','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77548','observationDbId' => '740339','value' => '1259.08'},{'observationVariableDbId' => '77553','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740340','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'collector' => 'johndoe','value' => '17.38275'},{'collector' => 'johndoe','observationVariableDbId' => '77549','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740341','observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'value' => '192.1495'},{'season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationVariableDbId' => '77552','observationDbId' => '740342','observationTimeStamp' => 'NA2017-04-21_21:11:28','collector' => 'johndoe','value' => '67.9959'},{'season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationDbId' => '740343','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77550','value' => '20.3038','collector' => 'johndoe'},{'season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationVariableDbId' => '77551','observationDbId' => '740344','observationTimeStamp' => 'NA2017-04-21_21:11:28','collector' => 'johndoe','value' => '102.0875'},{'value' => '108.56995','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77558','observationDbId' => '740345','season' => [{'seasonDbId' => undef,'season' => undef,'year' => '2017'}],'collector' => 'johndoe'},{'season' => [{'year' => '2017','season' => undef,'seasonDbId' => undef}],'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationDbId' => '740346','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableDbId' => '77554','value' => '28.83915','collector' => 'johndoe'},{'collector' => 'johndoe','value' => '379.16','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740347','observationVariableDbId' => '77555','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}]}],'programName' => 'test','germplasmDbId' => '41283','replicate' => '1','plotNumber' => '103','studyName' => 'CASS_6Genotypes_Sampling_2015','entryType' => 'test','X' => undef,'studyLocation' => 'test_location','observationUnitXref' => [],'observationUnitDbId' => '41284','pedigree' => undef,'entryNumber' => '','treatments' => [{'factor' => 'No ManagementFactor','modality' => ''}],'blockNumber' => '1','observationUnitPosition' => {'positionCoordinateY' => undef,'positionCoordinateXType' => 'GRID_COL','observationLevel' => {'levelCode' => '103','levelName' => 'plot','levelOrder' => 2},'positionCoordinateYType' => 'GRID_ROW','observationLevelRelationships' => [{'levelOrder' => 0,'levelName' => 'replicate','levelCode' => '1'},{'levelCode' => '1','levelOrder' => 1,'levelName' => 'block'},{'levelCode' => '103','levelName' => 'plot','levelOrder' => 2}],'positionCoordinateX' => undef,'geoCoordinates' => undef,'entryType' => 'test'},'observationLevels' => 'plot'}]}}, 'phenotype search study 165');

$mech->get_ok('http://localhost:3010/brapi/v1/traits?pageSize=1&page=1&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'totalCount' => 323,'pageSize' => 1,'totalPages' => 323,'currentPage' => 1},'status' => [{'message' => 'BrAPI base call found with page=1, pageSize=1','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v1::Traits'},{'messageType' => 'INFO','message' => 'Traits list result constructed'}]},'result' => {'data' => [{'traitName' => 'amylopectin content ug/g in percentage','description' => 'Estimation of amylopectin content of cassava roots in percentage(%).','traitId' => 'CO_334:0000121','observationVariables' => ['amylopectin content ug/g in percentage|CO_334:0000121'],'defaultValue' => '','name' => 'amylopectin content ug/g in percentage','traitDbId' => '70761'}]}}, 'traits');

# $mech->get_ok('http://localhost:3010/brapi/v1/maps?pageSize=1&page=1&access_token='.$access_token );
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'totalCount' => 1,'currentPage' => 1,'pageSize' => 1,'totalPages' => 1},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=1, pageSize=1'},{'message' => 'Loading CXGN::BrAPI::v1::GenomeMaps','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Maps list result constructed'}]},'result' => {'data' => [{'markerCount' => '0','species' => 'Solanum lycopersicum','name' => 'Tomato Pachytene Chromosomes','unit' => 'cM','type' => 'Genetic','linkageGroupCount' => 12,'comments' => 'This map shows the pachytene chromosomes of tomato. It is only for illustrative purposes and does not contain any markers. <br /><br />Images courtesy of Prof. Stephen Stack, Colorado State University.','mapDbId' => 'pachy'}]}}, 'maps');

$mech->get_ok('http://localhost:3010/brapi/v1/locations?pageSize=1&page=1&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalCount' => 4,'totalPages' => 4,'pageSize' => 1,'currentPage' => 1},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=1, pageSize=1'},{'message' => 'Loading CXGN::BrAPI::v1::Locations','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Locations list result constructed'}]},'result' => {'data' => [{'documentationURL' => undef,'locationDbId' => '24','locationType' => '','countryCode' => 'USA','countryName' => 'United States','longitude' => '-76.4735','abbreviation' => '','locationName' => 'Cornell Biotech','altitude' => '274','name' => 'Cornell Biotech','instituteName' => '','instituteAddress' => '','latitude' => '42.45345','additionalInfo' => {'geodetic datum' => undef,'breeding_program' => '134'}}]}}, 'location');

# $mech->get_ok('http://localhost:3010/brapi/v1/ontologies?access_token='.$access_token );
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# is_deeply($response, {"metadata"=>{"datafiles"=>[],"status"=>[{"message"=>"BrAPI base call found with page=0, pageSize=10","messageType"=>"INFO"},{"messageType"=>"INFO","message"=>"Loading CXGN::BrAPI::v1::ObservationVariables"},{"message"=>"Ontologies result constructed","messageType"=>"INFO"}],"pagination"=>{"totalPages"=>1,"totalCount"=>2,"pageSize"=>10,"currentPage"=>0}},"result"=>{"data"=>[{"description"=>"CGIAR cassava trait ontology","copyright"=>"","ontologyName"=>"CO_334","version"=>"","authors"=>"","ontologyDbId"=>"186","ontologyDbxrefAccession"=>"0000000","licence"=>""},{"copyright"=>"","description"=>"fieldbook_image","ontologyName"=>"CO_334","authors"=>"","version"=>"","ontologyDbxrefAccession"=>"0010472","licence"=>"","ontologyDbId"=>"186"}]}}, 'ontologies');

$mech->get_ok('http://localhost:3010/brapi/v1/variables?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 10,'totalCount' => 323,'totalPages' => 33,'currentPage' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::ObservationVariables','messageType' => 'INFO'},{'message' => 'Observationvariable search result constructed','messageType' => 'INFO'}]},'result' => {'data' => [{'ontologyDbId' => '186','ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'synonyms' => ['"abscon" EXACT []','"AbsCt_Meas_ugg" EXACT []'],'observationVariableName' => 'abscisic acid content of leaf ug/g','language' => '','xref' => 'CO_334:0000047','submissionTimestamp' => undef,'contextOfUse' => [],'observationVariableDbId' => 70692,'growthStage' => '','trait' => {'ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'synonyms' => ['"abscon" EXACT []','"AbsCt_Meas_ugg" EXACT []'],'description' => 'Abscisic acid content of leaf sample.','entity' => '','alternativeAbbreviations' => [],'traitName' => 'abscisic acid content of leaf ug/g','xref' => 'CO_334:0000047','traitDbId' => 'CO_334:0000047','attribute' => 'abscisic acid content of leaf ug/g','mainAbbreviations' => '','status' => '','name' => 'abscisic acid content of leaf ug/g','class' => ''},'documentationURL' => '','name' => 'abscisic acid content of leaf ug/g|CO_334:0000047','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'ontologyName' => 'CO_334','method' => {'description' => '','name' => '','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'reference' => '','methodName' => '','class' => '','formula' => '','methodDbId' => ''},'scientist' => '','crop' => 'Cassava','scale' => {'scaleDbId' => '','decimalPlaces' => undef,'xref' => '','scaleName' => '','name' => '','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => ''},'validValues' => {'max' => undef,'min' => undef,'categories' => []},'dataType' => ''},'institution' => 'http://localhost:3010'},{'observationVariableDbId' => 70761,'trait' => {'class' => '','name' => 'amylopectin content ug/g in percentage','status' => '','mainAbbreviations' => '','xref' => 'CO_334:0000121','traitDbId' => 'CO_334:0000121','attribute' => 'amylopectin content ug/g in percentage','traitName' => 'amylopectin content ug/g in percentage','description' => 'Estimation of amylopectin content of cassava roots in percentage(%).','alternativeAbbreviations' => [],'entity' => '','ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'synonyms' => ['"amylp" EXACT []','"AmylPCt_Meas_pct" EXACT []']},'growthStage' => '','contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'CO_334:0000121','observationVariableName' => 'amylopectin content ug/g in percentage','language' => '','ontologyDbId' => '186','synonyms' => ['"amylp" EXACT []','"AmylPCt_Meas_pct" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '186'},'scale' => {'scaleDbId' => '','decimalPlaces' => undef,'xref' => '','scaleName' => '','name' => '','validValues' => {'max' => undef,'min' => undef,'categories' => []},'ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'dataType' => ''},'crop' => 'Cassava','institution' => 'http://localhost:3010','scientist' => '','ontologyName' => 'CO_334','method' => {'reference' => '','methodDbId' => '','description' => '','class' => '','name' => '','methodName' => '','formula' => '','ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'}},'name' => 'amylopectin content ug/g in percentage|CO_334:0000121','documentationURL' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => ''},{'observationVariableDbId' => 70752,'trait' => {'class' => '','mainAbbreviations' => '','name' => 'amylose amylopectin root content ratio','status' => '','traitName' => 'amylose amylopectin root content ratio','traitDbId' => 'CO_334:0000124','xref' => 'CO_334:0000124','attribute' => 'amylose amylopectin root content ratio','description' => 'The amylose content of a cassava root sample divided by the amylopectin content of the same sample.','entity' => '','alternativeAbbreviations' => [],'synonyms' => ['"amylrt" EXACT []','"AmylR_Comp_r" EXACT []'],'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'}},'growthStage' => '','contextOfUse' => [],'xref' => 'CO_334:0000124','submissionTimestamp' => undef,'language' => '','observationVariableName' => 'amylose amylopectin root content ratio','ontologyDbId' => '186','ontologyReference' => {'ontologyName' => 'CO_334','ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''}},'synonyms' => ['"amylrt" EXACT []','"AmylR_Comp_r" EXACT []'],'scale' => {'xref' => '','scaleDbId' => '','decimalPlaces' => undef,'scaleName' => '','validValues' => {'categories' => [],'min' => undef,'max' => undef},'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'name' => '','dataType' => ''},'crop' => 'Cassava','institution' => 'http://localhost:3010','scientist' => '','ontologyName' => 'CO_334','method' => {'methodDbId' => '','formula' => '','methodName' => '','class' => '','reference' => '','ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'name' => '','description' => ''},'name' => 'amylose amylopectin root content ratio|CO_334:0000124','documentationURL' => '','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' )},{'submissionTimestamp' => undef,'xref' => 'CO_334:0000075','contextOfUse' => [],'growthStage' => '','trait' => {'attribute' => 'amylose content in ug/g percentage','traitDbId' => 'CO_334:0000075','xref' => 'CO_334:0000075','traitName' => 'amylose content in ug/g percentage','entity' => '','alternativeAbbreviations' => [],'description' => 'Estimation of amylose content of cassava roots in percentage (%).','synonyms' => ['"amyl" EXACT []','"AmylCt_Meas_pct" EXACT []'],'ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'class' => '','name' => 'amylose content in ug/g percentage','status' => '','mainAbbreviations' => ''},'observationVariableDbId' => 70676,'synonyms' => ['"amyl" EXACT []','"AmylCt_Meas_pct" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'ontologyDbId' => '186','language' => '','observationVariableName' => 'amylose content in ug/g percentage','scientist' => '','institution' => 'http://localhost:3010','scale' => {'scaleName' => '','decimalPlaces' => undef,'scaleDbId' => '','xref' => '','dataType' => '','name' => '','ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'validValues' => {'categories' => [],'min' => undef,'max' => undef}},'crop' => 'Cassava','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','documentationURL' => '','name' => 'amylose content in ug/g percentage|CO_334:0000075','method' => {'methodDbId' => '','class' => '','methodName' => '','formula' => '','reference' => '','name' => '','description' => '','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''}},'ontologyName' => 'CO_334'},{'ontologyDbId' => '186','synonyms' => ['"anther" EXACT []','"AnthCol_VisClsn_1to5" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''}},'observationVariableName' => 'anther color','language' => '','contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'CO_334:0000061','observationVariableDbId' => 70717,'trait' => {'traitName' => 'anther color','xref' => 'CO_334:0000061','traitDbId' => 'CO_334:0000061','attribute' => 'anther color','class' => '','mainAbbreviations' => '','status' => '','synonyms' => ['"anther" EXACT []','"AnthCol_VisClsn_1to5" EXACT []'],'ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'description' => 'Visual scoring of anther color with 1 = cream, 2 = yellow, and 3 = other.','alternativeAbbreviations' => [],'name' => 'anther color','entity' => ''},'growthStage' => '','name' => 'anther color|CO_334:0000061','documentationURL' => '','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'ontologyName' => 'CO_334','method' => {'reference' => '','ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'name' => '','description' => '','methodDbId' => '','formula' => '','methodName' => '','class' => ''},'scientist' => '','crop' => 'Cassava','scale' => {'scaleDbId' => '','decimalPlaces' => undef,'xref' => '','scaleName' => '','name' => '','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => ''},'validValues' => {'categories' => [],'min' => undef,'max' => undef},'dataType' => ''},'institution' => 'http://localhost:3010'},{'observationVariableDbId' => 78315,'growthStage' => '','trait' => {'class' => '','mainAbbreviations' => '','name' => 'Anthesis [date]','status' => '','traitName' => 'Anthesis [date]','xref' => 'G2F:0000047','traitDbId' => 'G2F:0000047','attribute' => 'Anthesis [date]','description' => 'Date of anthesis in MM/DD/YY format.','alternativeAbbreviations' => [],'entity' => '','synonyms' => [undef],'ontologyReference' => {'ontologyName' => 'G2F','documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '309','version' => ''}},'xref' => 'G2F:0000047','submissionTimestamp' => undef,'contextOfUse' => [],'observationVariableName' => 'Anthesis [date]','language' => '','ontologyDbId' => '309','synonyms' => [undef],'ontologyReference' => {'ontologyName' => 'G2F','documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '309','version' => ''},'crop' => 'Cassava','scale' => {'dataType' => '','ontologyReference' => {'ontologyName' => 'G2F','documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '309'},'validValues' => {'max' => undef,'min' => undef,'categories' => []},'name' => '','scaleName' => '','xref' => '','decimalPlaces' => undef,'scaleDbId' => ''},'institution' => 'http://localhost:3010','scientist' => '','ontologyName' => 'G2F','method' => {'methodDbId' => '','formula' => '','methodName' => '','class' => '','reference' => '','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '309','version' => '','ontologyName' => 'G2F'},'description' => '','name' => ''},'documentationURL' => '','name' => 'Anthesis [date]|G2F:0000047','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' )},{'growthStage' => '','trait' => {'traitName' => 'anthocyanin pigmentation visual rating 0-3','xref' => 'CO_334:0000103','traitDbId' => 'CO_334:0000103','attribute' => 'anthocyanin pigmentation visual rating 0-3','class' => '','mainAbbreviations' => '','status' => '','synonyms' => ['"anthop" EXACT []','"ACyanPig_VisScg_0to3" EXACT []'],'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'description' => 'Visual rating of distribution of anthocyanin pigmentation with 0 = absent, 1 = top part, 2 = central part, 3 = totally pigmented.','alternativeAbbreviations' => [],'entity' => '','name' => 'anthocyanin pigmentation visual rating 0-3'},'observationVariableDbId' => 70775,'xref' => 'CO_334:0000103','submissionTimestamp' => undef,'contextOfUse' => [],'language' => '','observationVariableName' => 'anthocyanin pigmentation visual rating 0-3','ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'synonyms' => ['"anthop" EXACT []','"ACyanPig_VisScg_0to3" EXACT []'],'ontologyDbId' => '186','institution' => 'http://localhost:3010','scale' => {'scaleName' => '','decimalPlaces' => undef,'scaleDbId' => '','xref' => '','dataType' => '','name' => '','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'validValues' => {'max' => undef,'min' => undef,'categories' => []}},'crop' => 'Cassava','scientist' => '','method' => {'reference' => '','name' => '','description' => '','ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''}},'methodDbId' => '','methodName' => '','class' => '','formula' => ''},'ontologyName' => 'CO_334','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','documentationURL' => '','name' => 'anthocyanin pigmentation visual rating 0-3|CO_334:0000103'},{'ontologyDbId' => '186','synonyms' => ['"brntim" EXACT []','"FstBrnchTim_Count_wk" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'language' => '','observationVariableName' => 'apical branching','xref' => 'CO_334:0000086','submissionTimestamp' => undef,'contextOfUse' => [],'observationVariableDbId' => 70693,'growthStage' => '','trait' => {'mainAbbreviations' => '','status' => '','name' => 'apical branching','class' => '','synonyms' => ['"brntim" EXACT []','"FstBrnchTim_Count_wk" EXACT []'],'ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'description' => 'Number of weeks from planting to first apical branching associated with the formation of inflorescence.','entity' => '','alternativeAbbreviations' => [],'traitName' => 'apical branching','traitDbId' => 'CO_334:0000086','xref' => 'CO_334:0000086','attribute' => 'apical branching'},'documentationURL' => '','name' => 'apical branching|CO_334:0000086','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','ontologyName' => 'CO_334','method' => {'formula' => '','class' => '','methodName' => '','methodDbId' => '','ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''}},'description' => '','name' => '','reference' => ''},'scientist' => '','crop' => 'Cassava','scale' => {'validValues' => {'categories' => [],'min' => undef,'max' => undef},'ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'name' => '','dataType' => '','xref' => '','decimalPlaces' => undef,'scaleDbId' => '','scaleName' => ''},'institution' => 'http://localhost:3010'},{'scientist' => '','institution' => 'http://localhost:3010','scale' => {'validValues' => {'categories' => [],'max' => undef,'min' => undef},'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => ''},'name' => '','dataType' => '','xref' => '','decimalPlaces' => undef,'scaleDbId' => '','scaleName' => ''},'crop' => 'Cassava','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'name' => 'apical pubescence|CO_334:0000026','documentationURL' => '','method' => {'methodName' => '','class' => '','formula' => '','methodDbId' => '','name' => '','description' => '','ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'reference' => ''},'ontologyName' => 'CO_334','contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'CO_334:0000026','trait' => {'entity' => '','alternativeAbbreviations' => [],'description' => 'Visual rating of young leaf pubescence with 0 = absent or glabrous, 3 = little pubescence, 5 = moderate pubescence, and 7 = high pubescence.','synonyms' => ['"apubes" EXACT []','"LfPub_VisClsn_0to7" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''}},'attribute' => 'apical pubescence','traitDbId' => 'CO_334:0000026','xref' => 'CO_334:0000026','traitName' => 'apical pubescence','name' => 'apical pubescence','status' => '','mainAbbreviations' => '','class' => ''},'growthStage' => '','observationVariableDbId' => 70743,'synonyms' => ['"apubes" EXACT []','"LfPub_VisClsn_0to7" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'ontologyDbId' => '186','observationVariableName' => 'apical pubescence','language' => ''},{'name' => 'ascorbic acid in root percentage|CO_334:0000065','documentationURL' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','ontologyName' => 'CO_334','method' => {'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'name' => '','description' => '','reference' => '','formula' => '','class' => '','methodName' => '','methodDbId' => ''},'scientist' => '','crop' => 'Cassava','scale' => {'scaleName' => '','xref' => '','scaleDbId' => '','decimalPlaces' => undef,'dataType' => '','ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'validValues' => {'categories' => [],'min' => undef,'max' => undef},'name' => ''},'institution' => 'http://localhost:3010','ontologyDbId' => '186','ontologyReference' => {'ontologyName' => 'CO_334','ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''}},'synonyms' => ['"AscACt_Meas_pct" EXACT []'],'language' => '','observationVariableName' => 'ascorbic acid in root percentage','contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'CO_334:0000065','observationVariableDbId' => 70739,'trait' => {'status' => '','name' => 'ascorbic acid in root percentage','mainAbbreviations' => '','class' => '','synonyms' => ['"AscACt_Meas_pct" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'entity' => '','alternativeAbbreviations' => [],'description' => 'Antioxidant and water soluble vitamin of cassava storage root.','attribute' => 'ascorbic acid in root percentage','traitDbId' => 'CO_334:0000065','xref' => 'CO_334:0000065','traitName' => 'ascorbic acid in root percentage'},'growthStage' => ''}]}}, 'variables');

$mech->get_ok('http://localhost:3010/brapi/v1/variables-search?page=24&access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'observationVariableDbId' => 70664,'growthStage' => '','trait' => {'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'synonyms' => ['"rsmi" EXACT []','"RSMInc_Comp_r" EXACT []'],'entity' => '','alternativeAbbreviations' => [],'description' => 'Proportion of plants within a plot showing evidence of colonization by red spider mite.','traitName' => 'red spider mite incidence by proportion','attribute' => 'red spider mite incidence by proportion','xref' => 'CO_334:0000045','traitDbId' => 'CO_334:0000045','mainAbbreviations' => '','status' => '','name' => 'red spider mite incidence by proportion','class' => ''},'submissionTimestamp' => undef,'xref' => 'CO_334:0000045','contextOfUse' => [],'language' => '','observationVariableName' => 'red spider mite incidence by proportion','ontologyDbId' => '186','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'synonyms' => ['"rsmi" EXACT []','"RSMInc_Comp_r" EXACT []'],'crop' => 'Cassava','scale' => {'ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'validValues' => {'max' => undef,'min' => undef,'categories' => []},'name' => '','dataType' => '','xref' => '','scaleDbId' => '','decimalPlaces' => undef,'scaleName' => ''},'institution' => 'http://localhost:3010','scientist' => '','ontologyName' => 'CO_334','method' => {'reference' => '','ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'description' => '','name' => '','methodDbId' => '','formula' => '','methodName' => '','class' => ''},'documentationURL' => '','name' => 'red spider mite incidence by proportion|CO_334:0000045','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' )},{'observationVariableName' => 'red spider mite severity : visual 1-5','language' => '','ontologyDbId' => '186','ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'synonyms' => ['"rsms" EXACT []','"RSMSev_VisScg_1to5" EXACT []'],'observationVariableDbId' => 70696,'growthStage' => '','trait' => {'class' => '','mainAbbreviations' => '','status' => '','name' => 'red spider mite severity : visual 1-5','traitName' => 'red spider mite severity : visual 1-5','attribute' => 'red spider mite severity : visual 1-5','traitDbId' => 'CO_334:0000044','xref' => 'CO_334:0000044','ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'synonyms' => ['"rsms" EXACT []','"RSMSev_VisScg_1to5" EXACT []'],'entity' => '','alternativeAbbreviations' => [],'description' => 'Visual rating of damage caused by red spider mite, Oligonychus gossypii and Tetranychus spp. Symptoms rated from 1 = (clean, no infection) to 5 = (extremely severe, severely damaged).'},'xref' => 'CO_334:0000044','submissionTimestamp' => undef,'contextOfUse' => [],'ontologyName' => 'CO_334','method' => {'methodDbId' => '','formula' => '','class' => '','methodName' => '','reference' => '','ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'description' => '','name' => ''},'documentationURL' => '','name' => 'red spider mite severity : visual 1-5|CO_334:0000044','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'scale' => {'dataType' => '','validValues' => {'min' => undef,'max' => undef,'categories' => []},'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'name' => '','scaleName' => '','xref' => '','scaleDbId' => '','decimalPlaces' => undef},'crop' => 'Cassava','institution' => 'http://localhost:3010','scientist' => ''},{'ontologyName' => 'CO_334','method' => {'description' => '','name' => '','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'reference' => '','methodName' => '','class' => '','formula' => '','methodDbId' => ''},'documentationURL' => '','name' => 'root color|CO_334:0000221','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','scale' => {'dataType' => '','name' => '','validValues' => {'categories' => [],'max' => undef,'min' => undef},'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '186'},'scaleName' => '','scaleDbId' => '','decimalPlaces' => undef,'xref' => ''},'crop' => 'Cassava','institution' => 'http://localhost:3010','scientist' => '','observationVariableName' => 'root color','language' => '','ontologyDbId' => '186','synonyms' => ['"rtcol" EXACT []','"RtSurfCol_ClsnCIAT_1to3" EXACT []'],'ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'observationVariableDbId' => 76538,'growthStage' => '','trait' => {'class' => '','xref' => 'CO_334:0000221','traitDbId' => 'CO_334:0000221','attribute' => 'root color','traitName' => 'root color','description' => 'Visual rating of storage root surface color with 1 = white , 2 = intermediate, and 3 = dark brown, as being evaluated by CIAT.','entity' => '','alternativeAbbreviations' => [],'name' => 'root color','status' => '','synonyms' => ['"rtcol" EXACT []','"RtSurfCol_ClsnCIAT_1to3" EXACT []'],'ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'mainAbbreviations' => ''},'submissionTimestamp' => undef,'xref' => 'CO_334:0000221','contextOfUse' => []},{'method' => {'name' => '','description' => '','ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'reference' => '','class' => '','methodName' => '','formula' => '','methodDbId' => ''},'ontologyName' => 'CO_334','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','documentationURL' => '','name' => 'root constriction|CO_334:0000109','institution' => 'http://localhost:3010','crop' => 'Cassava','scale' => {'scaleDbId' => '','decimalPlaces' => undef,'xref' => '','scaleName' => '','name' => '','validValues' => {'min' => undef,'max' => undef,'categories' => []},'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => ''},'dataType' => ''},'scientist' => '','observationVariableName' => 'root constriction','language' => '','synonyms' => ['"rtcon" EXACT []','"RtConsNo_Est_1to3" EXACT []'],'ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'ontologyDbId' => '186','growthStage' => '','trait' => {'alternativeAbbreviations' => [],'entity' => '','description' => 'Visual ratings of root constrcitions (1 = few, 2 = intermediate, 3 = many) as being evaluated by CIAT.','synonyms' => ['"rtcon" EXACT []','"RtConsNo_Est_1to3" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'attribute' => 'root constriction','xref' => 'CO_334:0000109','traitDbId' => 'CO_334:0000109','traitName' => 'root constriction','name' => 'root constriction','status' => '','mainAbbreviations' => '','class' => ''},'observationVariableDbId' => 70747,'submissionTimestamp' => undef,'xref' => 'CO_334:0000109','contextOfUse' => []},{'ontologyDbId' => '186','synonyms' => ['"rteval" EXACT []','"RtEval_Est_1to5" EXACT []'],'ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'language' => '','observationVariableName' => 'root evaluation scaled 1-5','xref' => 'CO_334:0000228','submissionTimestamp' => undef,'contextOfUse' => [],'observationVariableDbId' => 76673,'growthStage' => '','trait' => {'synonyms' => ['"rteval" EXACT []','"RtEval_Est_1to5" EXACT []'],'ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'description' => 'An evaluation of the integration of  root shape, size, diameter, constriction, neck length on a scale of 1-5 with 1=very good; 5=very bad. Before scoring the roots, the field technician walks the harvested plot to get an idea of the average root type of the trial which will then be used as a score of 3. Genotypes better than average will be scored 2 and 1 in that order. Similiar genotype that are certainly worse compared to the average score are rated 4 and 5 in that order. Trait description is provided by Hernan Ceballos of CIAT.','entity' => '','alternativeAbbreviations' => [],'traitName' => 'root evaluation scaled 1-5','xref' => 'CO_334:0000228','traitDbId' => 'CO_334:0000228','attribute' => 'root evaluation scaled 1-5','mainAbbreviations' => '','status' => '','name' => 'root evaluation scaled 1-5','class' => ''},'documentationURL' => '','name' => 'root evaluation scaled 1-5|CO_334:0000228','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'ontologyName' => 'CO_334','method' => {'reference' => '','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'name' => '','description' => '','methodDbId' => '','formula' => '','methodName' => '','class' => ''},'scientist' => '','crop' => 'Cassava','scale' => {'name' => '','ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'validValues' => {'min' => undef,'max' => undef,'categories' => []},'dataType' => '','scaleDbId' => '','decimalPlaces' => undef,'xref' => '','scaleName' => ''},'institution' => 'http://localhost:3010'},{'observationVariableName' => 'root flesh color','language' => '','synonyms' => ['"rtfcol" EXACT []','"PlpCol_ClsnCIAT_1to3" EXACT []'],'ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'ontologyDbId' => '186','trait' => {'class' => '','mainAbbreviations' => '','name' => 'root flesh color','status' => '','traitName' => 'root flesh color','xref' => 'CO_334:0000222','traitDbId' => 'CO_334:0000222','attribute' => 'root flesh color','description' => 'Visual rating of root pulp color with 1 = white, 2 = cream, 3 = yellow, as being evaluated by CIAT.','alternativeAbbreviations' => [],'entity' => '','synonyms' => ['"rtfcol" EXACT []','"PlpCol_ClsnCIAT_1to3" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''}},'growthStage' => '','observationVariableDbId' => 76775,'contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'CO_334:0000222','method' => {'methodDbId' => '','formula' => '','methodName' => '','class' => '','reference' => '','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186'},'description' => '','name' => ''},'ontologyName' => 'CO_334','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'name' => 'root flesh color|CO_334:0000222','documentationURL' => '','institution' => 'http://localhost:3010','scale' => {'name' => '','validValues' => {'min' => undef,'max' => undef,'categories' => []},'ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'dataType' => '','scaleDbId' => '','decimalPlaces' => undef,'xref' => '','scaleName' => ''},'crop' => 'Cassava','scientist' => ''},{'ontologyDbId' => '186','synonyms' => ['"rtlgt" EXACT []','"RtLng_Est_1to3" EXACT []'],'ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'observationVariableName' => 'root length evaluation scaled 1-3','language' => '','submissionTimestamp' => undef,'xref' => 'CO_334:0000226','contextOfUse' => [],'observationVariableDbId' => 76792,'growthStage' => '','trait' => {'description' => 'Visual assessment of the root length on a scale of 1, 2, 3 (1=short;  2= intermediate; 3=long)','alternativeAbbreviations' => [],'entity' => '','ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'synonyms' => ['"rtlgt" EXACT []','"RtLng_Est_1to3" EXACT []'],'traitDbId' => 'CO_334:0000226','xref' => 'CO_334:0000226','attribute' => 'root length evaluation scaled 1-3','traitName' => 'root length evaluation scaled 1-3','name' => 'root length evaluation scaled 1-3','status' => '','mainAbbreviations' => '','class' => ''},'documentationURL' => '','name' => 'root length evaluation scaled 1-3|CO_334:0000226','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','ontologyName' => 'CO_334','method' => {'methodName' => '','class' => '','formula' => '','methodDbId' => '','name' => '','description' => '','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'reference' => ''},'scientist' => '','crop' => 'Cassava','scale' => {'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '186'},'validValues' => {'categories' => [],'max' => undef,'min' => undef},'name' => '','dataType' => '','xref' => '','decimalPlaces' => undef,'scaleDbId' => '','scaleName' => ''},'institution' => 'http://localhost:3010'},{'ontologyName' => 'G2F','method' => {'ontologyReference' => {'ontologyName' => 'G2F','documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '309','version' => ''},'name' => '','description' => '','reference' => '','formula' => '','methodName' => '','class' => '','methodDbId' => ''},'name' => 'Root Lodging [plants]|G2F:0000007','documentationURL' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','scale' => {'ontologyReference' => {'ontologyName' => 'G2F','version' => '','ontologyDbId' => '309','documentationURL' => {'URL' => '','type' => ''}},'validValues' => {'max' => undef,'min' => undef,'categories' => []},'name' => '','dataType' => '','xref' => '','decimalPlaces' => undef,'scaleDbId' => '','scaleName' => ''},'crop' => 'Cassava','institution' => 'http://localhost:3010','scientist' => '','language' => '','observationVariableName' => 'Root Lodging [plants]','ontologyDbId' => '309','synonyms' => [undef],'ontologyReference' => {'ontologyName' => 'G2F','version' => '','ontologyDbId' => '309','documentationURL' => {'URL' => '','type' => ''}},'observationVariableDbId' => 78320,'trait' => {'mainAbbreviations' => '','synonyms' => [undef],'ontologyReference' => {'ontologyName' => 'G2F','ontologyDbId' => '309','version' => '','documentationURL' => {'type' => '','URL' => ''}},'status' => '','name' => 'Root Lodging [plants]','alternativeAbbreviations' => [],'entity' => '','description' => 'Number of plants that show root lodging per plot, i.e., those stems that lean substantially to one side (> 15% from vertical).  Count includes bgooseneckedb plants that have bstraightened upb after becoming lodged earlier in the season.','traitName' => 'Root Lodging [plants]','attribute' => 'Root Lodging [plants]','xref' => 'G2F:0000007','traitDbId' => 'G2F:0000007','class' => ''},'growthStage' => '','contextOfUse' => [],'xref' => 'G2F:0000007','submissionTimestamp' => undef},{'ontologyName' => 'CO_334','method' => {'ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'description' => '','name' => '','reference' => '','formula' => '','class' => '','methodName' => '','methodDbId' => ''},'documentationURL' => '','name' => 'root neck length|CO_334:0000022','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','crop' => 'Cassava','scale' => {'scaleName' => '','decimalPlaces' => undef,'scaleDbId' => '','xref' => '','dataType' => '','name' => '','ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'validValues' => {'categories' => [],'max' => undef,'min' => undef}},'institution' => 'http://localhost:3010','scientist' => '','observationVariableName' => 'root neck length','language' => '','ontologyDbId' => '186','synonyms' => ['"nklgt" EXACT []','"NkLng_VisClsn_0to7" EXACT []'],'ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'observationVariableDbId' => 70718,'growthStage' => '','trait' => {'traitName' => 'root neck length','xref' => 'CO_334:0000022','traitDbId' => 'CO_334:0000022','attribute' => 'root neck length','description' => 'Visual rating of root neck length with 0 = absent or sessile, 3 = short, 5 = intermediate, and 7 = long.','entity' => '','alternativeAbbreviations' => [],'synonyms' => ['"nklgt" EXACT []','"NkLng_VisClsn_0to7" EXACT []'],'ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'class' => '','mainAbbreviations' => '','name' => 'root neck length','status' => ''},'xref' => 'CO_334:0000022','submissionTimestamp' => undef,'contextOfUse' => []},{'institution' => 'http://localhost:3010','crop' => 'Cassava','scale' => {'decimalPlaces' => undef,'scaleDbId' => '','xref' => '','scaleName' => '','name' => '','validValues' => {'categories' => [],'max' => undef,'min' => undef},'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'dataType' => ''},'scientist' => '','method' => {'formula' => '','ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'methodName' => '','name' => '','class' => '','description' => '','methodDbId' => '','reference' => ''},'ontologyName' => 'CO_334','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','name' => 'root number counting|CO_334:0000011','documentationURL' => '','trait' => {'class' => '','status' => '','name' => 'root number counting','mainAbbreviations' => '','traitDbId' => 'CO_334:0000011','xref' => 'CO_334:0000011','attribute' => 'root number counting','traitName' => 'root number counting','synonyms' => ['"rtno" EXACT []','"NoHvstRt_Count_Rt" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'description' => 'A count of the total number of storage roots harvested per plot.','entity' => '','alternativeAbbreviations' => []},'growthStage' => '','observationVariableDbId' => 70706,'contextOfUse' => [],'xref' => 'CO_334:0000011','submissionTimestamp' => undef,'observationVariableName' => 'root number counting','language' => '','ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'synonyms' => ['"rtno" EXACT []','"NoHvstRt_Count_Rt" EXACT []'],'ontologyDbId' => '186'}]},'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=24, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::ObservationVariables','messageType' => 'INFO'},{'message' => 'Observationvariable search result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'pageSize' => 10,'totalCount' => 323,'totalPages' => 33,'currentPage' => 24}}}, 'variables-search');

$mech->post_ok('http://localhost:3010/brapi/v1/search/variables?access_token='.$access_token,['page'=>'24']);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultsDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v1/search/variables/'. $searchId . '?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'method' => {'methodDbId' => '','formula' => '','class' => '','methodName' => '','reference' => '','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'name' => '','description' => ''},'ontologyName' => 'CO_334','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','name' => 'red spider mite incidence by proportion|CO_334:0000045','documentationURL' => '','institution' => 'http://localhost:3010','crop' => 'Cassava','scale' => {'name' => '','validValues' => {'categories' => [],'max' => undef,'min' => undef},'ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'dataType' => '','scaleDbId' => '','decimalPlaces' => undef,'xref' => '','scaleName' => ''},'scientist' => '','language' => '','observationVariableName' => 'red spider mite incidence by proportion','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'synonyms' => ['"rsmi" EXACT []','"RSMInc_Comp_r" EXACT []'],'ontologyDbId' => '186','trait' => {'status' => '','synonyms' => ['"rsmi" EXACT []','"RSMInc_Comp_r" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'description' => 'Proportion of plants within a plot showing evidence of colonization by red spider mite.','alternativeAbbreviations' => [],'entity' => '','name' => 'red spider mite incidence by proportion','mainAbbreviations' => '','traitDbId' => 'CO_334:0000045','xref' => 'CO_334:0000045','attribute' => 'red spider mite incidence by proportion','class' => '','traitName' => 'red spider mite incidence by proportion'},'growthStage' => '','observationVariableDbId' => 70664,'contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'CO_334:0000045'},{'trait' => {'alternativeAbbreviations' => [],'entity' => '','description' => 'Visual rating of damage caused by red spider mite, Oligonychus gossypii and Tetranychus spp. Symptoms rated from 1 = (clean, no infection) to 5 = (extremely severe, severely damaged).','synonyms' => ['"rsms" EXACT []','"RSMSev_VisScg_1to5" EXACT []'],'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'traitName' => 'red spider mite severity : visual 1-5','attribute' => 'red spider mite severity : visual 1-5','traitDbId' => 'CO_334:0000044','xref' => 'CO_334:0000044','mainAbbreviations' => '','name' => 'red spider mite severity : visual 1-5','status' => '','class' => ''},'growthStage' => '','observationVariableDbId' => 70696,'contextOfUse' => [],'xref' => 'CO_334:0000044','submissionTimestamp' => undef,'observationVariableName' => 'red spider mite severity : visual 1-5','language' => '','ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'synonyms' => ['"rsms" EXACT []','"RSMSev_VisScg_1to5" EXACT []'],'ontologyDbId' => '186','institution' => 'http://localhost:3010','scale' => {'dataType' => '','name' => '','ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'validValues' => {'categories' => [],'max' => undef,'min' => undef},'scaleName' => '','scaleDbId' => '','decimalPlaces' => undef,'xref' => ''},'crop' => 'Cassava','scientist' => '','method' => {'reference' => '','name' => '','description' => '','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'methodDbId' => '','methodName' => '','class' => '','formula' => ''},'ontologyName' => 'CO_334','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'name' => 'red spider mite severity : visual 1-5|CO_334:0000044','documentationURL' => ''},{'scientist' => '','institution' => 'http://localhost:3010','scale' => {'decimalPlaces' => undef,'scaleDbId' => '','xref' => '','scaleName' => '','name' => '','validValues' => {'max' => undef,'min' => undef,'categories' => []},'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'dataType' => ''},'crop' => 'Cassava','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','name' => 'root color|CO_334:0000221','documentationURL' => '','method' => {'reference' => '','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'description' => '','name' => '','methodDbId' => '','formula' => '','methodName' => '','class' => ''},'ontologyName' => 'CO_334','contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'CO_334:0000221','trait' => {'name' => 'root color','status' => '','mainAbbreviations' => '','class' => '','alternativeAbbreviations' => [],'entity' => '','description' => 'Visual rating of storage root surface color with 1 = white , 2 = intermediate, and 3 = dark brown, as being evaluated by CIAT.','synonyms' => ['"rtcol" EXACT []','"RtSurfCol_ClsnCIAT_1to3" EXACT []'],'ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'attribute' => 'root color','xref' => 'CO_334:0000221','traitDbId' => 'CO_334:0000221','traitName' => 'root color'},'growthStage' => '','observationVariableDbId' => 76538,'ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'synonyms' => ['"rtcol" EXACT []','"RtSurfCol_ClsnCIAT_1to3" EXACT []'],'ontologyDbId' => '186','language' => '','observationVariableName' => 'root color'},{'documentationURL' => '','name' => 'root constriction|CO_334:0000109','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => '','ontologyName' => 'CO_334','method' => {'reference' => '','name' => '','description' => '','ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'methodDbId' => '','methodName' => '','class' => '','formula' => ''},'scientist' => '','scale' => {'scaleName' => '','decimalPlaces' => undef,'scaleDbId' => '','xref' => '','dataType' => '','name' => '','ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'validValues' => {'categories' => [],'min' => undef,'max' => undef}},'crop' => 'Cassava','institution' => 'http://localhost:3010','ontologyDbId' => '186','synonyms' => ['"rtcon" EXACT []','"RtConsNo_Est_1to3" EXACT []'],'ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'language' => '','observationVariableName' => 'root constriction','submissionTimestamp' => undef,'xref' => 'CO_334:0000109','contextOfUse' => [],'observationVariableDbId' => 70747,'growthStage' => '','trait' => {'traitName' => 'root constriction','attribute' => 'root constriction','xref' => 'CO_334:0000109','traitDbId' => 'CO_334:0000109','alternativeAbbreviations' => [],'entity' => '','description' => 'Visual ratings of root constrcitions (1 = few, 2 = intermediate, 3 = many) as being evaluated by CIAT.','ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'synonyms' => ['"rtcon" EXACT []','"RtConsNo_Est_1to3" EXACT []'],'class' => '','mainAbbreviations' => '','name' => 'root constriction','status' => ''}},{'ontologyName' => 'CO_334','method' => {'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'description' => '','name' => '','reference' => '','formula' => '','class' => '','methodName' => '','methodDbId' => ''},'name' => 'root evaluation scaled 1-5|CO_334:0000228','documentationURL' => '','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'crop' => 'Cassava','scale' => {'xref' => '','scaleDbId' => '','decimalPlaces' => undef,'scaleName' => '','validValues' => {'categories' => [],'min' => undef,'max' => undef},'ontologyReference' => {'ontologyName' => 'CO_334','ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''}},'name' => '','dataType' => ''},'institution' => 'http://localhost:3010','scientist' => '','observationVariableName' => 'root evaluation scaled 1-5','language' => '','ontologyDbId' => '186','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'synonyms' => ['"rteval" EXACT []','"RtEval_Est_1to5" EXACT []'],'observationVariableDbId' => 76673,'trait' => {'class' => '','xref' => 'CO_334:0000228','traitDbId' => 'CO_334:0000228','attribute' => 'root evaluation scaled 1-5','traitName' => 'root evaluation scaled 1-5','description' => 'An evaluation of the integration of  root shape, size, diameter, constriction, neck length on a scale of 1-5 with 1=very good; 5=very bad. Before scoring the roots, the field technician walks the harvested plot to get an idea of the average root type of the trial which will then be used as a score of 3. Genotypes better than average will be scored 2 and 1 in that order. Similiar genotype that are certainly worse compared to the average score are rated 4 and 5 in that order. Trait description is provided by Hernan Ceballos of CIAT.','entity' => '','alternativeAbbreviations' => [],'name' => 'root evaluation scaled 1-5','status' => '','ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'CO_334'},'synonyms' => ['"rteval" EXACT []','"RtEval_Est_1to5" EXACT []'],'mainAbbreviations' => ''},'growthStage' => '','contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'CO_334:0000228'},{'scientist' => '','institution' => 'http://localhost:3010','scale' => {'name' => '','validValues' => {'categories' => [],'min' => undef,'max' => undef},'ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''}},'dataType' => '','scaleDbId' => '','decimalPlaces' => undef,'xref' => '','scaleName' => ''},'crop' => 'Cassava','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'documentationURL' => '','name' => 'root flesh color|CO_334:0000222','method' => {'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'formula' => '','description' => '','class' => '','name' => '','methodName' => '','methodDbId' => '','reference' => ''},'ontologyName' => 'CO_334','submissionTimestamp' => undef,'xref' => 'CO_334:0000222','contextOfUse' => [],'growthStage' => '','trait' => {'mainAbbreviations' => '','name' => 'root flesh color','status' => '','class' => '','alternativeAbbreviations' => [],'entity' => '','description' => 'Visual rating of root pulp color with 1 = white, 2 = cream, 3 = yellow, as being evaluated by CIAT.','synonyms' => ['"rtfcol" EXACT []','"PlpCol_ClsnCIAT_1to3" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => ''},'traitName' => 'root flesh color','attribute' => 'root flesh color','traitDbId' => 'CO_334:0000222','xref' => 'CO_334:0000222'},'observationVariableDbId' => 76775,'ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'synonyms' => ['"rtfcol" EXACT []','"PlpCol_ClsnCIAT_1to3" EXACT []'],'ontologyDbId' => '186','language' => '','observationVariableName' => 'root flesh color'},{'observationVariableDbId' => 76792,'trait' => {'class' => '','status' => '','name' => 'root length evaluation scaled 1-3','mainAbbreviations' => '','attribute' => 'root length evaluation scaled 1-3','traitDbId' => 'CO_334:0000226','xref' => 'CO_334:0000226','traitName' => 'root length evaluation scaled 1-3','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'synonyms' => ['"rtlgt" EXACT []','"RtLng_Est_1to3" EXACT []'],'entity' => '','alternativeAbbreviations' => [],'description' => 'Visual assessment of the root length on a scale of 1, 2, 3 (1=short;  2= intermediate; 3=long)'},'growthStage' => '','contextOfUse' => [],'xref' => 'CO_334:0000226','submissionTimestamp' => undef,'observationVariableName' => 'root length evaluation scaled 1-3','language' => '','ontologyDbId' => '186','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '186','version' => '','ontologyName' => 'CO_334'},'synonyms' => ['"rtlgt" EXACT []','"RtLng_Est_1to3" EXACT []'],'scale' => {'xref' => '','decimalPlaces' => undef,'scaleDbId' => '','scaleName' => '','validValues' => {'min' => undef,'max' => undef,'categories' => []},'ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'name' => '','dataType' => ''},'crop' => 'Cassava','institution' => 'http://localhost:3010','scientist' => '','ontologyName' => 'CO_334','method' => {'methodName' => '','class' => '','formula' => '','methodDbId' => '','name' => '','description' => '','ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'reference' => ''},'name' => 'root length evaluation scaled 1-3|CO_334:0000226','documentationURL' => '','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' )},{'observationVariableDbId' => 78320,'trait' => {'traitName' => 'Root Lodging [plants]','attribute' => 'Root Lodging [plants]','xref' => 'G2F:0000007','traitDbId' => 'G2F:0000007','ontologyReference' => {'documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '309','version' => '','ontologyName' => 'G2F'},'synonyms' => [undef],'alternativeAbbreviations' => [],'entity' => '','description' => 'Number of plants that show root lodging per plot, i.e., those stems that lean substantially to one side (> 15% from vertical).  Count includes bgooseneckedb plants that have bstraightened upb after becoming lodged earlier in the season.','class' => '','mainAbbreviations' => '','status' => '','name' => 'Root Lodging [plants]'},'growthStage' => '','contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'G2F:0000007','observationVariableName' => 'Root Lodging [plants]','language' => '','ontologyDbId' => '309','synonyms' => [undef],'ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '309','ontologyName' => 'G2F'},'crop' => 'Cassava','scale' => {'ontologyReference' => {'ontologyDbId' => '309','version' => '','documentationURL' => {'type' => '','URL' => ''},'ontologyName' => 'G2F'},'validValues' => {'max' => undef,'min' => undef,'categories' => []},'name' => '','dataType' => '','xref' => '','scaleDbId' => '','decimalPlaces' => undef,'scaleName' => ''},'institution' => 'http://localhost:3010','scientist' => '','ontologyName' => 'G2F','method' => {'reference' => '','name' => '','description' => '','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'ontologyDbId' => '309','version' => '','ontologyName' => 'G2F'},'methodDbId' => '','class' => '','methodName' => '','formula' => ''},'name' => 'Root Lodging [plants]|G2F:0000007','documentationURL' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'defaultValue' => ''},{'scientist' => '','institution' => 'http://localhost:3010','scale' => {'ontologyReference' => {'ontologyName' => 'CO_334','ontologyDbId' => '186','version' => '','documentationURL' => {'type' => '','URL' => ''}},'validValues' => {'min' => undef,'max' => undef,'categories' => []},'name' => '','dataType' => '','xref' => '','scaleDbId' => '','decimalPlaces' => undef,'scaleName' => ''},'crop' => 'Cassava','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'name' => 'root neck length|CO_334:0000022','documentationURL' => '','method' => {'methodName' => '','class' => '','formula' => '','methodDbId' => '','description' => '','name' => '','ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'reference' => ''},'ontologyName' => 'CO_334','contextOfUse' => [],'submissionTimestamp' => undef,'xref' => 'CO_334:0000022','trait' => {'class' => '','mainAbbreviations' => '','name' => 'root neck length','status' => '','traitName' => 'root neck length','attribute' => 'root neck length','xref' => 'CO_334:0000022','traitDbId' => 'CO_334:0000022','alternativeAbbreviations' => [],'entity' => '','description' => 'Visual rating of root neck length with 0 = absent or sessile, 3 = short, 5 = intermediate, and 7 = long.','ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'synonyms' => ['"nklgt" EXACT []','"NkLng_VisClsn_0to7" EXACT []']},'growthStage' => '','observationVariableDbId' => 70718,'synonyms' => ['"nklgt" EXACT []','"NkLng_VisClsn_0to7" EXACT []'],'ontologyReference' => {'ontologyName' => 'CO_334','version' => '','ontologyDbId' => '186','documentationURL' => {'type' => '','URL' => ''}},'ontologyDbId' => '186','observationVariableName' => 'root neck length','language' => ''},{'institution' => 'http://localhost:3010','crop' => 'Cassava','scale' => {'xref' => '','scaleDbId' => '','decimalPlaces' => undef,'scaleName' => '','ontologyReference' => {'version' => '','ontologyDbId' => '186','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'validValues' => {'min' => undef,'max' => undef,'categories' => []},'name' => '','dataType' => ''},'scientist' => '','method' => {'formula' => '','class' => '','methodName' => '','methodDbId' => '','ontologyReference' => {'ontologyName' => 'CO_334','documentationURL' => {'URL' => '','type' => ''},'ontologyDbId' => '186','version' => ''},'description' => '','name' => '','reference' => ''},'ontologyName' => 'CO_334','defaultValue' => '','status' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'documentationURL' => '','name' => 'root number counting|CO_334:0000011','growthStage' => '','trait' => {'entity' => '','alternativeAbbreviations' => [],'description' => 'A count of the total number of storage roots harvested per plot.','ontologyReference' => {'documentationURL' => {'type' => '','URL' => ''},'version' => '','ontologyDbId' => '186','ontologyName' => 'CO_334'},'synonyms' => ['"rtno" EXACT []','"NoHvstRt_Count_Rt" EXACT []'],'attribute' => 'root number counting','xref' => 'CO_334:0000011','traitDbId' => 'CO_334:0000011','traitName' => 'root number counting','name' => 'root number counting','status' => '','mainAbbreviations' => '','class' => ''},'observationVariableDbId' => 70706,'submissionTimestamp' => undef,'xref' => 'CO_334:0000011','contextOfUse' => [],'language' => '','observationVariableName' => 'root number counting','synonyms' => ['"rtno" EXACT []','"NoHvstRt_Count_Rt" EXACT []'],'ontologyReference' => {'ontologyDbId' => '186','version' => '','documentationURL' => {'URL' => '','type' => ''},'ontologyName' => 'CO_334'},'ontologyDbId' => '186'}]},'metadata' => {'datafiles' => [],'pagination' => {'currentPage' => 24,'totalPages' => 33,'pageSize' => 10,'totalCount' => 323},'status' => [{'message' => 'BrAPI base call found with page=24, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::ObservationVariables','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Observationvariable search result constructed'}]}}, 'variables-search');

$mech->get_ok('http://localhost:3010/brapi/v1/samples-search?access_token='.$access_token );
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => []},'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 0,'pageSize' => 10,'currentPage' => 0,'totalCount' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v1::Samples','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Sample search result constructed'}]}}, 'samples');

done_testing();
