
use strict;
use warnings;

#use lib 't/lib';
#use SGN::Test::Fixture;
use Test::More;
use Test::WWW::Mechanize;
use LWP::UserAgent;

#Needed to update IO::Socket::SSL
use Data::Dumper;
use JSON;
local $Data::Dumper::Indent = 0;

my $mech = Test::WWW::Mechanize->new;
my $ua   = LWP::UserAgent->new;
my $response; my $searchId; my $resp; my $data;

$mech->post_ok('http://localhost:3010/brapi/v2/token', [ "username"=> "janedoe", "password"=> "secretpw", "grant_type"=> "password" ]);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[0]->{'message'}, 'Login Successfull');
is($response->{'userDisplayName'}, 'Jane Doe');
is($response->{'expires_in'}, '7200');

$mech->delete_ok('http://localhost:3010/brapi/v2/token');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[0]->{'message'}, 'User Logged Out');

$mech->post_ok('http://localhost:3010/brapi/v2/token', [ "username"=> "janedoe", "password"=> "secretpw", "grant_type"=> "password" ]);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is($response->{'metadata'}->{'status'}->[0]->{'message'}, 'Login Successfull');
is($response->{'userDisplayName'}, 'Jane Doe');
is($response->{'expires_in'}, '7200');
my $access_token = $response->{access_token};

$ua->default_header("Content-Type" => "application/json");
$ua->default_header('Authorization'=> 'Bearer ' . $access_token);
$mech->default_header("Content-Type" => "application/json");
$mech->default_header('Authorization'=> 'Bearer ' . $access_token);

$mech->get_ok('http://localhost:3010/brapi/v2/serverinfo?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'pageSize' => 1000,'currentPage' => 0,'totalCount' => 117,'totalPages' => 1},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::ServerInfo'},{'messageType' => 'INFO','message' => 'Calls result constructed'}],'datafiles' => []},'result' => {'serverName' => 'breeDBase','documentationURL' => 'https://nickmorales.github.io/imagebreed/','organizationURL' => 'http://localhost:3010/','organizationName' => 'ImageBreed','location' => 'USA','contactEmail' => 'nm529@cornell.edu','serverDescription' => 'BrAPI v2.0 compliant server','calls' => [{'datatypes' => ['application/json'],'service' => 'serverinfo','versions' => ['2.0'],'methods' => ['GET']},{'datatypes' => ['application/json'],'service' => 'commoncropnames','versions' => ['2.0'],'methods' => ['GET']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'lists','methods' => ['GET','POST']},{'versions' => ['2.0'],'service' => 'lists/{listDbId}','datatypes' => ['application/json'],'methods' => ['GET','PUT']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'lists/{listDbId}/items','methods' => ['POST']},{'methods' => ['POST'],'versions' => ['2.0'],'service' => 'search/lists','datatypes' => ['application/json']},{'methods' => ['GET'],'versions' => ['2.0'],'service' => 'search/lists/{searchResultsDbId}','datatypes' => ['application/json']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'locations','methods' => ['GET','POST']},{'versions' => ['2.0'],'service' => 'locations/{locationDbId}','datatypes' => ['application/json'],'methods' => ['GET','PUT']},{'versions' => ['2.0'],'service' => 'search/locations','datatypes' => ['application/json'],'methods' => ['POST']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/locations/{searchResultsDbId}'},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'people','methods' => ['GET']},{'methods' => ['GET'],'service' => 'people/{peopleDbId}','versions' => ['2.0'],'datatypes' => ['application/json']},{'service' => 'search/people','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['POST']},{'versions' => ['2.0'],'service' => 'search/people/{searchResultsDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET','POST'],'versions' => ['2.0'],'service' => 'programs','datatypes' => ['application/json']},{'versions' => ['2.0'],'service' => 'programs/{programDbId}','datatypes' => ['application/json'],'methods' => ['GET','PUT']},{'versions' => ['2.0'],'service' => 'search/programs','datatypes' => ['application/json'],'methods' => ['POST']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/programs/{searchResultsDbId}'},{'methods' => ['GET'],'service' => 'seasons','versions' => ['2.0'],'datatypes' => ['application/json']},{'versions' => ['2.0'],'service' => 'seasons/{seasonDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['POST'],'datatypes' => ['application/json'],'service' => 'search/seasons','versions' => ['2.0']},{'versions' => ['2.0'],'service' => 'search/seasons/{searchResultsDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET','POST'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'studies'},{'methods' => ['GET','PUT'],'versions' => ['2.0'],'service' => 'studies/{studyDbId}','datatypes' => ['application/json']},{'methods' => ['POST'],'versions' => ['2.0'],'service' => 'search/studies','datatypes' => ['application/json']},{'methods' => ['GET'],'service' => 'search/studies/{searchResultsDbId}','versions' => ['2.0'],'datatypes' => ['application/json']},{'service' => 'studytypes','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET','POST'],'service' => 'trials','versions' => ['2.0'],'datatypes' => ['application/json']},{'methods' => ['GET','PUT'],'versions' => ['2.0'],'service' => 'trials/{trialDbId}','datatypes' => ['application/json']},{'methods' => ['POST'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/trials'},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/trials/{searchResultsDbId}','methods' => ['GET']},{'methods' => ['GET','POST'],'versions' => ['2.0'],'service' => 'images','datatypes' => ['application/json']},{'methods' => ['GET','PUT'],'datatypes' => ['application/json'],'service' => 'images/{imageDbId}','versions' => ['2.0']},{'service' => 'images/{imageDbId}/imagecontent','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['PUT']},{'methods' => ['POST'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/images'},{'versions' => ['2.0'],'service' => 'search/images/{searchResultsDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET','POST','PUT'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'observations'},{'versions' => ['2.0'],'service' => 'observations/{observationDbId}','datatypes' => ['application/json'],'methods' => ['GET','PUT']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'observations/table'},{'versions' => ['2.0'],'service' => 'search/observations','datatypes' => ['application/json'],'methods' => ['POST']},{'versions' => ['2.0'],'service' => 'search/observations/{searchResultsDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'observationlevels'},{'datatypes' => ['application/json'],'service' => 'observationunits','versions' => ['2.0'],'methods' => ['GET','POST','PUT']},{'methods' => ['GET','PUT'],'service' => 'observationunits/{observationUnitDbId}','versions' => ['2.0'],'datatypes' => ['application/json']},{'methods' => ['POST'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/observationunits'},{'methods' => ['GET'],'service' => 'search/observationunits/{searchResultsDbId}','versions' => ['2.0'],'datatypes' => ['application/json']},{'methods' => ['GET'],'service' => 'ontologies','versions' => ['2.0'],'datatypes' => ['application/json']},{'methods' => ['GET'],'versions' => ['2.0'],'service' => 'traits','datatypes' => ['application/json']},{'service' => 'traits/{traitDbId}','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['GET']},{'datatypes' => ['application/json'],'service' => 'variables','versions' => ['2.0'],'methods' => ['GET','POST']},{'methods' => ['GET'],'versions' => ['2.0'],'service' => 'variables/{observationVariableDbId}','datatypes' => ['application/json']},{'service' => 'search/variables','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['POST']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/variables/{searchResultsDbId}','methods' => ['GET']},{'methods' => ['GET'],'versions' => ['2.0'],'service' => 'events','datatypes' => ['application/json']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'calls'},{'methods' => ['POST'],'versions' => ['2.0'],'service' => 'search/calls','datatypes' => ['application/json']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/calls/{searchResultsDbId}','methods' => ['GET']},{'versions' => ['2.0'],'service' => 'callsets','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['application/json'],'service' => 'callsets/{callSetDbId}','versions' => ['2.0']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'callsets/{callSetDbId}/calls'},{'methods' => ['POST'],'datatypes' => ['application/json'],'service' => 'search/callsets','versions' => ['2.0']},{'versions' => ['2.0'],'service' => 'search/callsets/{searchResultsDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET'],'versions' => ['2.0'],'service' => 'maps','datatypes' => ['application/json']},{'methods' => ['GET'],'service' => 'maps/{mapDbId}','versions' => ['2.0'],'datatypes' => ['application/json']},{'datatypes' => ['application/json'],'service' => 'maps/{mapDbId}/linkagegroups','versions' => ['2.0'],'methods' => ['GET']},{'methods' => ['GET'],'versions' => ['2.0'],'service' => 'markerpositions','datatypes' => ['application/json']},{'methods' => ['POST'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/markerpositions'},{'service' => 'search/markerpositions/{searchResultsDbId}','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['GET']},{'datatypes' => ['application/json'],'service' => 'references','versions' => ['2.0'],'methods' => ['GET']},{'methods' => ['GET'],'service' => 'references/{referenceDbId}','versions' => ['2.0'],'datatypes' => ['application/json']},{'service' => 'search/references','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['POST']},{'service' => 'search/references/{searchResultsDbId}','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['application/json'],'service' => 'referencesets','versions' => ['2.0']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'referencesets/{referenceSetDbId}','methods' => ['GET']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/referencesets','methods' => ['POST']},{'versions' => ['2.0'],'service' => 'search/referencesets/{searchResultsDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'versions' => ['2.0'],'service' => 'samples','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET'],'service' => 'samples/{sampleDbId}','versions' => ['2.0'],'datatypes' => ['application/json']},{'methods' => ['POST'],'datatypes' => ['application/json'],'service' => 'search/samples','versions' => ['2.0']},{'methods' => ['GET'],'datatypes' => ['application/json'],'service' => 'search/samples/{searchResultsDbId}','versions' => ['2.0']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'variants'},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'variants/{variantDbId}','methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'variants/{variantDbId}/calls'},{'service' => 'search/variants','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['POST']},{'versions' => ['2.0'],'service' => 'search/variants/{searchResultsDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['application/json'],'service' => 'variantsets','versions' => ['2.0']},{'datatypes' => ['application/json'],'service' => 'variantsets/extract','versions' => ['2.0'],'methods' => ['GET']},{'versions' => ['2.0'],'service' => 'variantsets/{variantSetDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'datatypes' => ['application/json'],'service' => 'variantsets/{variantSetDbId}/calls','versions' => ['2.0'],'methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'variantsets/{variantSetDbId}/callsets'},{'methods' => ['GET'],'service' => 'variantsets/{variantSetDbId}/variants','versions' => ['2.0'],'datatypes' => ['application/json']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/variantsets','methods' => ['POST']},{'versions' => ['2.0'],'service' => 'search/variantsets/{searchResultsDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET','POST'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'germplasm'},{'versions' => ['2.0'],'service' => 'germplasm/{germplasmDbId}','datatypes' => ['application/json'],'methods' => ['GET','PUT']},{'datatypes' => ['application/json'],'service' => 'germplasm/{germplasmDbId}/pedigree','versions' => ['2.0'],'methods' => ['GET']},{'methods' => ['GET'],'service' => 'germplasm/{germplasmDbId}/progeny','versions' => ['2.0'],'datatypes' => ['application/json']},{'methods' => ['GET'],'service' => 'germplasm/{germplasmDbId}/mcpd','versions' => ['2.0'],'datatypes' => ['application/json']},{'service' => 'search/germplasm','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['POST']},{'methods' => ['GET'],'versions' => ['2.0'],'service' => 'search/germplasm/{searchResultsDbId}','datatypes' => ['application/json']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'attributes'},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'attributes/categories','methods' => ['GET']},{'datatypes' => ['application/json'],'service' => 'attributes/{attributeDbId}','versions' => ['2.0'],'methods' => ['GET']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'search/attributes','methods' => ['POST']},{'methods' => ['GET'],'datatypes' => ['application/json'],'service' => 'search/attributes/{searchResultsDbId}','versions' => ['2.0']},{'versions' => ['2.0'],'service' => 'attributevalues','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'attributevalues/{attributeValueDbId}'},{'methods' => ['POST'],'service' => 'search/attributevalues','versions' => ['2.0'],'datatypes' => ['application/json']},{'versions' => ['2.0'],'service' => 'search/attributevalues/{searchResultsDbId}','datatypes' => ['application/json'],'methods' => ['GET']},{'methods' => ['GET','POST'],'service' => 'crossingprojects','versions' => ['2.0'],'datatypes' => ['application/json']},{'versions' => ['2.0'],'service' => 'crossingprojects/{crossingProjectDbId}','datatypes' => ['application/json'],'methods' => ['GET','PUT']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'crosses','methods' => ['GET','POST']},{'service' => 'seedlots','versions' => ['2.0'],'datatypes' => ['application/json'],'methods' => ['GET','POST']},{'methods' => ['GET','POST'],'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'seedlots/transactions'},{'methods' => ['GET','PUT'],'datatypes' => ['application/json'],'service' => 'seedlots/{seedLotDbId}','versions' => ['2.0']},{'datatypes' => ['application/json'],'versions' => ['2.0'],'service' => 'seedlots/{seedLotDbId}/transactions','methods' => ['GET']}]}} );

# Phenotyping

$mech->get_ok('http://localhost:3010/brapi/v2/observationlevels');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'levelName' => 'replicate','levelOrder' => 0},{'levelName' => 'block','levelOrder' => 1},{'levelName' => 'plot','levelOrder' => 2},{'levelName' => 'subplot','levelOrder' => 3},{'levelName' => 'plant','levelOrder' => 4},{'levelName' => 'tissue_sample','levelOrder' => 5}]},'metadata' => {'pagination' => {'totalPages' => 1,'pageSize' => 6,'totalCount' => 6,'currentPage' => 0},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::ObservationVariables'},{'messageType' => 'INFO','message' => 'Observation Levels result constructed'}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/observationunits');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::ObservationUnits'},{'messageType' => 'INFO','message' => 'Observation Units search result constructed'}],'datafiles' => [],'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalPages' => 196,'totalCount' => 1954}},'result' => {'data' => [{'observationUnitPosition' => {'geoCoordinates' => undef,'positionCoordinateX' => undef,'observationLevel' => {'levelName' => 'plot','levelOrder' => 2,'levelCode' => '103'},'entryType' => 'test','observationLevelRelationships' => [{'levelName' => 'replicate','levelOrder' => 0,'levelCode' => '1'},{'levelCode' => '1','levelOrder' => 1,'levelName' => 'block'},{'levelCode' => '103','levelOrder' => 2,'levelName' => 'plot'}],'positionCoordinateY' => undef,'positionCoordinateYType' => 'GRID_ROW','positionCoordinateXType' => 'GRID_COL'},'programDbId' => '134','observationUnitDbId' => '41284','treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => [],'observations' => [{'observationVariableDbId' => '77559','value' => '601.518','additionalInfo' => {},'observationDbId' => '740336','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => [],'season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41284','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013'},{'value' => '39.84365','additionalInfo' => {},'observationVariableDbId' => '77557','uploadedBy' => undef,'observationDbId' => '740337','collector' => 'johndoe','germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41284','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011'},{'value' => '655.92','additionalInfo' => {},'observationVariableDbId' => '77556','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740338','studyDbId' => '165','germplasmDbId' => '41283','germplasmName' => 'IITA-TMS-IBA980581','observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41284','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_103','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41284','collector' => 'johndoe','observationDbId' => '740339','uploadedBy' => undef,'observationVariableDbId' => '77548','additionalInfo' => {},'value' => '1259.08','germplasmName' => 'IITA-TMS-IBA980581','studyDbId' => '165','germplasmDbId' => '41283'},{'value' => '17.38275','additionalInfo' => {},'observationVariableDbId' => '77553','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740340','studyDbId' => '165','germplasmDbId' => '41283','germplasmName' => 'IITA-TMS-IBA980581','observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41284','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007'},{'germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','value' => '192.1495','additionalInfo' => {},'observationVariableDbId' => '77549','uploadedBy' => undef,'observationDbId' => '740341','collector' => 'johndoe','observationUnitDbId' => '41284','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'studyDbId' => '165','germplasmDbId' => '41283','germplasmName' => 'IITA-TMS-IBA980581','value' => '67.9959','additionalInfo' => {},'observationVariableDbId' => '77552','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740342','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41284','observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_103','observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'collector' => 'johndoe','observationDbId' => '740343','uploadedBy' => undef,'observationVariableDbId' => '77550','additionalInfo' => {},'value' => '20.3038','germplasmName' => 'IITA-TMS-IBA980581','studyDbId' => '165','germplasmDbId' => '41283','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_103','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationUnitDbId' => '41284','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}]},{'value' => '102.0875','additionalInfo' => {},'observationVariableDbId' => '77551','uploadedBy' => undef,'observationDbId' => '740344','collector' => 'johndoe','germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41284','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005'},{'germplasmName' => 'IITA-TMS-IBA980581','germplasmDbId' => '41283','studyDbId' => '165','observationDbId' => '740345','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77558','value' => '108.56995','additionalInfo' => {},'observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationUnitDbId' => '41284','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => []},{'season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41284','observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => [],'germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','observationVariableDbId' => '77554','value' => '28.83915','additionalInfo' => {},'observationDbId' => '740346','collector' => 'johndoe','uploadedBy' => undef},{'observationUnitName' => 'CASS_6Genotypes_103','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationUnitDbId' => '41284','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740347','additionalInfo' => {},'value' => '379.16','observationVariableDbId' => '77555','germplasmName' => 'IITA-TMS-IBA980581','studyDbId' => '165','germplasmDbId' => '41283'}],'germplasmName' => 'IITA-TMS-IBA980581','locationName' => 'test_location','observationUnitPUI' => 'localhost/stock/41284/view','studyName' => 'CASS_6Genotypes_Sampling_2015','studyDbId' => '165','germplasmDbId' => '41283','trialName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','trialDbId' => '165','locationDbId' => '23','seedLotDbId' => undef,'additionalInfo' => {}},{'observationUnitName' => 'CASS_6Genotypes_104','externalReferences' => [],'observations' => [{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_104','externalReferences' => [],'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationUnitDbId' => '41295','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationDbId' => '740348','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77559','value' => '221.6135','additionalInfo' => {},'germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165'},{'observationUnitName' => 'CASS_6Genotypes_104','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41295','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740349','additionalInfo' => {},'value' => '36.12425','observationVariableDbId' => '77557','germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_104','externalReferences' => [],'season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41295','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationVariableDbId' => '77556','value' => '316.489','additionalInfo' => {},'collector' => 'johndoe','observationDbId' => '740350','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002'},{'observationUnitDbId' => '41295','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_104','germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002','observationVariableDbId' => '77548','value' => '908.9045','additionalInfo' => {},'observationDbId' => '740351','collector' => 'johndoe','uploadedBy' => undef},{'uploadedBy' => undef,'observationDbId' => '740352','collector' => 'johndoe','value' => '29.6934','additionalInfo' => {},'observationVariableDbId' => '77553','germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_104','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','observationUnitDbId' => '41295','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}]},{'studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002','additionalInfo' => {},'value' => '162.9475','observationVariableDbId' => '77549','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740353','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41295','observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationUnitName' => 'CASS_6Genotypes_104','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_104','externalReferences' => [],'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41295','collector' => 'johndoe','observationDbId' => '740354','uploadedBy' => undef,'observationVariableDbId' => '77552','value' => '23.09545','additionalInfo' => {},'germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_104','externalReferences' => [],'observationUnitDbId' => '41295','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationVariableDbId' => '77550','value' => '14.3795','additionalInfo' => {},'collector' => 'johndoe','observationDbId' => '740355','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002'},{'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41295','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_104','germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282','collector' => 'johndoe','observationDbId' => '740356','uploadedBy' => undef,'observationVariableDbId' => '77551','additionalInfo' => {},'value' => '85.9106'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_104','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41295','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationVariableDbId' => '77558','additionalInfo' => {},'value' => '54.2099','collector' => 'johndoe','observationDbId' => '740357','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_104','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41295','observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationVariableDbId' => '77554','additionalInfo' => {},'value' => '13.8628','observationDbId' => '740358','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002'},{'germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282','collector' => 'johndoe','observationDbId' => '740359','uploadedBy' => undef,'observationVariableDbId' => '77555','additionalInfo' => {},'value' => '341.041','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationUnitDbId' => '41295','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_104'}],'programDbId' => '134','observationUnitPosition' => {'positionCoordinateY' => undef,'observationLevelRelationships' => [{'levelName' => 'replicate','levelCode' => '1','levelOrder' => 0},{'levelOrder' => 1,'levelCode' => '1','levelName' => 'block'},{'levelName' => 'plot','levelCode' => '104','levelOrder' => 2}],'positionCoordinateX' => undef,'geoCoordinates' => undef,'entryType' => 'test','observationLevel' => {'levelOrder' => 2,'levelCode' => '104','levelName' => 'plot'},'positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW'},'observationUnitDbId' => '41295','treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'trialName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','trialDbId' => '165','locationDbId' => '23','seedLotDbId' => undef,'additionalInfo' => {},'germplasmName' => 'IITA-TMS-IBA980002','locationName' => 'test_location','observationUnitPUI' => 'localhost/stock/41295/view','studyName' => 'CASS_6Genotypes_Sampling_2015','studyDbId' => '165','germplasmDbId' => '41282'},{'observationUnitDbId' => '41296','treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}],'programDbId' => '134','observationUnitPosition' => {'positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW','positionCoordinateY' => undef,'observationLevelRelationships' => [{'levelOrder' => 0,'levelCode' => '1','levelName' => 'replicate'},{'levelName' => 'block','levelCode' => '1','levelOrder' => 1},{'levelName' => 'plot','levelOrder' => 2,'levelCode' => '105'}],'geoCoordinates' => undef,'positionCoordinateX' => undef,'observationLevel' => {'levelName' => 'plot','levelCode' => '105','levelOrder' => 2},'entryType' => 'test'},'observations' => [{'germplasmName' => 'IITA-TMS-IBA30572','germplasmDbId' => '41279','studyDbId' => '165','observationDbId' => '740360','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77559','value' => '662.087','additionalInfo' => {},'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationUnitDbId' => '41296','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_105'},{'observationUnitDbId' => '41296','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_105','observationTimeStamp' => 'NA2017-04-21_21:11:28','germplasmDbId' => '41279','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA30572','additionalInfo' => {},'value' => '46.1458','observationVariableDbId' => '77557','uploadedBy' => undef,'observationDbId' => '740361','collector' => 'johndoe'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_105','externalReferences' => [],'observationUnitDbId' => '41296','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationVariableDbId' => '77556','additionalInfo' => {},'value' => '559.441','collector' => 'johndoe','observationDbId' => '740362','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41279','germplasmName' => 'IITA-TMS-IBA30572'},{'observationDbId' => '740363','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77548','additionalInfo' => {},'value' => '1974.265','germplasmName' => 'IITA-TMS-IBA30572','germplasmDbId' => '41279','studyDbId' => '165','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_105','externalReferences' => [],'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41296'},{'germplasmName' => 'IITA-TMS-IBA30572','germplasmDbId' => '41279','studyDbId' => '165','observationDbId' => '740364','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77553','value' => '38.1064','additionalInfo' => {},'observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','observationUnitDbId' => '41296','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_105','externalReferences' => []},{'germplasmDbId' => '41279','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA30572','observationVariableDbId' => '77549','value' => '484.765','additionalInfo' => {},'observationDbId' => '740365','collector' => 'johndoe','uploadedBy' => undef,'season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41296','observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_105','externalReferences' => []},{'observationVariableDbId' => '77552','additionalInfo' => {},'value' => '33.1455','observationDbId' => '740366','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41279','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA30572','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_105','externalReferences' => [],'observationUnitDbId' => '41296','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006'},{'germplasmName' => 'IITA-TMS-IBA30572','studyDbId' => '165','germplasmDbId' => '41279','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740367','additionalInfo' => {},'value' => '16.7238','observationVariableDbId' => '77550','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationUnitDbId' => '41296','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitName' => 'CASS_6Genotypes_105','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'germplasmDbId' => '41279','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA30572','additionalInfo' => {},'value' => '98.71395','observationVariableDbId' => '77551','uploadedBy' => undef,'observationDbId' => '740368','collector' => 'johndoe','observationUnitDbId' => '41296','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationUnitName' => 'CASS_6Genotypes_105','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41296','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_105','germplasmName' => 'IITA-TMS-IBA30572','studyDbId' => '165','germplasmDbId' => '41279','collector' => 'johndoe','observationDbId' => '740369','uploadedBy' => undef,'observationVariableDbId' => '77558','value' => '97.8179','additionalInfo' => {}},{'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationUnitDbId' => '41296','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_105','germplasmName' => 'IITA-TMS-IBA30572','studyDbId' => '165','germplasmDbId' => '41279','collector' => 'johndoe','observationDbId' => '740370','uploadedBy' => undef,'observationVariableDbId' => '77554','value' => '35.4435','additionalInfo' => {}},{'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_105','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41296','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740371','additionalInfo' => {},'value' => '439.9695','observationVariableDbId' => '77555','germplasmName' => 'IITA-TMS-IBA30572','studyDbId' => '165','germplasmDbId' => '41279'}],'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_105','studyName' => 'CASS_6Genotypes_Sampling_2015','studyDbId' => '165','germplasmDbId' => '41279','germplasmName' => 'IITA-TMS-IBA30572','locationName' => 'test_location','observationUnitPUI' => 'localhost/stock/41296/view','seedLotDbId' => undef,'additionalInfo' => {},'trialName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','trialDbId' => '165','locationDbId' => '23'},{'trialDbId' => '165','locationDbId' => '23','trialName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','seedLotDbId' => undef,'additionalInfo' => {},'locationName' => 'test_location','observationUnitPUI' => 'localhost/stock/41297/view','germplasmName' => 'IITA-TMS-IBA011412','studyDbId' => '165','germplasmDbId' => '41281','studyName' => 'CASS_6Genotypes_Sampling_2015','observationUnitName' => 'CASS_6Genotypes_106','externalReferences' => [],'observations' => [{'studyDbId' => '165','germplasmDbId' => '41281','germplasmName' => 'IITA-TMS-IBA011412','observationVariableDbId' => '77559','additionalInfo' => {},'value' => '612.37','collector' => 'johndoe','observationDbId' => '740372','uploadedBy' => undef,'observationUnitDbId' => '41297','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_106','externalReferences' => []},{'uploadedBy' => undef,'observationDbId' => '740373','collector' => 'johndoe','additionalInfo' => {},'value' => '23.788','observationVariableDbId' => '77557','germplasmName' => 'IITA-TMS-IBA011412','germplasmDbId' => '41281','studyDbId' => '165','observationUnitName' => 'CASS_6Genotypes_106','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','observationUnitDbId' => '41297','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}]},{'germplasmName' => 'IITA-TMS-IBA011412','studyDbId' => '165','germplasmDbId' => '41281','collector' => 'johndoe','observationDbId' => '740374','uploadedBy' => undef,'observationVariableDbId' => '77556','additionalInfo' => {},'value' => '604.5625','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationUnitDbId' => '41297','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_106','externalReferences' => []},{'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_106','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41297','uploadedBy' => undef,'observationDbId' => '740375','collector' => 'johndoe','value' => '646.902','additionalInfo' => {},'observationVariableDbId' => '77548','germplasmName' => 'IITA-TMS-IBA011412','germplasmDbId' => '41281','studyDbId' => '165'},{'observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41297','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_106','germplasmName' => 'IITA-TMS-IBA011412','germplasmDbId' => '41281','studyDbId' => '165','observationDbId' => '740376','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77553','additionalInfo' => {},'value' => '26.60415'},{'germplasmName' => 'IITA-TMS-IBA011412','studyDbId' => '165','germplasmDbId' => '41281','collector' => 'johndoe','observationDbId' => '740377','uploadedBy' => undef,'observationVariableDbId' => '77549','value' => '192.46','additionalInfo' => {},'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationUnitDbId' => '41297','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_106','externalReferences' => []},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_106','observationUnitDbId' => '41297','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationVariableDbId' => '77552','value' => '39.6698','additionalInfo' => {},'collector' => 'johndoe','observationDbId' => '740378','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41281','germplasmName' => 'IITA-TMS-IBA011412'},{'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_106','observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41297','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','value' => '16.78125','additionalInfo' => {},'observationVariableDbId' => '77550','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740379','studyDbId' => '165','germplasmDbId' => '41281','germplasmName' => 'IITA-TMS-IBA011412'},{'observationDbId' => '740380','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77551','value' => '107.74','additionalInfo' => {},'germplasmName' => 'IITA-TMS-IBA011412','germplasmDbId' => '41281','studyDbId' => '165','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_106','externalReferences' => [],'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41297'},{'value' => '78.72305','additionalInfo' => {},'observationVariableDbId' => '77558','uploadedBy' => undef,'observationDbId' => '740381','collector' => 'johndoe','germplasmDbId' => '41281','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA011412','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_106','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41297','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012'},{'germplasmDbId' => '41281','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA011412','observationVariableDbId' => '77554','value' => '28.3805','additionalInfo' => {},'observationDbId' => '740382','collector' => 'johndoe','uploadedBy' => undef,'observationUnitDbId' => '41297','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_106','externalReferences' => []},{'collector' => 'johndoe','observationDbId' => '740383','uploadedBy' => undef,'observationVariableDbId' => '77555','value' => '469.818','additionalInfo' => {},'germplasmName' => 'IITA-TMS-IBA011412','studyDbId' => '165','germplasmDbId' => '41281','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_106','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationUnitDbId' => '41297','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}]}],'programDbId' => '134','observationUnitPosition' => {'positionCoordinateY' => undef,'observationLevelRelationships' => [{'levelOrder' => 0,'levelCode' => '1','levelName' => 'replicate'},{'levelName' => 'block','levelCode' => '1','levelOrder' => 1},{'levelOrder' => 2,'levelCode' => '106','levelName' => 'plot'}],'positionCoordinateX' => undef,'geoCoordinates' => undef,'entryType' => 'test','observationLevel' => {'levelOrder' => 2,'levelCode' => '106','levelName' => 'plot'},'positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW'},'observationUnitDbId' => '41297','treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}]},{'additionalInfo' => {},'seedLotDbId' => undef,'programName' => 'test','trialName' => 'CASS_6Genotypes_Sampling_2015','locationDbId' => '23','trialDbId' => '165','studyName' => 'CASS_6Genotypes_Sampling_2015','germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693','observationUnitPUI' => 'localhost/stock/41298/view','locationName' => 'test_location','observations' => [{'germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693','value' => '198.089','additionalInfo' => {},'observationVariableDbId' => '77559','uploadedBy' => undef,'observationDbId' => '740384','collector' => 'johndoe','observationUnitDbId' => '41298','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationUnitName' => 'CASS_6Genotypes_107','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'observationUnitName' => 'CASS_6Genotypes_107','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41298','uploadedBy' => undef,'observationDbId' => '740385','collector' => 'johndoe','value' => '47.64845','additionalInfo' => {},'observationVariableDbId' => '77557','germplasmName' => 'TMEB693','germplasmDbId' => '41280','studyDbId' => '165'},{'observationUnitDbId' => '41298','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_107','germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693','observationVariableDbId' => '77556','additionalInfo' => {},'value' => '485.944','observationDbId' => '740386','collector' => 'johndoe','uploadedBy' => undef},{'germplasmName' => 'TMEB693','studyDbId' => '165','germplasmDbId' => '41280','collector' => 'johndoe','observationDbId' => '740387','uploadedBy' => undef,'observationVariableDbId' => '77548','additionalInfo' => {},'value' => '779.191','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationUnitDbId' => '41298','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_107','externalReferences' => []},{'uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740388','additionalInfo' => {},'value' => '21.12875','observationVariableDbId' => '77553','germplasmName' => 'TMEB693','studyDbId' => '165','germplasmDbId' => '41280','observationUnitName' => 'CASS_6Genotypes_107','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41298'},{'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationUnitDbId' => '41298','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitName' => 'CASS_6Genotypes_107','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','germplasmName' => 'TMEB693','studyDbId' => '165','germplasmDbId' => '41280','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740389','value' => '147.0405','additionalInfo' => {},'observationVariableDbId' => '77549'},{'studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693','value' => '31.554','additionalInfo' => {},'observationVariableDbId' => '77552','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740390','observationUnitDbId' => '41298','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_107','observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'observationDbId' => '740391','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77550','additionalInfo' => {},'value' => '10.59626','germplasmName' => 'TMEB693','germplasmDbId' => '41280','studyDbId' => '165','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_107','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41298'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_107','externalReferences' => [],'observationUnitDbId' => '41298','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationVariableDbId' => '77551','additionalInfo' => {},'value' => '46.41935','collector' => 'johndoe','observationDbId' => '740392','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_107','externalReferences' => [],'season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41298','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationVariableDbId' => '77558','additionalInfo' => {},'value' => '101.7506','observationDbId' => '740393','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693'},{'season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41298','observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_107','externalReferences' => [],'studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693','observationVariableDbId' => '77554','value' => '30.86975','additionalInfo' => {},'collector' => 'johndoe','observationDbId' => '740394','uploadedBy' => undef},{'studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693','observationVariableDbId' => '77555','additionalInfo' => {},'value' => '423.355','collector' => 'johndoe','observationDbId' => '740395','uploadedBy' => undef,'observationUnitDbId' => '41298','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_107','externalReferences' => []}],'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_107','treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}],'observationUnitDbId' => '41298','programDbId' => '134','observationUnitPosition' => {'observationLevelRelationships' => [{'levelOrder' => 0,'levelCode' => '1','levelName' => 'replicate'},{'levelName' => 'block','levelOrder' => 1,'levelCode' => '1'},{'levelName' => 'plot','levelCode' => '107','levelOrder' => 2}],'positionCoordinateY' => undef,'geoCoordinates' => undef,'positionCoordinateX' => undef,'observationLevel' => {'levelName' => 'plot','levelOrder' => 2,'levelCode' => '107'},'entryType' => 'test','positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW'}},{'germplasmName' => 'BLANK','observationUnitPUI' => 'localhost/stock/41299/view','locationName' => 'test_location','studyName' => 'CASS_6Genotypes_Sampling_2015','germplasmDbId' => '40326','studyDbId' => '165','programName' => 'test','trialName' => 'CASS_6Genotypes_Sampling_2015','locationDbId' => '23','trialDbId' => '165','additionalInfo' => {},'seedLotDbId' => undef,'programDbId' => '134','observationUnitPosition' => {'positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW','observationLevelRelationships' => [{'levelName' => 'replicate','levelOrder' => 0,'levelCode' => '1'},{'levelName' => 'block','levelOrder' => 1,'levelCode' => '2'},{'levelCode' => '201','levelOrder' => 2,'levelName' => 'plot'}],'positionCoordinateY' => undef,'observationLevel' => {'levelOrder' => 2,'levelCode' => '201','levelName' => 'plot'},'entryType' => 'test','geoCoordinates' => undef,'positionCoordinateX' => undef},'treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'observationUnitDbId' => '41299','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_201','observations' => []},{'observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'observations' => [{'uploadedBy' => undef,'observationDbId' => '740396','collector' => 'johndoe','additionalInfo' => {},'value' => '250.228','observationVariableDbId' => '77559','germplasmName' => 'TMEB693','germplasmDbId' => '41280','studyDbId' => '165','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationUnitDbId' => '41300','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}]},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41300','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','observationVariableDbId' => '77557','additionalInfo' => {},'value' => '39.2627','observationDbId' => '740397','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationUnitDbId' => '41300','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationDbId' => '740398','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77556','value' => '478.0445','additionalInfo' => {},'germplasmName' => 'TMEB693','germplasmDbId' => '41280','studyDbId' => '165'},{'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41300','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'germplasmName' => 'TMEB693','germplasmDbId' => '41280','studyDbId' => '165','observationDbId' => '740399','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77548','value' => '1295.29','additionalInfo' => {}},{'studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693','observationVariableDbId' => '77553','value' => '21.56485','additionalInfo' => {},'collector' => 'johndoe','observationDbId' => '740400','uploadedBy' => undef,'observationUnitDbId' => '41300','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => []},{'additionalInfo' => {},'value' => '169.757','observationVariableDbId' => '77549','uploadedBy' => undef,'observationDbId' => '740401','collector' => 'johndoe','germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41300','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003'},{'germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693','observationVariableDbId' => '77552','additionalInfo' => {},'value' => '26.2744','observationDbId' => '740402','collector' => 'johndoe','uploadedBy' => undef,'observationUnitDbId' => '41300','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202'},{'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41300','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'germplasmName' => 'TMEB693','studyDbId' => '165','germplasmDbId' => '41280','collector' => 'johndoe','observationDbId' => '740403','uploadedBy' => undef,'observationVariableDbId' => '77550','value' => '5.31292','additionalInfo' => {}},{'studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693','observationVariableDbId' => '77551','additionalInfo' => {},'value' => '39.4774','collector' => 'johndoe','observationDbId' => '740404','uploadedBy' => undef,'observationUnitDbId' => '41300','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => []},{'germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693','observationVariableDbId' => '77558','additionalInfo' => {},'value' => '61.51325','observationDbId' => '740405','collector' => 'johndoe','uploadedBy' => undef,'observationUnitDbId' => '41300','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202'},{'germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693','additionalInfo' => {},'value' => '36.2316','observationVariableDbId' => '77554','uploadedBy' => undef,'observationDbId' => '740406','collector' => 'johndoe','observationUnitDbId' => '41300','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202','observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41300','collector' => 'johndoe','observationDbId' => '740407','uploadedBy' => undef,'observationVariableDbId' => '77555','additionalInfo' => {},'value' => '241.418','germplasmName' => 'TMEB693','studyDbId' => '165','germplasmDbId' => '41280'}],'observationUnitPosition' => {'positionCoordinateY' => undef,'observationLevelRelationships' => [{'levelOrder' => 0,'levelCode' => '1','levelName' => 'replicate'},{'levelName' => 'block','levelCode' => '2','levelOrder' => 1},{'levelCode' => '202','levelOrder' => 2,'levelName' => 'plot'}],'positionCoordinateX' => undef,'geoCoordinates' => undef,'entryType' => 'test','observationLevel' => {'levelName' => 'plot','levelCode' => '202','levelOrder' => 2},'positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW'},'programDbId' => '134','observationUnitDbId' => '41300','treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'trialName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','trialDbId' => '165','locationDbId' => '23','seedLotDbId' => undef,'additionalInfo' => {},'germplasmName' => 'TMEB693','locationName' => 'test_location','observationUnitPUI' => 'localhost/stock/41300/view','studyName' => 'CASS_6Genotypes_Sampling_2015','studyDbId' => '165','germplasmDbId' => '41280'},{'observations' => [{'collector' => 'johndoe','observationDbId' => '740408','uploadedBy' => undef,'observationVariableDbId' => '77559','additionalInfo' => {},'value' => '245.679','germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}]},{'season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41301','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationTimeStamp' => 'NA2017-04-21_21:11:28','germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002','additionalInfo' => {},'value' => '29.4029','observationVariableDbId' => '77557','uploadedBy' => undef,'observationDbId' => '740409','collector' => 'johndoe'},{'value' => '299.096','additionalInfo' => {},'observationVariableDbId' => '77556','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740410','studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41301','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010'},{'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationUnitDbId' => '41301','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'uploadedBy' => undef,'observationDbId' => '740411','collector' => 'johndoe','value' => '1013.111','additionalInfo' => {},'observationVariableDbId' => '77548','germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165'},{'season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41301','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002','additionalInfo' => {},'value' => '17.04795','observationVariableDbId' => '77553','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740412'},{'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41301','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165','observationDbId' => '740413','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77549','additionalInfo' => {},'value' => '202.893'},{'observationVariableDbId' => '77552','value' => '40.306','additionalInfo' => {},'observationDbId' => '740414','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006'},{'observationVariableDbId' => '77550','additionalInfo' => {},'value' => '7.442495','collector' => 'johndoe','observationDbId' => '740415','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41301','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004'},{'observationVariableDbId' => '77551','additionalInfo' => {},'value' => '75.2132','observationDbId' => '740416','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationUnitDbId' => '41301','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005'},{'observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationUnitDbId' => '41301','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationTimeStamp' => 'NA2017-04-21_21:11:28','germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740417','value' => '57.47695','additionalInfo' => {},'observationVariableDbId' => '77558'},{'season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41301','observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002','observationVariableDbId' => '77554','additionalInfo' => {},'value' => '20.43645','collector' => 'johndoe','observationDbId' => '740418','uploadedBy' => undef},{'observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','additionalInfo' => {},'value' => '303.3225','observationVariableDbId' => '77555','uploadedBy' => undef,'observationDbId' => '740419','collector' => 'johndoe','germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002'}],'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationUnitDbId' => '41301','treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}],'observationUnitPosition' => {'positionCoordinateYType' => 'GRID_ROW','positionCoordinateXType' => 'GRID_COL','observationLevel' => {'levelName' => 'plot','levelOrder' => 2,'levelCode' => '203'},'entryType' => 'test','geoCoordinates' => undef,'positionCoordinateX' => undef,'observationLevelRelationships' => [{'levelName' => 'replicate','levelOrder' => 0,'levelCode' => '1'},{'levelOrder' => 1,'levelCode' => '2','levelName' => 'block'},{'levelName' => 'plot','levelCode' => '203','levelOrder' => 2}],'positionCoordinateY' => undef},'programDbId' => '134','seedLotDbId' => undef,'additionalInfo' => {},'trialDbId' => '165','locationDbId' => '23','trialName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','studyDbId' => '165','germplasmDbId' => '41282','studyName' => 'CASS_6Genotypes_Sampling_2015','locationName' => 'test_location','observationUnitPUI' => 'localhost/stock/41301/view','germplasmName' => 'IITA-TMS-IBA980002'},{'trialName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','trialDbId' => '165','locationDbId' => '23','seedLotDbId' => undef,'additionalInfo' => {},'germplasmName' => 'IITA-TMS-IBA980581','locationName' => 'test_location','observationUnitPUI' => 'localhost/stock/41302/view','studyName' => 'CASS_6Genotypes_Sampling_2015','studyDbId' => '165','germplasmDbId' => '41283','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_204','observations' => [{'observationUnitName' => 'CASS_6Genotypes_204','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationUnitDbId' => '41302','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740420','additionalInfo' => {},'value' => '235.825','observationVariableDbId' => '77559','germplasmName' => 'IITA-TMS-IBA980581','studyDbId' => '165','germplasmDbId' => '41283'},{'observationVariableDbId' => '77557','additionalInfo' => {},'value' => '31.0018','observationDbId' => '740421','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_204','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41302','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011'},{'observationUnitName' => 'CASS_6Genotypes_204','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41302','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','value' => '491.9535','additionalInfo' => {},'observationVariableDbId' => '77556','uploadedBy' => undef,'observationDbId' => '740422','collector' => 'johndoe','germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581'},{'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_204','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41302','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','additionalInfo' => {},'value' => '1302.695','observationVariableDbId' => '77548','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740423','studyDbId' => '165','germplasmDbId' => '41283','germplasmName' => 'IITA-TMS-IBA980581'},{'observationVariableDbId' => '77553','value' => '22.82925','additionalInfo' => {},'collector' => 'johndoe','observationDbId' => '740424','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41283','germplasmName' => 'IITA-TMS-IBA980581','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_204','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41302','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007'},{'studyDbId' => '165','germplasmDbId' => '41283','germplasmName' => 'IITA-TMS-IBA980581','observationVariableDbId' => '77549','additionalInfo' => {},'value' => '281.091','collector' => 'johndoe','observationDbId' => '740425','uploadedBy' => undef,'observationUnitDbId' => '41302','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_204','externalReferences' => []},{'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationUnitDbId' => '41302','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_204','externalReferences' => [],'germplasmName' => 'IITA-TMS-IBA980581','germplasmDbId' => '41283','studyDbId' => '165','observationDbId' => '740426','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77552','additionalInfo' => {},'value' => '74.1941'},{'season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41302','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_204','externalReferences' => [],'germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','observationVariableDbId' => '77550','additionalInfo' => {},'value' => '15.9235','observationDbId' => '740427','collector' => 'johndoe','uploadedBy' => undef},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_204','externalReferences' => [],'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationUnitDbId' => '41302','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'collector' => 'johndoe','observationDbId' => '740428','uploadedBy' => undef,'observationVariableDbId' => '77551','value' => '83.2802','additionalInfo' => {},'germplasmName' => 'IITA-TMS-IBA980581','studyDbId' => '165','germplasmDbId' => '41283'},{'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_204','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41302','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740429','value' => '154.109','additionalInfo' => {},'observationVariableDbId' => '77558','germplasmName' => 'IITA-TMS-IBA980581','studyDbId' => '165','germplasmDbId' => '41283'},{'germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','observationVariableDbId' => '77554','value' => '31.2364','additionalInfo' => {},'observationDbId' => '740430','collector' => 'johndoe','uploadedBy' => undef,'observationUnitDbId' => '41302','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_204'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_204','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41302','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationVariableDbId' => '77555','additionalInfo' => {},'value' => '849.9465','observationDbId' => '740431','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41283','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581'}],'observationUnitPosition' => {'entryType' => 'test','observationLevel' => {'levelCode' => '204','levelOrder' => 2,'levelName' => 'plot'},'positionCoordinateX' => undef,'geoCoordinates' => undef,'positionCoordinateY' => undef,'observationLevelRelationships' => [{'levelName' => 'replicate','levelCode' => '1','levelOrder' => 0},{'levelName' => 'block','levelCode' => '2','levelOrder' => 1},{'levelCode' => '204','levelOrder' => 2,'levelName' => 'plot'}],'positionCoordinateYType' => 'GRID_ROW','positionCoordinateXType' => 'GRID_COL'},'programDbId' => '134','observationUnitDbId' => '41302','treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}]},{'seedLotDbId' => undef,'additionalInfo' => {},'trialName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','trialDbId' => '165','locationDbId' => '23','studyName' => 'CASS_6Genotypes_Sampling_2015','studyDbId' => '165','germplasmDbId' => '41281','germplasmName' => 'IITA-TMS-IBA011412','locationName' => 'test_location','observationUnitPUI' => 'localhost/stock/41285/view','observations' => [{'observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41285','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','additionalInfo' => {},'value' => '415.062','observationVariableDbId' => '77559','uploadedBy' => undef,'observationDbId' => '740432','collector' => 'johndoe','germplasmDbId' => '41281','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA011412'},{'additionalInfo' => {},'value' => '61.2228','observationVariableDbId' => '77557','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740433','studyDbId' => '165','germplasmDbId' => '41281','germplasmName' => 'IITA-TMS-IBA011412','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_205','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41285','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011'},{'germplasmName' => 'IITA-TMS-IBA011412','germplasmDbId' => '41281','studyDbId' => '165','uploadedBy' => undef,'observationDbId' => '740434','collector' => 'johndoe','value' => '730.363','additionalInfo' => {},'observationVariableDbId' => '77556','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41285','observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'value' => '1757.615','additionalInfo' => {},'observationVariableDbId' => '77548','uploadedBy' => undef,'observationDbId' => '740435','collector' => 'johndoe','germplasmDbId' => '41281','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA011412','observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41285','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002'},{'observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41285','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740436','additionalInfo' => {},'value' => '23.07085','observationVariableDbId' => '77553','germplasmName' => 'IITA-TMS-IBA011412','studyDbId' => '165','germplasmDbId' => '41281'},{'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41285','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'germplasmName' => 'IITA-TMS-IBA011412','germplasmDbId' => '41281','studyDbId' => '165','observationDbId' => '740437','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77549','additionalInfo' => {},'value' => '276.8625'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'observationUnitDbId' => '41285','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationVariableDbId' => '77552','additionalInfo' => {},'value' => '49.3781','collector' => 'johndoe','observationDbId' => '740438','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41281','germplasmName' => 'IITA-TMS-IBA011412'},{'observationVariableDbId' => '77550','value' => '21.6087','additionalInfo' => {},'collector' => 'johndoe','observationDbId' => '740439','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41281','germplasmName' => 'IITA-TMS-IBA011412','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'observationUnitDbId' => '41285','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004'},{'observationUnitDbId' => '41285','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'germplasmDbId' => '41281','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA011412','observationVariableDbId' => '77551','value' => '86.7917','additionalInfo' => {},'observationDbId' => '740440','collector' => 'johndoe','uploadedBy' => undef},{'germplasmName' => 'IITA-TMS-IBA011412','studyDbId' => '165','germplasmDbId' => '41281','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740441','additionalInfo' => {},'value' => '73.25295','observationVariableDbId' => '77558','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationUnitDbId' => '41285','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_205','observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'value' => '17.81095','additionalInfo' => {},'observationVariableDbId' => '77554','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740442','studyDbId' => '165','germplasmDbId' => '41281','germplasmName' => 'IITA-TMS-IBA011412','observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41285','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008'},{'germplasmName' => 'IITA-TMS-IBA011412','germplasmDbId' => '41281','studyDbId' => '165','uploadedBy' => undef,'observationDbId' => '740443','collector' => 'johndoe','additionalInfo' => {},'value' => '363.986','observationVariableDbId' => '77555','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationUnitDbId' => '41285','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitName' => 'CASS_6Genotypes_205','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'}],'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_205','observationUnitDbId' => '41285','treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'programDbId' => '134','observationUnitPosition' => {'positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW','positionCoordinateY' => undef,'observationLevelRelationships' => [{'levelCode' => '1','levelOrder' => 0,'levelName' => 'replicate'},{'levelOrder' => 1,'levelCode' => '2','levelName' => 'block'},{'levelOrder' => 2,'levelCode' => '205','levelName' => 'plot'}],'observationLevel' => {'levelName' => 'plot','levelCode' => '205','levelOrder' => 2},'entryType' => 'test','geoCoordinates' => undef,'positionCoordinateX' => undef}}]}} );


$data = '[{ "additionalInfo": {"control": 1 },"germplasmDbId": "41281","germplasmName": "IITA-TMS-IBA011412","locationDbId": "23","locationName": "test_location","observationUnitName": "Testing Plot","observationUnitPUI": "1000","programDbId": "134","programName": "test","seedLotDbId": "","studyDbId": "165","studyName": "CASS_6Genotypes_Sampling_2015","treatments": [],"trialDbId": "165","trialName": "","observationUnitPosition": {"entryType": "TEST","geoCoordinates": {"geometry": {  "coordinates": [-76.506042,42.417373,155  ],  "type": "Point"},"type": "Feature"},"observationLevel": {"levelName": "plot","levelOrder": 2,"levelCode": "1000"},"observationLevelRelationships": [{  "levelCode": "Field_1",  "levelName": "field",  "levelOrder": 0},{  "levelCode": "Block_12",  "levelName": "block",  "levelOrder": 1},{  "levelCode": "Plot_123",  "levelName": "plot",  "levelOrder": 2}],"positionCoordinateX": "74","positionCoordinateXType": "GRID_COL","positionCoordinateY": "03","positionCoordinateYType": "GRID_ROW"} }]';
$mech->post('http://localhost:3010/brapi/v2/observationunits/', Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'programName' => 'test','treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'locationDbId' => '23','programDbId' => '134','trialDbId' => '165','locationName' => 'test_location','germplasmName' => 'IITA-TMS-IBA011412','observationUnitName' => 'Testing Plot','observationUnitPosition' => {'entryType' => 'check','observationLevelRelationships' => [{'levelOrder' => 0,'levelName' => 'replicate','levelCode' => '1'},{'levelOrder' => 1,'levelName' => 'block','levelCode' => 'Block_12'},{'levelOrder' => 2,'levelName' => 'plot','levelCode' => '1000'}],'geoCoordinates' => undef,'observationLevel' => {'levelCode' => '1000','levelOrder' => 2,'levelName' => 'plot'},'positionCoordinateXType' => 'GRID_COL','positionCoordinateY' => 3,'positionCoordinateYType' => 'GRID_ROW','positionCoordinateX' => 74},'observationUnitDbId' => '41782','studyDbId' => '165','observations' => [],'studyName' => 'CASS_6Genotypes_Sampling_2015','seedLotDbId' => undef,'germplasmDbId' => '41281','externalReferences' => [],'trialName' => 'CASS_6Genotypes_Sampling_2015','additionalInfo' => {},'observationUnitPUI' => 'localhost/stock/41782/view'}]},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::ObservationUnits'},{'messageType' => 'INFO','message' => 'Observation Units search result constructed'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'totalCount' => 1,'currentPage' => 0,'pageSize' => 10}}} );

$data = '[{ "additionalInfo": {"control": 1 },"germplasmDbId": "41281","germplasmName": "IITA-TMS-IBA011412","locationDbId": "23","locationName": "test_location","observationUnitName": "Testing Plot 2","observationUnitPUI": "1001","programDbId": "134","programName": "test","seedLotDbId": "","studyDbId": "165","studyName": "CASS_6Genotypes_Sampling_2015","treatments": [],"trialDbId": "165","trialName": "","observationUnitPosition": {"entryType": "TEST","geoCoordinates": {"geometry": {  "coordinates": [-76.506042,42.417373,155  ],  "type": "Point"},"type": "Feature"},"observationLevel": {"levelName": "plot","levelOrder": 2,"levelCode": "1001"},"observationLevelRelationships": [{  "levelCode": "Field_1",  "levelName": "field",  "levelOrder": 0},{  "levelCode": "Block_12",  "levelName": "block",  "levelOrder": 1},{  "levelCode": "Plot_123",  "levelName": "plot",  "levelOrder": 2}],"positionCoordinateX": "100","positionCoordinateXType": "GRID_COL","positionCoordinateY": "03","positionCoordinateYType": "GRID_ROW"} }]';
$mech->post('http://localhost:3010/brapi/v2/observationunits/', Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'studyName' => 'CASS_6Genotypes_Sampling_2015','observationUnitPUI' => 'localhost/stock/41783/view','germplasmName' => 'IITA-TMS-IBA011412','locationDbId' => '23','programName' => 'test','trialName' => 'CASS_6Genotypes_Sampling_2015','observationUnitName' => 'Testing Plot 2','additionalInfo' => {},'treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'trialDbId' => '165','germplasmDbId' => '41281','observationUnitPosition' => {'positionCoordinateXType' => 'GRID_COL','observationLevel' => {'levelOrder' => 2,'levelCode' => '1001','levelName' => 'plot'},'entryType' => 'check','positionCoordinateX' => 100,'positionCoordinateYType' => 'GRID_ROW','positionCoordinateY' => 3,'geoCoordinates' => undef,'observationLevelRelationships' => [{'levelName' => 'replicate','levelOrder' => 0,'levelCode' => '1'},{'levelName' => 'block','levelOrder' => 1,'levelCode' => 'Block_12'},{'levelName' => 'plot','levelCode' => '1001','levelOrder' => 2}]},'locationName' => 'test_location','externalReferences' => [],'observationUnitDbId' => '41783','seedLotDbId' => undef,'studyDbId' => '165','programDbId' => '134','observations' => []}]},'metadata' => {'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::ObservationUnits'},{'message' => 'Observation Units search result constructed','messageType' => 'INFO'}],'pagination' => {'totalPages' => 1,'currentPage' => 0,'totalCount' => 1,'pageSize' => 10}}} );


$mech->get_ok('http://localhost:3010/brapi/v2/observationunits/41284');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'observationUnitName' => 'CASS_6Genotypes_103','germplasmName' => 'IITA-TMS-IBA980581','treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}],'trialName' => 'CASS_6Genotypes_Sampling_2015','studyName' => 'CASS_6Genotypes_Sampling_2015','observationUnitPosition' => {'positionCoordinateX' => undef,'positionCoordinateY' => undef,'observationLevel' => {'levelOrder' => 2,'levelName' => 'plot','levelCode' => '103'},'entryType' => 'test','geoCoordinates' => undef,'observationLevelRelationships' => [{'levelOrder' => 0,'levelCode' => '1','levelName' => 'replicate'},{'levelOrder' => 1,'levelCode' => '1','levelName' => 'block'},{'levelName' => 'plot','levelCode' => '103','levelOrder' => 2}],'positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW'},'programName' => 'test','seedLotDbId' => undef,'studyDbId' => '165','trialDbId' => '165','germplasmDbId' => '41283','additionalInfo' => {},'externalReferences' => [],'locationDbId' => '23','observations' => [{'observationUnitDbId' => '41284','uploadedBy' => undef,'observationVariableDbId' => '77559','collector' => 'johndoe','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationDbId' => '740336','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','studyDbId' => '165','additionalInfo' => {},'germplasmDbId' => '41283','observationUnitName' => 'CASS_6Genotypes_103','value' => '601.518','germplasmName' => 'IITA-TMS-IBA980581'},{'externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationDbId' => '740337','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','observationUnitDbId' => '41284','uploadedBy' => undef,'observationVariableDbId' => '77557','collector' => 'johndoe','value' => '39.84365','germplasmName' => 'IITA-TMS-IBA980581','observationUnitName' => 'CASS_6Genotypes_103','studyDbId' => '165','germplasmDbId' => '41283','additionalInfo' => {}},{'collector' => 'johndoe','uploadedBy' => undef,'observationUnitDbId' => '41284','observationVariableDbId' => '77556','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationDbId' => '740338','germplasmDbId' => '41283','additionalInfo' => {},'studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','value' => '655.92','observationUnitName' => 'CASS_6Genotypes_103'},{'externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740339','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','uploadedBy' => undef,'observationUnitDbId' => '41284','observationVariableDbId' => '77548','collector' => 'johndoe','germplasmName' => 'IITA-TMS-IBA980581','observationUnitName' => 'CASS_6Genotypes_103','value' => '1259.08','studyDbId' => '165','additionalInfo' => {},'germplasmDbId' => '41283'},{'observationUnitName' => 'CASS_6Genotypes_103','value' => '17.38275','germplasmName' => 'IITA-TMS-IBA980581','studyDbId' => '165','additionalInfo' => {},'germplasmDbId' => '41283','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationDbId' => '740340','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','uploadedBy' => undef,'observationUnitDbId' => '41284','observationVariableDbId' => '77553','collector' => 'johndoe'},{'collector' => 'johndoe','observationVariableDbId' => '77549','observationUnitDbId' => '41284','uploadedBy' => undef,'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationDbId' => '740341','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'additionalInfo' => {},'germplasmDbId' => '41283','studyDbId' => '165','value' => '192.1495','observationUnitName' => 'CASS_6Genotypes_103','germplasmName' => 'IITA-TMS-IBA980581'},{'germplasmDbId' => '41283','additionalInfo' => {},'studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','value' => '67.9959','observationUnitName' => 'CASS_6Genotypes_103','collector' => 'johndoe','observationVariableDbId' => '77552','observationUnitDbId' => '41284','uploadedBy' => undef,'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationDbId' => '740342','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'collector' => 'johndoe','uploadedBy' => undef,'observationUnitDbId' => '41284','observationVariableDbId' => '77550','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationDbId' => '740343','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'germplasmDbId' => '41283','additionalInfo' => {},'studyDbId' => '165','observationUnitName' => 'CASS_6Genotypes_103','germplasmName' => 'IITA-TMS-IBA980581','value' => '20.3038'},{'observationDbId' => '740344','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationVariableDbId' => '77551','uploadedBy' => undef,'observationUnitDbId' => '41284','collector' => 'johndoe','observationUnitName' => 'CASS_6Genotypes_103','value' => '102.0875','germplasmName' => 'IITA-TMS-IBA980581','studyDbId' => '165','germplasmDbId' => '41283','additionalInfo' => {}},{'collector' => 'johndoe','observationVariableDbId' => '77558','uploadedBy' => undef,'observationUnitDbId' => '41284','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationDbId' => '740345','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'germplasmDbId' => '41283','additionalInfo' => {},'studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980581','value' => '108.56995','observationUnitName' => 'CASS_6Genotypes_103'},{'studyDbId' => '165','additionalInfo' => {},'germplasmDbId' => '41283','observationUnitName' => 'CASS_6Genotypes_103','value' => '28.83915','germplasmName' => 'IITA-TMS-IBA980581','observationVariableDbId' => '77554','observationUnitDbId' => '41284','uploadedBy' => undef,'collector' => 'johndoe','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationDbId' => '740346','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008'},{'observationDbId' => '740347','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationVariableDbId' => '77555','uploadedBy' => undef,'observationUnitDbId' => '41284','collector' => 'johndoe','germplasmName' => 'IITA-TMS-IBA980581','value' => '379.16','observationUnitName' => 'CASS_6Genotypes_103','studyDbId' => '165','germplasmDbId' => '41283','additionalInfo' => {}}],'locationName' => 'test_location','observationUnitDbId' => '41284','programDbId' => '134','observationUnitPUI' => 'localhost/stock/41284/view'},'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 1,'totalCount' => 1,'pageSize' => 10,'currentPage' => 0},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::ObservationUnits','messageType' => 'INFO'},{'message' => 'Observation Units search result constructed','messageType' => 'INFO'}]}} );

$mech->get_ok('http://localhost:3010/brapi/v2/observationunits/41299?pageSize=1&page=0');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'germplasmDbId' => '40326','programDbId' => '134','observationUnitDbId' => '41299','additionalInfo' => {},'treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}],'seedLotDbId' => undef,'trialName' => 'CASS_6Genotypes_Sampling_2015','externalReferences' => [],'observationUnitPosition' => {'positionCoordinateXType' => 'GRID_COL','observationLevel' => {'levelName' => 'plot','levelOrder' => 2,'levelCode' => '201'},'positionCoordinateY' => undef,'geoCoordinates' => undef,'entryType' => 'test','positionCoordinateX' => undef,'positionCoordinateYType' => 'GRID_ROW','observationLevelRelationships' => [{'levelName' => 'replicate','levelOrder' => 0,'levelCode' => '1'},{'levelCode' => '2','levelName' => 'block','levelOrder' => 1},{'levelCode' => '201','levelOrder' => 2,'levelName' => 'plot'}]},'germplasmName' => 'BLANK','observations' => [],'studyDbId' => '165','observationUnitPUI' => 'localhost/stock/41299/view','programName' => 'test','trialDbId' => '165','locationName' => 'test_location','locationDbId' => '23','observationUnitName' => 'CASS_6Genotypes_201','studyName' => 'CASS_6Genotypes_Sampling_2015'},'metadata' => {'pagination' => {'totalPages' => 1,'currentPage' => 0,'totalCount' => 1,'pageSize' => 1},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=1'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::ObservationUnits'},{'messageType' => 'INFO','message' => 'Observation Units search result constructed'}],'datafiles' => []}} );

$mech->get_ok('http://localhost:3010/brapi/v2/observationunits/table');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'observationVariables' => [{'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationVariableDbId' => '77559'},{'observationVariableDbId' => '77557','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011'},{'observationVariableDbId' => '77556','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010'},{'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationVariableDbId' => '77548'},{'observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','observationVariableDbId' => '77553'},{'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationVariableDbId' => '77549'},{'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationVariableDbId' => '77552'},{'observationVariableDbId' => '77550','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004'},{'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationVariableDbId' => '77551'},{'observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationVariableDbId' => '77558'},{'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationVariableDbId' => '77554'},{'observationVariableDbId' => '77555','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009'},{'observationVariableName' => 'dry matter content percentage|CO_334:0000092','observationVariableDbId' => '70741'},{'observationVariableDbId' => '70666','observationVariableName' => 'fresh root weight|CO_334:0000012'},{'observationVariableDbId' => '70773','observationVariableName' => 'fresh shoot weight measurement in kg|CO_334:0000016'},{'observationVariableName' => 'harvest index variable|CO_334:0000015','observationVariableDbId' => '70668'}],'headerRow' => ['studyYear','programDbId','programName','programDescription','studyDbId','studyName','studyDescription','studyDesign','plotWidth','plotLength','fieldSize','fieldTrialIsPlannedToBeGenotyped','fieldTrialIsPlannedToCross','plantingDate','harvestDate','locationDbId','locationName','germplasmDbId','germplasmName','germplasmSynonyms','observationLevel','observationUnitDbId','observationUnitName','replicate','blockNumber','plotNumber','rowNumber','colNumber','entryType','plantNumber','plantedSeedlotStockDbId','plantedSeedlotStockUniquename','plantedSeedlotCurrentCount','plantedSeedlotCurrentWeightGram','plantedSeedlotBoxName','plantedSeedlotTransactionCount','plantedSeedlotTransactionWeight','plantedSeedlotTransactionDescription','availableGermplasmSeedlotUniquenames'],'data' => [['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41283,'IITA-TMS-IBA980581','','plot',41284,'CASS_6Genotypes_103','1','1','103',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','601.518','39.84365','655.92','1259.08','17.38275','192.1495','67.9959','20.3038','102.0875','108.56995','28.83915','379.16',undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41282,'IITA-TMS-IBA980002','','plot',41295,'CASS_6Genotypes_104','1','1','104',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','221.6135','36.12425','316.489','908.9045','29.6934','162.9475','23.09545','14.3795','85.9106','54.2099','13.8628','341.041',undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41279,'IITA-TMS-IBA30572','','plot',41296,'CASS_6Genotypes_105','1','1','105',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','662.087','46.1458','559.441','1974.265','38.1064','484.765','33.1455','16.7238','98.71395','97.8179','35.4435','439.9695',undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41281,'IITA-TMS-IBA011412','','plot',41297,'CASS_6Genotypes_106','1','1','106',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','612.37','23.788','604.5625','646.902','26.60415','192.46','39.6698','16.78125','107.74','78.72305','28.3805','469.818',undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41280,'TMEB693','','plot',41298,'CASS_6Genotypes_107','1','1','107',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','198.089','47.64845','485.944','779.191','21.12875','147.0405','31.554','10.59626','46.41935','101.7506','30.86975','423.355',undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',40326,'BLANK','','plot',41299,'CASS_6Genotypes_201','1','2','201',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'',undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41280,'TMEB693','','plot',41300,'CASS_6Genotypes_202','1','2','202',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','250.228','39.2627','478.0445','1295.29','21.56485','169.757','26.2744','5.31292','39.4774','61.51325','36.2316','241.418',undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41282,'IITA-TMS-IBA980002','','plot',41301,'CASS_6Genotypes_203','1','2','203',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','245.679','29.4029','299.096','1013.111','17.04795','202.893','40.306','7.442495','75.2132','57.47695','20.43645','303.3225',undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41283,'IITA-TMS-IBA980581','','plot',41302,'CASS_6Genotypes_204','1','2','204',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','235.825','31.0018','491.9535','1302.695','22.82925','281.091','74.1941','15.9235','83.2802','154.109','31.2364','849.9465',undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41281,'IITA-TMS-IBA011412','','plot',41285,'CASS_6Genotypes_205','1','2','205',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','415.062','61.2228','730.363','1757.615','23.07085','276.8625','49.3781','21.6087','86.7917','73.25295','17.81095','363.986',undef,undef,undef,undef,undef]]},'metadata' => {'pagination' => {'pageSize' => 10,'currentPage' => 0,'totalCount' => 1956,'totalPages' => 196},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::ObservationTables'},{'messageType' => 'INFO','message' => 'Observation Units table result constructed'}]}} );

$mech->get_ok('http://localhost:3010/brapi/v2/observations?pageSize=2');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'currentPage' => 0,'totalCount' => 2781,'pageSize' => 2,'totalPages' => 1391},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=2','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Observations','messageType' => 'INFO'},{'message' => 'Observations result constructed','messageType' => 'INFO'}]},'result' => {'data' => [{'additionalInfo' => undef,'observationVariableDbId' => '77559','collector' => 'johndoe','germplasmName' => 'IITA-TMS-IBA980581','observationTimeStamp' => 'NA2017-04-21_21:11:28Z','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','uploadedBy' => 'johndoe','observationUnitName' => 'CASS_6Genotypes_103','value' => '601.518','germplasmDbId' => '41283','studyDbId' => '165','externalReferences' => undef,'observationDbId' => '740336','season' => [{'seasonDbId' => '2017','season' => '2017','year' => '2017'}],'observationUnitDbId' => '41284'},{'observationUnitDbId' => '41284','season' => [{'season' => '2017','seasonDbId' => '2017','year' => '2017'}],'observationDbId' => '740337','externalReferences' => undef,'studyDbId' => '165','germplasmDbId' => '41283','value' => '39.84365','observationUnitName' => 'CASS_6Genotypes_103','uploadedBy' => 'johndoe','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','observationTimeStamp' => 'NA2017-04-21_21:11:28Z','observationVariableDbId' => '77557','germplasmName' => 'IITA-TMS-IBA980581','collector' => 'johndoe','additionalInfo' => undef}]}} );

$mech->get_ok('http://localhost:3010/brapi/v2/observations/740338');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response,  {'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 1,'pageSize' => 10,'totalCount' => 1,'currentPage' => 0},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Observations'},{'messageType' => 'INFO','message' => 'Observations result constructed'}]},'result' => {'studyDbId' => '165','germplasmDbId' => '41283','value' => '655.92','observationDbId' => '740338','observationUnitDbId' => '41284','season' => [{'year' => '2017','season' => '2017','seasonDbId' => '2017'}],'externalReferences' => undef,'collector' => 'johndoe','germplasmName' => 'IITA-TMS-IBA980581','observationVariableDbId' => '77556','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationTimeStamp' => 'NA2017-04-21_21:11:28Z','additionalInfo' => undef,'observationUnitName' => 'CASS_6Genotypes_103','uploadedBy' => 'johndoe'}} );

sleep(10);

$mech->get_ok('http://localhost:3010/brapi/v2/observations/table?pageSize=2');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'headerRow' => ['studyYear','programDbId','programName','programDescription','studyDbId','studyName','studyDescription','studyDesign','plotWidth','plotLength','fieldSize','fieldTrialIsPlannedToBeGenotyped','fieldTrialIsPlannedToCross','plantingDate','harvestDate','locationDbId','locationName','germplasmDbId','germplasmName','germplasmSynonyms','observationLevel','observationUnitDbId','observationUnitName','replicate','blockNumber','plotNumber','rowNumber','colNumber','entryType','plantNumber','plantedSeedlotStockDbId','plantedSeedlotStockUniquename','plantedSeedlotCurrentCount','plantedSeedlotCurrentWeightGram','plantedSeedlotBoxName','plantedSeedlotTransactionCount','plantedSeedlotTransactionWeight','plantedSeedlotTransactionDescription','availableGermplasmSeedlotUniquenames'],'data' => [['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41283,'IITA-TMS-IBA980581','','plot',41284,'CASS_6Genotypes_103','1','1','103',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','601.518','39.84365','655.92','1259.08','17.38275','192.1495','67.9959','20.3038','102.0875','108.56995','28.83915','379.16',undef,undef,undef,undef,undef],['2017',134,'test','test',165,'CASS_6Genotypes_Sampling_2015','Copy of trial with postcomposed phenotypes from cassbase.','RCBD',undef,undef,undef,undef,undef,undef,undef,'23','test_location',41282,'IITA-TMS-IBA980002','','plot',41295,'CASS_6Genotypes_104','1','1','104',undef,undef,'test',undef,undef,undef,undef,undef,undef,undef,undef,undef,'','221.6135','36.12425','316.489','908.9045','29.6934','162.9475','23.09545','14.3795','85.9106','54.2099','13.8628','341.041',undef,undef,undef,undef,undef]],'observationVariables' => [{'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationVariableDbId' => '77559'},{'observationVariableDbId' => '77557','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011'},{'observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationVariableDbId' => '77556'},{'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationVariableDbId' => '77548'},{'observationVariableDbId' => '77553','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007'},{'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationVariableDbId' => '77549'},{'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationVariableDbId' => '77552'},{'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationVariableDbId' => '77550'},{'observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationVariableDbId' => '77551'},{'observationVariableDbId' => '77558','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012'},{'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationVariableDbId' => '77554'},{'observationVariableDbId' => '77555','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009'},{'observationVariableName' => 'dry matter content percentage|CO_334:0000092','observationVariableDbId' => '70741'},{'observationVariableDbId' => '70666','observationVariableName' => 'fresh root weight|CO_334:0000012'},{'observationVariableDbId' => '70773','observationVariableName' => 'fresh shoot weight measurement in kg|CO_334:0000016'},{'observationVariableName' => 'harvest index variable|CO_334:0000015','observationVariableDbId' => '70668'}]},'metadata' => {'pagination' => {'totalPages' => 978,'totalCount' => 1956,'currentPage' => 0,'pageSize' => 2},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=2','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::ObservationTables'},{'message' => 'Observations table result constructed','messageType' => 'INFO'}],'datafiles' => []}} );

$mech->post_ok('http://localhost:3010/brapi/v2/search/observations', ['pageSize'=>'2', 'observationDbIds' => ['740337']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v2/search/observations/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Results'},{'message' => 'search result constructed','messageType' => 'INFO'}],'pagination' => {'totalPages' => 1,'pageSize' => 10,'currentPage' => 0,'totalCount' => 1},'datafiles' => []},'result' => {'data' => [{'externalReferences' => undef,'observationDbId' => '740337','season' => [{'year' => '2017','season' => '2017','seasonDbId' => '2017'}],'observationUnitDbId' => '41284','value' => '39.84365','studyDbId' => '165','germplasmDbId' => '41283','uploadedBy' => 'johndoe','observationUnitName' => 'CASS_6Genotypes_103','additionalInfo' => undef,'germplasmName' => 'IITA-TMS-IBA980581','collector' => 'johndoe','observationVariableDbId' => '77557','observationTimeStamp' => 'NA2017-04-21_21:11:28Z','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011'}]}} );

$data = '{ "738292":  { "observationUnitDbId": 39467,  "collector": "Jane Doe", "observationTimeStamp": "2019-01-01T14:47:23-0700", "observationVariableDbId":"70773", "season": "2011",  "value": "555" }}';
#it need same variable and unit, only updates values or collector
$resp = $ua->put("http://localhost:3010/brapi/v2/observations/", Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'currentPage' => 0,'totalCount' => 1,'pageSize' => 10,'totalPages' => 1},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Observations','messageType' => 'INFO'},{'messageType' => 'info','message' => 'Request structure is valid'},{'messageType' => 'info','message' => 'Request data is valid'},{'messageType' => 'info','message' => 'File for incoming brapi obserations saved in archive.'},{'messageType' => 'INFO','message' => 'All values in your file have been successfully processed!<br><br>1 new values stored<br><br>'}]},'result' => {'data' => [{'germplasmName' => 'UG120170','observationVariableName' => 'fresh shoot weight measurement in kg','observationUnitName' => 'KASESE_TP2013_1013','observationTimeStamp' => '2019-01-01T14:47:23-0700','germplasmDbId' => 39019,'collector' => 'Jane Doe','observationDbId' => 738292,'studyDbId' => 139,'observationLevel' => 'plot','observationUnitDbId' => 39467,'observationVariableDbId' => '70773','value' => '555','uploadedBy' => 'Jane Doe'}]}});

$data = '{ "observationUnitDbId": 39548,  "collector": "John Doe", "observationTimeStamp": "2019-01-01T14:47:23-0610", "observationVariableDbId":"70741", "season": "2011",  "value": "500", "additionalInfo": {"key" : "KEY1","value" :"value1"} }';
$resp = $ua->put("http://localhost:3010/brapi/v2/observations/737987", Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'observationVariableDbId' => '70741','uploadedBy' => 'John Doe','observationUnitName' => 'KASESE_TP2013_1012','observationVariableName' => 'dry matter content percentage','value' => '500','germplasmDbId' => 39243,'observationUnitDbId' => 39548,'studyDbId' => 139,'observationLevel' => 'plot','collector' => 'John Doe','observationTimeStamp' => '2019-01-01T14:47:23-0610','germplasmName' => 'UG130133','observationDbId' => 737987, 'additionalInfo' => {'value' => 'value1','key' => 'KEY1'} }]},'metadata' => {'datafiles' => [],'pagination' => {'currentPage' => 0,'totalCount' => 1,'pageSize' => 10,'totalPages' => 1},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Observations'},{'messageType' => 'info','message' => 'Request structure is valid'},{'messageType' => 'info','message' => 'Request data is valid'},{'messageType' => 'info','message' => 'File for incoming brapi obserations saved in archive.'},{'messageType' => 'INFO','message' => 'All values in your file have been successfully processed!<br><br>1 new values stored<br><br>'}]}} );

$mech->get_ok('http://localhost:3010/brapi/v2/observations/737987');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response,  {'result' => {'observationTimeStamp' => '2019-01-01T14:47:23Z','externalReferences' => undef,'observationDbId' => '737987','additionalInfo' => {'value' => 'value1','key' => 'KEY1'},'season' => [{'seasonDbId' => '2014','year' => '2014','season' => '2014'}],'collector' => 'John Doe','observationVariableName' => 'dry matter content percentage|CO_334:0000092','observationUnitName' => 'KASESE_TP2013_1012','observationVariableDbId' => '70741','observationUnitDbId' => '39548','value' => '500','uploadedBy' => 'John Doe','studyDbId' => '139','germplasmName' => 'UG130133','germplasmDbId' => '39243'},'metadata' => {'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Observations'},{'messageType' => 'INFO','message' => 'Observations result constructed'}],'pagination' => {'totalPages' => 1,'currentPage' => 0,'pageSize' => 10,'totalCount' => 1}}} );

$data = '[ {"observationUnitDbId": 39546,  "uploadedBy": "Jane Doe", "observationTimeStamp": "2019-01-01T14:47:23-0530", "observationVariableDbId":"70741", "season": "2011",   "value": "15" } ]';
$mech->post('http://localhost:3010/brapi/v2/observations/', Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'observationUnitDbId' => 39546,'value' => '15','observationDbId' => 740534,'studyDbId' => 139,'germplasmName' => 'UG120115','observationTimeStamp' => '2019-01-01T14:47:23-0530','germplasmDbId' => 38978,'observationUnitName' => 'KASESE_TP2013_1593','observationLevel' => 'plot','collector' => 'janedoe','observationVariableName' => 'dry matter content percentage','observationVariableDbId' => '70741','uploadedBy' => 'janedoe'}]},'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Observations'},{'message' => 'Request structure is valid','messageType' => 'info'},{'messageType' => 'info','message' => 'Request data is valid'},{'messageType' => 'info','message' => 'File for incoming brapi obserations saved in archive.'},{'message' => 'All values in your file have been successfully processed!<br><br>1 new values stored<br><br>','messageType' => 'INFO'}],'pagination' => {'totalPages' => 1,'pageSize' => 10,'currentPage' => 0,'totalCount' => 1},'datafiles' => []}} );

# $mech->get_ok('http://localhost:3010/brapi/v2/variables?pageSize=2');
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# is_deeply($response,  {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=2'},{'message' => 'Loading CXGN::BrAPI::v2::ObservationVariables','messageType' => 'INFO'},{'message' => 'Observationvariable search result constructed','messageType' => 'INFO'}],'pagination' => {'totalCount' => 242,'pageSize' => 2,'totalPages' => 121,'currentPage' => 0},'datafiles' => []},'result' => {'data' => [{'synonyms' => ['abscon','AbsCt_Meas_ugg'],'observationVariableDbId' => '70692','additionalInfo' => {},'language' => 'eng','defaultValue' => '','scientist' => undef,'documentationURL' => '','institution' => undef,'observationVariableName' => 'abscisic acid content of leaf ug/g|CO_334:0000047','contextOfUse' => undef,'trait' => {'synonyms' => ['abscon','AbsCt_Meas_ugg'],'entity' => undef,'ontologyReference' => {'ontologyDbId' => 186,'ontologyName' => 'CO_334','documentationLinks' => undef,'version' => undef},'traitDbId' => '70692','externalReferences' => 'CO_334:0000047','status' => 'Active','additionalInfo' => {},'traitName' => 'abscisic acid content of leaf ug/g','traitDescription' => 'Abscisic acid content of leaf sample.','attribute' => 'abscisic acid content of leaf ug/g','traitClass' => undef,'alternativeAbbreviations' => undef,'mainAbbreviation' => undef},'status' => 'Active','externalReferences' => 'CO_334:0000047','ontologyReference' => {'documentationLinks' => undef,'ontologyDbId' => '186','ontologyName' => 'CO_334','version' => undef},'method' => {},'growthStage' => undef,'commonCropName' => 'Cassava','scale' => {'validValues' => {'categories' => [],'max' => undef,'min' => undef},'scaleDbId' => undef,'scaleName' => undef,'datatype' => '','decimalPlaces' => undef,'ontologyReference' => {},'additionalInfo' => {},'externalReferences' => ''},'submissionTimestamp' => undef},{'trait' => {'traitClass' => undef,'alternativeAbbreviations' => undef,'mainAbbreviation' => undef,'synonyms' => ['amylp','AmylPCt_Meas_pct'],'entity' => undef,'traitDbId' => '70761','additionalInfo' => {},'traitDescription' => 'Estimation of amylopectin content of cassava roots in percentage(%).','attribute' => 'amylopectin content ug/g in percentage','ontologyReference' => {'documentationLinks' => undef,'ontologyName' => 'CO_334','ontologyDbId' => 186,'version' => undef},'traitName' => 'amylopectin content ug/g in percentage','status' => 'Active','externalReferences' => 'CO_334:0000121'},'contextOfUse' => undef,'ontologyReference' => {'ontologyDbId' => '186','ontologyName' => 'CO_334','documentationLinks' => undef,'version' => undef},'externalReferences' => 'CO_334:0000121','status' => 'Active','growthStage' => undef,'method' => {},'scale' => {'externalReferences' => '','additionalInfo' => {},'ontologyReference' => {},'decimalPlaces' => undef,'scaleName' => undef,'scaleDbId' => undef,'validValues' => {'max' => undef,'min' => undef,'categories' => []},'datatype' => ''},'submissionTimestamp' => undef,'commonCropName' => 'Cassava','synonyms' => ['amylp','AmylPCt_Meas_pct'],'observationVariableDbId' => '70761','scientist' => undef,'defaultValue' => '','language' => 'eng','additionalInfo' => {},'institution' => undef,'documentationURL' => '','observationVariableName' => 'amylopectin content ug/g in percentage|CO_334:0000121'}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/variables/70752');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::ObservationVariables','messageType' => 'INFO'},{'message' => 'Observationvariable search result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'totalCount' => 1,'totalPages' => 1,'pageSize' => 10,'currentPage' => 0}},'result' => {'defaultValue' => '','synonyms' => ['"amylrt" EXACT []','"AmylR_Comp_r" EXACT []'],'contextOfUse' => undef,'status' => 'Active','observationVariableName' => 'amylose amylopectin root content ratio|CO_334:0000124','growthStage' => undef,'additionalInfo' => undef,'submissionTimestamp' => undef,'observationVariableDbId' => '70752','ontologyReference' => {'version' => undef,'ontologyName' => 'CO_334','documentationLinks' => undef,'ontologyDbId' => '186'},'language' => 'eng','commonCropName' => 'Cassava','institution' => undef,'method' => {},'scale' => {'ontologyReference' => {},'validValues' => {'max' => undef,'min' => undef,'categories' => []},'scaleDbId' => undef,'externalReferences' => [],'scaleName' => undef,'decimalPlaces' => undef,'datatype' => ''},'scientist' => undef,'documentationURL' => '','trait' => {'traitDescription' => 'The amylose content of a cassava root sample divided by the amylopectin content of the same sample.','ontologyReference' => {'documentationLinks' => undef,'ontologyName' => 'CO_334','ontologyDbId' => 186,'version' => undef},'traitClass' => undef,'externalReferences' => [],'entity' => undef,'alternativeAbbreviations' => undef,'traitName' => 'amylose amylopectin root content ratio','attribute' => 'amylose amylopectin root content ratio','status' => 'Active','mainAbbreviation' => undef,'traitDbId' => '70752','synonyms' => ['"amylrt" EXACT []','"AmylR_Comp_r" EXACT []']},'externalReferences' => [{'referenceID' => 'http://www.cropontology.org/terms/CO_334:0000124/','referenceSource' => 'Crop Ontology'}]}});

$mech->post_ok('http://localhost:3010/brapi/v2/search/variables', ['pageSize'=>'1', 'observationVariableDbIds' => ['70761']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v2/search/variables/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'documentationURL' => '','externalReferences' => [{'referenceSource' => 'Crop Ontology','referenceID' => 'http://www.cropontology.org/terms/CO_334:0000121/'}],'trait' => {'ontologyReference' => {'ontologyDbId' => 186,'documentationLinks' => undef,'ontologyName' => 'CO_334','version' => undef},'traitDescription' => 'Estimation of amylopectin content of cassava roots in percentage(%).','traitClass' => undef,'additionalInfo' => {},'externalReferences' => [],'alternativeAbbreviations' => undef,'entity' => undef,'traitName' => 'amylopectin content ug/g in percentage','attribute' => 'amylopectin content ug/g in percentage','status' => 'Active','mainAbbreviation' => undef,'traitDbId' => '70761','synonyms' => ['"amylp" EXACT []','"AmylPCt_Meas_pct" EXACT []']},'commonCropName' => undef,'language' => 'eng','method' => {},'institution' => undef,'scale' => {'scaleDbId' => undef,'ontologyReference' => {},'validValues' => {'min' => undef,'categories' => [],'max' => undef},'datatype' => '','decimalPlaces' => undef,'externalReferences' => [],'additionalInfo' => {},'scaleName' => undef},'scientist' => undef,'additionalInfo' => {},'submissionTimestamp' => undef,'observationVariableDbId' => '70761','ontologyReference' => {'version' => undef,'ontologyDbId' => '186','ontologyName' => 'CO_334','documentationLinks' => undef},'defaultValue' => '','synonyms' => ['"amylp" EXACT []','"AmylPCt_Meas_pct" EXACT []'],'contextOfUse' => undef,'status' => 'Active','growthStage' => undef,'observationVariableName' => 'amylopectin content ug/g in percentage|CO_334:0000121'}]},'metadata' => {'pagination' => {'pageSize' => 10,'totalCount' => 1,'totalPages' => 1,'currentPage' => 0},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::Results','messageType' => 'INFO'},{'message' => 'search result constructed','messageType' => 'INFO'}]}} );

$mech->get_ok('http://localhost:3010/brapi/v2/traits?pageSize=2');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'attribute' => '0 germination','externalReferences' => [],'entity' => undef,'additionalInfo' => {},'traitDescription' => 'The resumption of growth by the embryo in a seed.','traitClass' => undef,'traitName' => '0 germination','traitDbId' => '70403','ontologyReference' => {'ontologyDbId' => 102,'version' => undef,'documentationLinks' => undef,'ontologyName' => 'PO'},'status' => 'Active','synonyms' => [undef],'alternativeAbbreviations' => undef,'mainAbbreviation' => undef},{'traitName' => '1,3-beta-D-glucan synthase complex','traitDbId' => '68621','traitClass' => undef,'additionalInfo' => {},'traitDescription' => 'A protein complex that catalyzes the transfer of a glucose group from UDP-glucose to a 1,3-beta-D-glucan chain.','entity' => undef,'attribute' => '1,3-beta-D-glucan synthase complex','externalReferences' => [],'alternativeAbbreviations' => undef,'mainAbbreviation' => undef,'ontologyReference' => {'documentationLinks' => undef,'ontologyName' => 'GO','ontologyDbId' => 5,'version' => undef},'status' => 'Active','synonyms' => [undef,undef]}]},'metadata' => {'pagination' => {'pageSize' => 2,'totalPages' => 3703,'currentPage' => 0,'totalCount' => 7405},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=2','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Traits'},{'messageType' => 'INFO','message' => 'Traits list result constructed'}]}});
$mech->get_ok('http://localhost:3010/brapi/v2/traits/77216');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response,  {'result' => {'ontologyReference' => {'version' => undef,'ontologyName' => 'CHEBI','documentationLinks' => undef,'ontologyDbId' => 88},'alternativeAbbreviations' => undef,'traitDescription' => 'A monophosphoglyceric acid having the phospho group at the 3-position. It is an intermediate in metabolic pathways like glycolysis and calvin cycle.','traitName' => '3-phosphoglyceric acid','entity' => undef,'traitClass' => undef,'status' => 'Active','attribute' => '3-phosphoglyceric acid','mainAbbreviation' => undef,'traitDbId' => '77216','externalReferences' => [],'synonyms' => undef},'metadata' => {'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Traits','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Trait detail result constructed'}],'pagination' => {'totalPages' => 1,'currentPage' => 0,'totalCount' => 1,'pageSize' => 10}}});


# $mech->get_ok('http://localhost:3010/brapi/v2/ontologies?pageSize=10');
# $response = decode_json $mech->content;
# print STDERR Dumper $response;

$mech->get_ok('http://localhost:3010/brapi/v2/germplasm?pageSize=3');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'currentPage' => 0,'totalPages' => 160,'pageSize' => 3,'totalCount' => 479},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=3'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Germplasm'},{'message' => 'Germplasm result constructed','messageType' => 'INFO'}],'datafiles' => []},'result' => {'data' => [{'germplasmPUI' => 'http://localhost:3010/stock/40326/view','additionalInfo' => undef,'species' => undef,'biologicalStatusOfAccessionCode' => 0,'collection' => undef,'instituteName' => '','genus' => undef,'seedSource' => '','seedSourceDescription' => '','subtaxaAuthority' => undef,'germplasmOrigin' => [],'germplasmDbId' => '40326','donors' => [{'donorAccessionNumber' => undef,'donorInstituteCode' => undef,'germplasmPUI' => undef}],'breedingMethodDbId' => 'unknown','germplasmPreprocessing' => undef,'acquisitionDate' => '','storageTypes' => [],'subtaxa' => undef,'synonyms' => [],'documentationURL' => 'http://localhost:3010/stock/40326/view','accessionNumber' => '','taxonIds' => [],'biologicalStatusOfAccessionDescription' => undef,'pedigree' => 'NA/NA','speciesAuthority' => undef,'germplasmName' => 'BLANK','commonCropName' => undef,'countryOfOriginCode' => '','defaultDisplayName' => 'BLANK','instituteCode' => '','externalReferences' => []},{'germplasmPUI' => 'http://localhost:3010/stock/41279/view','additionalInfo' => undef,'species' => 'Manihot esculenta','biologicalStatusOfAccessionCode' => 0,'collection' => undef,'instituteName' => '','seedSource' => '','genus' => 'Manihot','seedSourceDescription' => '','subtaxaAuthority' => undef,'germplasmOrigin' => [],'germplasmDbId' => '41279','donors' => [{'germplasmPUI' => undef,'donorAccessionNumber' => undef,'donorInstituteCode' => undef}],'breedingMethodDbId' => 'unknown','germplasmPreprocessing' => undef,'storageTypes' => [],'acquisitionDate' => '','subtaxa' => undef,'synonyms' => [],'accessionNumber' => '','documentationURL' => 'http://localhost:3010/stock/41279/view','taxonIds' => [],'biologicalStatusOfAccessionDescription' => undef,'pedigree' => 'NA/NA','speciesAuthority' => undef,'germplasmName' => 'IITA-TMS-IBA30572','commonCropName' => undef,'countryOfOriginCode' => '','defaultDisplayName' => 'IITA-TMS-IBA30572','externalReferences' => [],'instituteCode' => ''},{'germplasmDbId' => '41281','germplasmOrigin' => [],'seedSourceDescription' => '','subtaxaAuthority' => undef,'genus' => 'Manihot','seedSource' => '','collection' => undef,'instituteName' => '','biologicalStatusOfAccessionCode' => 0,'species' => 'Manihot esculenta','additionalInfo' => undef,'germplasmPUI' => 'http://localhost:3010/stock/41281/view','externalReferences' => [],'instituteCode' => '','countryOfOriginCode' => '','commonCropName' => undef,'defaultDisplayName' => 'IITA-TMS-IBA011412','pedigree' => 'NA/NA','speciesAuthority' => undef,'germplasmName' => 'IITA-TMS-IBA011412','accessionNumber' => '','documentationURL' => 'http://localhost:3010/stock/41281/view','synonyms' => [],'biologicalStatusOfAccessionDescription' => undef,'taxonIds' => [],'storageTypes' => [],'acquisitionDate' => '','subtaxa' => undef,'germplasmPreprocessing' => undef,'donors' => [{'germplasmPUI' => undef,'donorInstituteCode' => undef,'donorAccessionNumber' => undef}],'breedingMethodDbId' => 'unknown'}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/germplasm/41281');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalPages' => 1,'totalCount' => 1},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::Germplasm','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Germplasm detail result constructed'}]},'result' => {'seedSourceDescription' => '','subtaxaAuthority' => undef,'genus' => 'Manihot','seedSource' => '','germplasmDbId' => '41281','germplasmOrigin' => [],'germplasmPUI' => 'http://localhost:3010/stock/41281/view','collection' => undef,'instituteName' => '','biologicalStatusOfAccessionCode' => 0,'species' => 'Manihot esculenta','additionalInfo' => undef,'pedigree' => 'NA/NA','germplasmName' => 'IITA-TMS-IBA011412','speciesAuthority' => undef,'instituteCode' => '','externalReferences' => [],'countryOfOriginCode' => '','commonCropName' => undef,'defaultDisplayName' => 'IITA-TMS-IBA011412','germplasmPreprocessing' => undef,'donors' => [{'germplasmPUI' => undef,'donorAccessionNumber' => undef,'donorInstituteCode' => undef}],'breedingMethodDbId' => 'unknown','documentationURL' => 'http://localhost:3010/stock/41281/view','accessionNumber' => '','synonyms' => [],'biologicalStatusOfAccessionDescription' => undef,'taxonIds' => [],'storageTypes' => [],'acquisitionDate' => '','subtaxa' => undef}});

$mech->get_ok('http://localhost:3010/brapi/v2/germplasm/38843/progeny');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Germplasm'},{'message' => 'Germplasm progeny result constructed','messageType' => 'INFO'}],'pagination' => {'totalCount' => 15,'totalPages' => 2,'pageSize' => 10,'currentPage' => 0},'datafiles' => []},'result' => {'germplasmName' => 'test_accession4','progeny' => [{'parentType' => 'FEMALE','germplasmDbId' => '38846','germplasmName' => 'new_test_crossP001'},{'germplasmName' => 'new_test_crossP002','germplasmDbId' => '38847','parentType' => 'FEMALE'},{'parentType' => 'FEMALE','germplasmName' => 'new_test_crossP003','germplasmDbId' => '38848'},{'parentType' => 'FEMALE','germplasmName' => 'new_test_crossP004','germplasmDbId' => '38849'},{'parentType' => 'FEMALE','germplasmName' => 'new_test_crossP005','germplasmDbId' => '38850'},{'germplasmDbId' => '38851','germplasmName' => 'new_test_crossP006','parentType' => 'FEMALE'},{'germplasmName' => 'new_test_crossP007','germplasmDbId' => '38852','parentType' => 'FEMALE'},{'parentType' => 'FEMALE','germplasmName' => 'new_test_crossP008','germplasmDbId' => '38853'},{'parentType' => 'FEMALE','germplasmName' => 'new_test_crossP009','germplasmDbId' => '38854'},{'parentType' => 'FEMALE','germplasmName' => 'new_test_crossP010','germplasmDbId' => '38855'}],'germplasmDbId' => '38843'}});

$mech->get_ok('http://localhost:3010/brapi/v2/germplasm/41279/mcpd');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalCount' => 1,'totalPages' => 1,'currentPage' => 0,'pageSize' => 10},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::Germplasm','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Germplasm detail result constructed'}]},'result' => {'storageTypeCodes' => [],'germplasmPUI' => '','collectingInfo' => {},'breedingInstitutes' => {'instituteCode' => '','instituteName' => ''},'safetyDuplicateInstitutes' => undef,'genus' => 'Manihot','species' => 'Manihot esculenta','subtaxonAuthority' => undef,'commonCropName' => undef,'remarks' => undef,'alternateIDs' => [41279],'donorInfo' => [],'speciesAuthority' => undef,'biologicalStatusOfAccessionCode' => 0,'instituteCode' => '','accessionNames' => ['IITA-TMS-IBA30572','IITA-TMS-IBA30572'],'mlsStatus' => undef,'accessionNumber' => '','acquisitionDate' => '','germplasmDbId' => '41279','subtaxon' => undef,'ancestralData' => 'NA/NA','countryOfOrigin' => ''}});

$mech->get_ok('http://localhost:3010/brapi/v2/germplasm/38876/pedigree');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 1,'currentPage' => 0,'totalCount' => 1,'pageSize' => 1},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Germplasm'},{'message' => 'Germplasm pedigree result constructed','messageType' => 'INFO'}],'datafiles' => []},'result' => {'crossingYear' => undef,'parents' => [{'germplasmDbId' => '38843','parentType' => 'FEMALE','germplasmName' => 'test_accession4'},{'germplasmDbId' => '38844','germplasmName' => 'test_accession5','parentType' => 'MALE'}],'crossingProjectDbId' => undef,'siblings' => [{'germplasmDbId' => '38846','germplasmName' => 'new_test_crossP001'},{'germplasmDbId' => '38847','germplasmName' => 'new_test_crossP002'},{'germplasmName' => 'new_test_crossP003','germplasmDbId' => '38848'},{'germplasmDbId' => '38849','germplasmName' => 'new_test_crossP004'},{'germplasmName' => 'new_test_crossP005','germplasmDbId' => '38850'},{'germplasmName' => 'new_test_crossP006','germplasmDbId' => '38851'},{'germplasmName' => 'new_test_crossP007','germplasmDbId' => '38852'},{'germplasmName' => 'new_test_crossP008','germplasmDbId' => '38853'},{'germplasmName' => 'new_test_crossP009','germplasmDbId' => '38854'},{'germplasmDbId' => '38855','germplasmName' => 'new_test_crossP010'},{'germplasmDbId' => '38873','germplasmName' => 'test5P001'},{'germplasmName' => 'test5P002','germplasmDbId' => '38874'},{'germplasmName' => 'test5P003','germplasmDbId' => '38875'},{'germplasmName' => 'test5P005','germplasmDbId' => '38877'}],'pedigree' => 'test_accession4/test_accession5','germplasmName' => 'test5P004','familyCode' => undef,'germplasmDbId' => '38876'}});

$mech->post_ok('http://localhost:3010/brapi/v2/search/germplasm', ['germplasmDbIds' => ['40326']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v2/search/germplasm/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Results','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'search result constructed'}],'datafiles' => [],'pagination' => {'pageSize' => 10,'totalPages' => 1,'totalCount' => 1,'currentPage' => 0}},'result' => {'data' => [{'pedigree' => 'NA/NA','speciesAuthority' => undef,'germplasmName' => 'BLANK','countryOfOriginCode' => '','commonCropName' => undef,'defaultDisplayName' => 'BLANK','externalReferences' => [],'instituteCode' => '','donors' => [{'donorInstituteCode' => undef,'donorAccessionNumber' => undef,'germplasmPUI' => undef}],'breedingMethodDbId' => 'unknown','germplasmPreprocessing' => undef,'storageTypes' => [],'acquisitionDate' => '','subtaxa' => undef,'documentationURL' => 'http://localhost:3010/stock/40326/view','synonyms' => [],'accessionNumber' => '','biologicalStatusOfAccessionDescription' => undef,'taxonIds' => [],'seedSource' => '','genus' => undef,'seedSourceDescription' => '','subtaxaAuthority' => undef,'germplasmOrigin' => [],'germplasmDbId' => '40326','germplasmPUI' => 'http://localhost:3010/stock/40326/view','biologicalStatusOfAccessionCode' => 0,'species' => undef,'additionalInfo' => undef,'collection' => undef,'instituteName' => ''}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/crossingprojects/');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Crossing','messageType' => 'INFO'},{'message' => 'Crossing projects result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'totalCount' => 6,'currentPage' => 0,'totalPages' => 1,'pageSize' => 10}},'result' => {'data' => [{'commonCropName' => undef,'externalReferences' => [],'additionalInfo' => {},'crossingProjectDescription' => 'CASS_6Genotypes_Sampling_2015','programDbId' => '134','programName' => 'test','crossingProjectDbId' => '165','crossingProjectName' => 'CASS_6Genotypes_Sampling_2015'},{'commonCropName' => undef,'externalReferences' => [],'crossingProjectDescription' => 'Kasese solgs trial','additionalInfo' => {},'programName' => 'test','programDbId' => '134','crossingProjectDbId' => '139','crossingProjectName' => 'Kasese solgs trial'},{'crossingProjectDbId' => '135','crossingProjectName' => 'new_test_cross','additionalInfo' => {},'crossingProjectDescription' => 'new_test_cross','externalReferences' => [],'programName' => 'test','programDbId' => '134','commonCropName' => undef},{'programName' => 'test','programDbId' => '134','externalReferences' => [],'additionalInfo' => {},'crossingProjectDescription' => 'test_t','commonCropName' => undef,'crossingProjectName' => 'test_t','crossingProjectDbId' => '144'},{'crossingProjectName' => 'test_trial','crossingProjectDbId' => '137','commonCropName' => undef,'programDbId' => '134','programName' => 'test','additionalInfo' => {},'crossingProjectDescription' => 'test_trial','externalReferences' => []},{'crossingProjectName' => 'trial2 NaCRRI','crossingProjectDbId' => '141','programDbId' => '134','programName' => 'test','externalReferences' => [],'additionalInfo' => {},'crossingProjectDescription' => 'trial2 NaCRRI','commonCropName' => undef}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/crossingprojects/139');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Crossing'},{'message' => 'Crossing projects result constructed','messageType' => 'INFO'}],'pagination' => {'currentPage' => 0,'totalCount' => 1,'pageSize' => 10,'totalPages' => 1},'datafiles' => []},'result' => {'programName' => 'test','commonCropName' => undef,'crossingProjectName' => 'Kasese solgs trial','crossingProjectDescription' => 'Kasese solgs trial','programDbId' => '134','crossingProjectDbId' => '139','additionalInfo' => {},'externalReferences' => []}});

$mech->get_ok('http://localhost:3010/brapi/v2/breedingmethods');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 1,'totalCount' => 1,'pageSize' => 10,'currentPage' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::BreedingMethods'},{'messageType' => 'INFO','message' => 'Breeding methods result constructed'}],'datafiles' => []},'result' => {'data' => [{'breedingMethodName' => undef,'breedingMethodDbId' => '','description' => undef,'abbreviation' => undef},{'abbreviation' => 'doubled_haploid','breedingMethodDbId' => '','description' => 'doubled_haploid','breedingMethodName' => 'doubled_haploid'},{'breedingMethodName' => 'self','abbreviation' => 'self','description' => 'self','breedingMethodDbId' => ''},{'breedingMethodName' => 'open','description' => 'open','breedingMethodDbId' => '','abbreviation' => 'open'},{'breedingMethodDbId' => '','description' => 'bulk','abbreviation' => 'bulk','breedingMethodName' => 'bulk'},{'breedingMethodName' => 'bulk_self','description' => 'bulk_self','breedingMethodDbId' => '','abbreviation' => 'bulk_self'},{'abbreviation' => 'biparental','breedingMethodDbId' => '','description' => 'biparental','breedingMethodName' => 'biparental'},{'breedingMethodDbId' => '','description' => 'bulk_open','abbreviation' => 'bulk_open','breedingMethodName' => 'bulk_open'}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/seedlots?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'additionalInfo' => {},'lastUpdated' => undef,'programDbId' => '134','amount' => '1','germplasmDbId' => '38846','externalReferences' => [],'seedLotName' => 'new_test_crossP001_001','seedLotDbId' => '41305','sourceCollection' => undef,'createdDate' => undef,'storageLocation' => 'NA','units' => 'seeds','seedLotDescription' => '','crossDbId' => undef,'locationDbId' => '25'},{'seedLotDescription' => '','crossDbId' => undef,'locationDbId' => '25','externalReferences' => [],'sourceCollection' => undef,'seedLotDbId' => '41306','seedLotName' => 'new_test_crossP002_001','storageLocation' => 'NA','createdDate' => undef,'units' => 'seeds','programDbId' => '134','lastUpdated' => undef,'amount' => '1','germplasmDbId' => '38847','additionalInfo' => {}},{'programDbId' => '134','lastUpdated' => undef,'germplasmDbId' => '38848','amount' => '1','additionalInfo' => {},'seedLotDescription' => '','locationDbId' => '25','crossDbId' => undef,'seedLotDbId' => '41307','seedLotName' => 'new_test_crossP003_001','sourceCollection' => undef,'externalReferences' => [],'units' => 'seeds','storageLocation' => 'NA','createdDate' => undef},{'units' => 'seeds','createdDate' => undef,'storageLocation' => 'NA','sourceCollection' => undef,'seedLotDbId' => '41308','seedLotName' => 'new_test_crossP004_001','externalReferences' => [],'locationDbId' => '25','crossDbId' => undef,'seedLotDescription' => '','additionalInfo' => {},'germplasmDbId' => '38849','amount' => '1','lastUpdated' => undef,'programDbId' => '134'},{'sourceCollection' => undef,'seedLotName' => 'new_test_crossP005_001','seedLotDbId' => '41309','externalReferences' => [],'units' => 'seeds','storageLocation' => 'NA','createdDate' => undef,'seedLotDescription' => '','locationDbId' => '25','crossDbId' => undef,'additionalInfo' => {},'programDbId' => '134','lastUpdated' => undef,'germplasmDbId' => '38850','amount' => '1'},{'seedLotDescription' => '','crossDbId' => undef,'locationDbId' => '25','externalReferences' => [],'seedLotName' => 'new_test_crossP006_001','sourceCollection' => undef,'seedLotDbId' => '41310','storageLocation' => 'NA','createdDate' => undef,'units' => 'seeds','programDbId' => '134','lastUpdated' => undef,'amount' => '1','germplasmDbId' => '38851','additionalInfo' => {}},{'locationDbId' => '25','crossDbId' => undef,'seedLotDescription' => '','units' => 'seeds','createdDate' => undef,'storageLocation' => 'NA','seedLotName' => 'new_test_crossP007_001','seedLotDbId' => '41311','sourceCollection' => undef,'externalReferences' => [],'germplasmDbId' => '38852','amount' => '1','lastUpdated' => undef,'programDbId' => '134','additionalInfo' => {}},{'createdDate' => undef,'storageLocation' => 'NA','units' => 'seeds','externalReferences' => [],'sourceCollection' => undef,'seedLotName' => 'new_test_crossP008_001','seedLotDbId' => '41312','crossDbId' => undef,'locationDbId' => '25','seedLotDescription' => '','additionalInfo' => {},'amount' => '1','germplasmDbId' => '38853','lastUpdated' => undef,'programDbId' => '134'},{'additionalInfo' => {},'amount' => '1','germplasmDbId' => '38843','lastUpdated' => undef,'programDbId' => '134','createdDate' => undef,'storageLocation' => 'NA','units' => 'seeds','externalReferences' => [],'seedLotName' => 'test_accession4_001','sourceCollection' => undef,'seedLotDbId' => '41303','crossDbId' => undef,'locationDbId' => '25','seedLotDescription' => ''},{'seedLotDescription' => '','locationDbId' => '25','crossDbId' => undef,'seedLotName' => 'test_accession5_001','seedLotDbId' => '41304','sourceCollection' => undef,'externalReferences' => [],'units' => 'seeds','storageLocation' => 'NA','createdDate' => undef,'programDbId' => '134','lastUpdated' => undef,'germplasmDbId' => '38844','amount' => '1','additionalInfo' => {}}]},'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::SeedLots','messageType' => 'INFO'},{'message' => 'Seed lots result constructed','messageType' => 'INFO'}],'pagination' => {'totalCount' => 479,'pageSize' => 10,'currentPage' => 0,'totalPages' => 48},'datafiles' => []}});

$mech->get_ok('http://localhost:3010/brapi/v2/seedlots/transactions?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 48,'totalCount' => 479,'pageSize' => 10,'currentPage' => 0},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::SeedLots','messageType' => 'INFO'},{'message' => 'Transactions result constructed','messageType' => 'INFO'}]},'result' => {'data' => [{'toSeedLotDbId' => '41781','externalReferences' => [],'fromSeedLotDbId' => '41283','additionalInfo' => {},'transactionTimestamp' => '2017-09-18T11:44:50+0000','units' => 'seeds','transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','amount' => '1','transactionDbId' => '41008'},{'amount' => '1','transactionDbId' => '41006','transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','transactionTimestamp' => '2017-09-18T11:44:50+0000','additionalInfo' => {},'units' => 'seeds','fromSeedLotDbId' => '41282','toSeedLotDbId' => '41780','externalReferences' => []},{'amount' => '1','transactionDbId' => '41004','transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','units' => 'seeds','additionalInfo' => {},'transactionTimestamp' => '2017-09-18T11:44:50+0000','fromSeedLotDbId' => '41281','externalReferences' => [],'toSeedLotDbId' => '41779'},{'transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','transactionDbId' => '41002','amount' => '1','fromSeedLotDbId' => '41280','toSeedLotDbId' => '41778','externalReferences' => [],'transactionTimestamp' => '2017-09-18T11:44:50+0000','additionalInfo' => {},'units' => 'seeds'},{'transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','transactionDbId' => '41000','amount' => '1','fromSeedLotDbId' => '41279','externalReferences' => [],'toSeedLotDbId' => '41777','units' => 'seeds','transactionTimestamp' => '2017-09-18T11:44:49+0000','additionalInfo' => {}},{'transactionDbId' => '40998','amount' => '1','transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','additionalInfo' => {},'transactionTimestamp' => '2017-09-18T11:44:49+0000','units' => 'seeds','toSeedLotDbId' => '41776','externalReferences' => [],'fromSeedLotDbId' => '41278'},{'transactionDbId' => '40996','amount' => '1','transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','units' => 'seeds','transactionTimestamp' => '2017-09-18T11:44:49+0000','additionalInfo' => {},'toSeedLotDbId' => '41775','externalReferences' => [],'fromSeedLotDbId' => '41258'},{'transactionTimestamp' => '2017-09-18T11:44:49+0000','additionalInfo' => {},'units' => 'seeds','fromSeedLotDbId' => '41257','toSeedLotDbId' => '41774','externalReferences' => [],'transactionDbId' => '40994','amount' => '1','transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085'},{'transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','transactionDbId' => '40992','amount' => '1','toSeedLotDbId' => '41773','externalReferences' => [],'fromSeedLotDbId' => '41256','transactionTimestamp' => '2017-09-18T11:44:49+0000','additionalInfo' => {},'units' => 'seeds'},{'toSeedLotDbId' => '41772','externalReferences' => [],'fromSeedLotDbId' => '41255','units' => 'seeds','additionalInfo' => {},'transactionTimestamp' => '2017-09-18T11:44:49+0000','transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','transactionDbId' => '40990','amount' => '1'}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/seedlots/41310?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::SeedLots'},{'message' => 'Seed lots result constructed','messageType' => 'INFO'}],'pagination' => {'pageSize' => 10,'totalCount' => 1,'currentPage' => 0,'totalPages' => 1},'datafiles' => []},'result' => {'sourceCollection' => undef,'externalReferences' => [],'additionalInfo' => {},'crossDbId' => undef,'amount' => 1,'createdDate' => undef,'storageLocation' => 'NA','units' => 'seeds','locationDbId' => '25','lastUpdated' => undef,'seedLotDbId' => '41310','seedLotDescription' => '','germplasmDbId' => '38851','programDbId' => '134','seedLotName' => 'new_test_crossP006_001'}});

$mech->get_ok('http://localhost:3010/brapi/v2/seedlots/41305/transactions?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::SeedLots'},{'messageType' => 'INFO','message' => 'Transactions result constructed'}],'pagination' => {'currentPage' => 0,'totalPages' => 1,'totalCount' => 1,'pageSize' => 10}},'result' => {'data' => [{'externalReferences' => [],'additionalInfo' => {},'toSeedLotDbId' => '41305','fromSeedLotDbId' => '38846','units' => 'seeds','transactionDbId' => '40056','transactionDescription' => 'Auto generated seedlot from accession. DbPatch 00085','transactionTimestamp' => '2017-09-18T11:43:59+0000','amount' => '1'}]}});

$data = '[{ "amount":30, "weight":3000, "germplasmDbId":38848, "locationDbId":23, "programDbId":134, "seedLotDescription":"brap test", "seedLotName":"SeedLots test2", "sourceCollection":"box", "lastUpdated": "2020-06-01T14:47:23-0600" }]';
$mech->post('http://localhost:3010/brapi/v2/seedlots?access_token='.$access_token, Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response,  {'metadata' => {'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::SeedLots','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Seed lots stored'}],'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalPages' => 1,'totalCount' => 1}},'result' => {'data' => [{'storageLocation' => 'test_location','seedLotDbId' => '41784','sourceCollection' => undef,'createdDate' => undef,'seedLotName' => 'SeedLots test2','units' => 'seeds','externalReferences' => [],'amount' => '30','seedLotDescription' => 'brap test','germplasmDbId' => '38848','locationDbId' => '23','programDbId' => '134','lastUpdated' => undef,'additionalInfo' => {}}]}});


$data = '[{ "amount":300, "toSeedLotDbId":41307, "fromSeedLotDbId":41305, "transactionDescription":"BrAPI transactions test2", "transactionTimestamp": "2020-06-01T14:47:23-0600" }]';
$mech->post('http://localhost:3010/brapi/v2/seedlots/transactions?access_token='.$access_token, Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'units' => 'seeds','additionalInfo' => {},'transactionTimestamp' => '2020-06-01T14:47:23-0600','transactionDescription' => 'BrAPI transactions test2','fromSeedLotDbId' => '41305','amount' => 300,'transactionDbId' => '41013','toSeedLotDbId' => '41307','externalReferences' => []}]},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::SeedLots'},{'messageType' => 'INFO','message' => 'Transactions stored'}],'datafiles' => [],'pagination' => {'currentPage' => 0,'totalPages' => 1,'pageSize' => 10,'totalCount' => 1}}} );

$data = '{ "additionalInfo": {}, "amount": 561, "createdDate": "2020-08-05T20:11:51.636Z", "externalReferences": [], "germplasmDbId": "38848", "lastUpdated": "2020-08-05T20:11:51.636Z", "locationDbId": "23", "programDbId": "134", "seedLotDescription": "This is a description of a seed lot", "seedLotName": "Seed Lot Alpha", "sourceCollection": "nursery", "storageLocation": "The storage location", "units": "seeds" }';
$resp = $ua->put("http://localhost:3010/brapi/v2/seedlots/41310?access_token=".$access_token, Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'result' => {'crossDbId' => '','createdDate' => undef,'lastUpdated' => undef,'amount' => 1,'units' => 'seeds','externalReferences' => [],'seedLotDbId' => '41310','germplasmDbId' => '38848','programDbId' => '134','additionalInfo' => {},'storageLocation' => 'test_location','seedLotName' => 'Seed Lot Alpha','sourceCollection' => undef,'seedLotDescription' => 'This is a description of a seed lot','locationDbId' => '23'},'metadata' => {'pagination' => {'totalPages' => 1,'currentPage' => 0,'pageSize' => 10,'totalCount' => 1},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::SeedLots','messageType' => 'INFO'},{'message' => 'Seed lots updated','messageType' => 'INFO'}],'datafiles' => []}} );

$mech->get_ok('http://localhost:3010/brapi/v2/calls');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'sepPhased' => undef,'sepUnphased' => undef,'data' => [{'callSetName' => 'UG120001','phaseSet' => undef,'callSetDbId' => '38878','additionalInfo' => undef,'variantName' => 'S10114_185859','genotype' => {'values' => '0'},'genotype_likelihood' => undef,'variantDbId' => 'S10114_185859'},{'genotype' => {'values' => '0'},'variantName' => 'S10173_777651','additionalInfo' => undef,'variantDbId' => 'S10173_777651','genotype_likelihood' => undef,'phaseSet' => undef,'callSetName' => 'UG120001','callSetDbId' => '38878'},{'genotype' => {'values' => '2'},'phaseSet' => undef,'additionalInfo' => undef,'variantName' => 'S10173_899514','callSetName' => 'UG120001','variantDbId' => 'S10173_899514','callSetDbId' => '38878','genotype_likelihood' => undef},{'callSetDbId' => '38878','phaseSet' => undef,'callSetName' => 'UG120001','variantDbId' => 'S10241_146006','genotype_likelihood' => undef,'genotype' => {'values' => '0'},'additionalInfo' => undef,'variantName' => 'S10241_146006'},{'variantName' => 'S1027_465354','additionalInfo' => undef,'genotype' => {'values' => '2'},'genotype_likelihood' => undef,'variantDbId' => 'S1027_465354','callSetName' => 'UG120001','phaseSet' => undef,'callSetDbId' => '38878'},{'additionalInfo' => undef,'variantName' => 'S10367_21679','genotype' => {'values' => '0'},'genotype_likelihood' => undef,'variantDbId' => 'S10367_21679','callSetName' => 'UG120001','phaseSet' => undef,'callSetDbId' => '38878'},{'variantName' => 'S1046_216535','additionalInfo' => undef,'callSetName' => 'UG120001','genotype' => {'values' => '0'},'phaseSet' => undef,'genotype_likelihood' => undef,'variantDbId' => 'S1046_216535','callSetDbId' => '38878'},{'callSetDbId' => '38878','phaseSet' => undef,'callSetName' => 'UG120001','variantDbId' => 'S10493_191533','genotype_likelihood' => undef,'genotype' => {'values' => '1'},'variantName' => 'S10493_191533','additionalInfo' => undef},{'genotype' => {'values' => '2'},'additionalInfo' => undef,'variantName' => 'S10493_282956','variantDbId' => 'S10493_282956','genotype_likelihood' => undef,'phaseSet' => undef,'callSetName' => 'UG120001','callSetDbId' => '38878'},{'genotype' => {'values' => '0'},'variantName' => 'S10493_529025','additionalInfo' => undef,'variantDbId' => 'S10493_529025','genotype_likelihood' => undef,'phaseSet' => undef,'callSetName' => 'UG120001','callSetDbId' => '38878'}],'unknownString' => undef,'expandHomozygotes' => undef},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::Calls','messageType' => 'INFO'},{'message' => 'Calls result constructed','messageType' => 'INFO'}],'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalPages' => 26750,'totalCount' => 267500},'datafiles' => []}});

$mech->post_ok('http://localhost:3010/brapi/v2/search/calls', ['callSetDbIds' => ['38878']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v2/search/calls/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'genotype_likelihood' => undef,'variantDbId' => 'S10114_185859','additionalInfo' => undef,'callSetDbId' => '38878','phaseSet' => undef,'genotype' => {'values' => '0'},'callSetName' => 'UG120001','variantName' => 'S10114_185859'},{'variantDbId' => 'S10173_777651','genotype_likelihood' => undef,'variantName' => 'S10173_777651','callSetDbId' => '38878','phaseSet' => undef,'additionalInfo' => undef,'callSetName' => 'UG120001','genotype' => {'values' => '0'}},{'variantName' => 'S10173_899514','variantDbId' => 'S10173_899514','genotype_likelihood' => undef,'callSetName' => 'UG120001','genotype' => {'values' => '2'},'callSetDbId' => '38878','phaseSet' => undef,'additionalInfo' => undef},{'variantName' => 'S10241_146006','genotype_likelihood' => undef,'variantDbId' => 'S10241_146006','genotype' => {'values' => '0'},'callSetName' => 'UG120001','additionalInfo' => undef,'phaseSet' => undef,'callSetDbId' => '38878'},{'variantDbId' => 'S1027_465354','genotype_likelihood' => undef,'phaseSet' => undef,'callSetDbId' => '38878','additionalInfo' => undef,'callSetName' => 'UG120001','genotype' => {'values' => '2'},'variantName' => 'S1027_465354'},{'callSetDbId' => '38878','phaseSet' => undef,'additionalInfo' => undef,'callSetName' => 'UG120001','genotype' => {'values' => '0'},'variantDbId' => 'S10367_21679','genotype_likelihood' => undef,'variantName' => 'S10367_21679'},{'genotype' => {'values' => '0'},'callSetName' => 'UG120001','additionalInfo' => undef,'callSetDbId' => '38878','phaseSet' => undef,'variantName' => 'S1046_216535','genotype_likelihood' => undef,'variantDbId' => 'S1046_216535'},{'genotype' => {'values' => '1'},'callSetName' => 'UG120001','additionalInfo' => undef,'phaseSet' => undef,'callSetDbId' => '38878','variantName' => 'S10493_191533','genotype_likelihood' => undef,'variantDbId' => 'S10493_191533'},{'genotype_likelihood' => undef,'variantDbId' => 'S10493_282956','variantName' => 'S10493_282956','additionalInfo' => undef,'callSetDbId' => '38878','phaseSet' => undef,'genotype' => {'values' => '2'},'callSetName' => 'UG120001'},{'variantName' => 'S10493_529025','variantDbId' => 'S10493_529025','genotype_likelihood' => undef,'callSetName' => 'UG120001','genotype' => {'values' => '0'},'callSetDbId' => '38878','phaseSet' => undef,'additionalInfo' => undef}]},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::Results','messageType' => 'INFO'},{'message' => 'search result constructed','messageType' => 'INFO'}],'pagination' => {'currentPage' => 0,'totalPages' => 1,'pageSize' => 10,'totalCount' => 10},'datafiles' => []}});

$mech->get_ok('http://localhost:3010/brapi/v2/callsets/?callSetDbId=38879');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'studyDbId' => ['140','142'],'variantSetDbIds' => ['140p1','142p1'],'sampleDbId' => '38879','additionalInfo' => {'germplasmDbId' => '38879'},'created' => undef,'updated' => undef,'callSetName' => 'UG120002','callSetDbId' => '38879'}]},'metadata' => {'pagination' => {'totalPages' => 1,'pageSize' => 10,'totalCount' => 1,'currentPage' => 0},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::CallSets','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'CallSets result constructed'}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/callsets/38880');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 1,'pageSize' => 10,'totalCount' => 1,'currentPage' => 0},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::CallSets','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'CallSets detail result constructed'}]},'result' => {'created' => undef,'sampleDbId' => '38880','callSetName' => 'UG120003','studyDbId' => ['140','142'],'variantSetDbIds' => ['140p1','142p1'],'callSetDbId' => '38880','updated' => undef,'additionalInfo' => {'germplasmDbId' => '38880'}}});

$mech->get_ok('http://localhost:3010/brapi/v2/callsets/38882/calls');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'unknownString' => undef,'sepUnphased' => undef,'expandHomozygotes' => undef,'data' => [{'variantDbId' => 'S10114_185859','phaseSet' => undef,'callSetName' => 'UG120005','variantName' => 'S10114_185859','callSetDbId' => '38882','genotype_likelihood' => undef,'genotype' => {'values' => '1'},'additionalInfo' => undef},{'callSetName' => 'UG120005','phaseSet' => undef,'variantDbId' => 'S10173_777651','callSetDbId' => '38882','variantName' => 'S10173_777651','genotype_likelihood' => undef,'additionalInfo' => undef,'genotype' => {'values' => '0'}},{'callSetName' => 'UG120005','variantDbId' => 'S10173_899514','phaseSet' => undef,'callSetDbId' => '38882','variantName' => 'S10173_899514','genotype_likelihood' => undef,'additionalInfo' => undef,'genotype' => {'values' => '0'}},{'genotype_likelihood' => undef,'additionalInfo' => undef,'genotype' => {'values' => '0'},'callSetName' => 'UG120005','phaseSet' => undef,'variantDbId' => 'S10241_146006','callSetDbId' => '38882','variantName' => 'S10241_146006'},{'genotype_likelihood' => undef,'additionalInfo' => undef,'genotype' => {'values' => '2'},'callSetName' => 'UG120005','phaseSet' => undef,'variantDbId' => 'S1027_465354','callSetDbId' => '38882','variantName' => 'S1027_465354'},{'callSetName' => 'UG120005','phaseSet' => undef,'variantDbId' => 'S10367_21679','callSetDbId' => '38882','variantName' => 'S10367_21679','genotype_likelihood' => undef,'additionalInfo' => undef,'genotype' => {'values' => '0'}},{'genotype_likelihood' => undef,'genotype' => {'values' => '0'},'additionalInfo' => undef,'phaseSet' => undef,'variantDbId' => 'S1046_216535','callSetName' => 'UG120005','variantName' => 'S1046_216535','callSetDbId' => '38882'},{'callSetDbId' => '38882','variantName' => 'S10493_191533','callSetName' => 'UG120005','phaseSet' => undef,'variantDbId' => 'S10493_191533','additionalInfo' => undef,'genotype' => {'values' => '2'},'genotype_likelihood' => undef},{'genotype_likelihood' => undef,'genotype' => {'values' => '2'},'additionalInfo' => undef,'variantDbId' => 'S10493_282956','phaseSet' => undef,'callSetName' => 'UG120005','variantName' => 'S10493_282956','callSetDbId' => '38882'},{'genotype_likelihood' => undef,'additionalInfo' => undef,'genotype' => {'values' => '1'},'callSetName' => 'UG120005','phaseSet' => undef,'variantDbId' => 'S10493_529025','callSetDbId' => '38882','variantName' => 'S10493_529025'}],'sepPhased' => undef},'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 10,'totalPages' => 100,'currentPage' => 0,'totalCount' => 1000},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::CallSets'},{'messageType' => 'INFO','message' => 'Markerprofiles allelematrix result constructed'}]}});

$mech->post_ok('http://localhost:3010/brapi/v2/search/callsets', ['callSetDbIds' => ['38881']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v2/search/callsets/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'additionalInfo' => {'germplasmDbId' => '38881'},'variantSetDbIds' => ['140p1','142p1'],'sampleDbId' => '38881','studyDbId' => ['140','142'],'callSetDbId' => '38881','updated' => undef,'callSetName' => 'UG120004','created' => undef}]},'metadata' => {'pagination' => {'totalPages' => 1,'pageSize' => 10,'currentPage' => 0,'totalCount' => 1},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Results'},{'messageType' => 'INFO','message' => 'search result constructed'}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/variantsets/?studyDbId=140');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response,  {'result' => {'data' => [{'variantCount' => 500,'referenceSetDbId' => '1','additionalInfo' => {},'variantSetName' => 'test_genotyping_project - GBS ApeKI genotyping v4','studyDbId' => '140','analysis' => [{'updated' => undef,'software' => undef,'analysisName' => 'GBS ApeKI genotyping v4','created' => undef,'description' => undef,'analysisDbId' => '1','type' => undef}],'availableFormats' => [{'dataFormat' => 'json','fileFormat' => 'json','fileURL' => undef}],'callSetCount' => 235,'variantSetDbId' => '140p1'}]},'metadata' => {'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::VariantSets','messageType' => 'INFO'},{'message' => 'VariantSets result constructed','messageType' => 'INFO'}],'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalPages' => 1,'totalCount' => 1}}});

$mech->get_ok('http://localhost:3010/brapi/v2/variantsets/142p1');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::VariantSets','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'VariantSets result constructed'}],'pagination' => {'totalCount' => 1,'totalPages' => 1,'currentPage' => 0,'pageSize' => 10},'datafiles' => []},'result' => {'studyDbId' => '142','variantCount' => 500,'referenceSetDbId' => '1','variantSetDbId' => '142p1','variantSetName' => 'test_population2 - GBS ApeKI genotyping v4','availableFormats' => [{'dataFormat' => 'json','fileFormat' => 'json','fileURL' => undef}],'analysis' => [{'description' => undef,'type' => undef,'analysisDbId' => '1','analysisName' => 'GBS ApeKI genotyping v4','created' => undef,'updated' => undef,'software' => undef}],'callSetCount' => 280,'additionalInfo' => {}}});

$mech->get_ok('http://localhost:3010/brapi/v2/variantsets/142p1/calls');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::VariantSets','messageType' => 'INFO'},{'message' => 'VariantSets result constructed','messageType' => 'INFO'}],'pagination' => {'totalPages' => 14000,'totalCount' => 140000,'pageSize' => 10,'currentPage' => 0},'datafiles' => []},'result' => {'unknownString' => undef,'expandHomozygotes' => undef,'sepUnphased' => undef,'data' => [{'phaseSet' => undef,'variantName' => 'S10114_185859','additionalInfo' => {},'callSetDbId' => '38878','variantDbId' => 'S10114_185859','genotype' => {'values' => '0'},'callSetName' => 'UG120001','genotype_likelihood' => undef},{'genotype_likelihood' => undef,'callSetDbId' => '38878','additionalInfo' => {},'variantName' => 'S10173_777651','genotype' => {'values' => '0'},'callSetName' => 'UG120001','variantDbId' => 'S10173_777651','phaseSet' => undef},{'phaseSet' => undef,'callSetName' => 'UG120001','genotype' => {'values' => '2'},'variantDbId' => 'S10173_899514','callSetDbId' => '38878','additionalInfo' => {},'variantName' => 'S10173_899514','genotype_likelihood' => undef},{'genotype' => {'values' => '0'},'callSetName' => 'UG120001','variantDbId' => 'S10241_146006','additionalInfo' => {},'callSetDbId' => '38878','variantName' => 'S10241_146006','phaseSet' => undef,'genotype_likelihood' => undef},{'phaseSet' => undef,'genotype_likelihood' => undef,'callSetName' => 'UG120001','genotype' => {'values' => '2'},'variantDbId' => 'S1027_465354','callSetDbId' => '38878','additionalInfo' => {},'variantName' => 'S1027_465354'},{'genotype_likelihood' => undef,'variantName' => 'S10367_21679','additionalInfo' => {},'callSetDbId' => '38878','variantDbId' => 'S10367_21679','callSetName' => 'UG120001','genotype' => {'values' => '0'},'phaseSet' => undef},{'phaseSet' => undef,'callSetName' => 'UG120001','genotype' => {'values' => '0'},'variantDbId' => 'S1046_216535','additionalInfo' => {},'callSetDbId' => '38878','variantName' => 'S1046_216535','genotype_likelihood' => undef},{'genotype' => {'values' => '1'},'callSetName' => 'UG120001','variantDbId' => 'S10493_191533','additionalInfo' => {},'callSetDbId' => '38878','variantName' => 'S10493_191533','phaseSet' => undef,'genotype_likelihood' => undef},{'phaseSet' => undef,'genotype_likelihood' => undef,'variantName' => 'S10493_282956','additionalInfo' => {},'callSetDbId' => '38878','variantDbId' => 'S10493_282956','callSetName' => 'UG120001','genotype' => {'values' => '2'}},{'phaseSet' => undef,'variantDbId' => 'S10493_529025','callSetName' => 'UG120001','genotype' => {'values' => '0'},'variantName' => 'S10493_529025','callSetDbId' => '38878','additionalInfo' => {},'genotype_likelihood' => undef}],'sepPhased' => undef}});

$mech->get_ok('http://localhost:3010/brapi/v2/variantsets/140p1/callsets');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::VariantSets'},{'message' => 'VariantSets result constructed','messageType' => 'INFO'}],'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalPages' => 24,'totalCount' => 235}},'result' => {'data' => [{'additionalInfo' => {},'callSetDbId' => '38878','callSetName' => 'UG120001','created' => undef,'sampleDbId' => '38878','updated' => undef,'studyDbId' => '140','variantSetDbIds' => ['140p1']},{'callSetName' => 'UG120002','callSetDbId' => '38879','additionalInfo' => {},'sampleDbId' => '38879','created' => undef,'studyDbId' => '140','updated' => undef,'variantSetDbIds' => ['140p1']},{'updated' => undef,'studyDbId' => '140','variantSetDbIds' => ['140p1'],'callSetName' => 'UG120003','additionalInfo' => {},'callSetDbId' => '38880','sampleDbId' => '38880','created' => undef},{'updated' => undef,'studyDbId' => '140','variantSetDbIds' => ['140p1'],'callSetName' => 'UG120004','callSetDbId' => '38881','additionalInfo' => {},'sampleDbId' => '38881','created' => undef},{'studyDbId' => '140','updated' => undef,'variantSetDbIds' => ['140p1'],'additionalInfo' => {},'callSetDbId' => '38882','callSetName' => 'UG120005','created' => undef,'sampleDbId' => '38882'},{'studyDbId' => '140','updated' => undef,'variantSetDbIds' => ['140p1'],'additionalInfo' => {},'callSetDbId' => '38883','callSetName' => 'UG120006','sampleDbId' => '38883','created' => undef},{'callSetName' => 'UG120007','additionalInfo' => {},'callSetDbId' => '38884','created' => undef,'sampleDbId' => '38884','updated' => undef,'studyDbId' => '140','variantSetDbIds' => ['140p1']},{'created' => undef,'sampleDbId' => '38885','callSetDbId' => '38885','additionalInfo' => {},'callSetName' => 'UG120008','variantSetDbIds' => ['140p1'],'studyDbId' => '140','updated' => undef},{'studyDbId' => '140','updated' => undef,'variantSetDbIds' => ['140p1'],'callSetDbId' => '38886','additionalInfo' => {},'callSetName' => 'UG120009','sampleDbId' => '38886','created' => undef},{'variantSetDbIds' => ['140p1'],'updated' => undef,'studyDbId' => '140','sampleDbId' => '38887','created' => undef,'callSetDbId' => '38887','additionalInfo' => {},'callSetName' => 'UG120010'}]}} );

#no data for variants
# $mech->get_ok('http://localhost:3010/brapi/v2/variants');
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# $mech->get_ok('http://localhost:3010/brapi/v2/variantsets/140p1/variants');
# $response = decode_json $mech->content;
# print STDERR Dumper $response;


$mech->post_ok('http://localhost:3010/brapi/v2/search/variantsets', ['variantSetDbIds' => ['143p1']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
$mech->get_ok('http://localhost:3010/brapi/v2/search/variantsets/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Results','messageType' => 'INFO'},{'message' => 'search result constructed','messageType' => 'INFO'}],'pagination' => {'totalCount' => 1,'totalPages' => 1,'currentPage' => 0,'pageSize' => 10},'datafiles' => []},'result' => {'data' => [{'referenceSetDbId' => '1','additionalInfo' => {},'variantCount' => 500,'variantSetDbId' => '143p1','callSetCount' => 20,'availableFormats' => [{'fileURL' => undef,'dataFormat' => 'json','fileFormat' => 'json'}],'analysis' => [{'description' => undef,'created' => undef,'analysisName' => 'GBS ApeKI genotyping v4','software' => undef,'type' => undef,'analysisDbId' => '1','updated' => undef}],'studyDbId' => '143','variantSetName' => 'selection_population - GBS ApeKI genotyping v4'}]}});

$mech->post_ok('http://localhost:3010/brapi/v2/variantsets/extract', ['variantSetDbIds' => ['142p1']]);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'callSetCount' => 280,'variantSetDbId' => '142p1','variantCount' => 500,'studyDbId' => '142','referenceSetDbId' => '1','variantSetName' => 'test_population2 - GBS ApeKI genotyping v4','availableFormats' => [{'fileURL' => undef,'fileFormat' => 'json','dataFormat' => 'json'}],'additionalInfo' => {},'analysis' => [{'software' => undef,'description' => undef,'created' => undef,'analysisName' => 'GBS ApeKI genotyping v4','type' => undef,'analysisDbId' => '1','updated' => undef}]}]},'metadata' => {'datafiles' => [],'pagination' => {'totalCount' => 1,'totalPages' => 1,'pageSize' => 10,'currentPage' => 0},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::VariantSets'},{'messageType' => 'INFO','message' => 'VariantSets result constructed'}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/trials/');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => []},'metadata' => {'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalPages' => 0,'totalCount' => 0},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Trials'},{'messageType' => 'INFO','message' => 'Trials result constructed'}],'datafiles' => []}} );


$mech->get_ok('http://localhost:3010/brapi/v2/programs');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'pagination' => {'totalCount' => 1,'totalPages' => 1,'pageSize' => 10,'currentPage' => 0},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Programs'},{'message' => 'Program list result constructed','messageType' => 'INFO'}]},'result' => {'data' => [{'abbreviation' => '','externalReferences' => [],'objective' => 'test','leadPersonDbId' => '','leadPersonName' => '','programDbId' => '134','additionalInfo' => {},'programName' => 'test','documentationURL' => undef,'commonCropName' => 'Cassava'}]}} );

$data = '[{"abbreviation": "P1","additionalInfo": {},"commonCropName": "Tomatillo","documentationURL": "","externalReferences": [],"leadPersonDbId": "50","leadPersonName": "Bob","objective": "Make a better tomatillo","programName": "program3" }, {"abbreviation": "P1","additionalInfo": {},"commonCropName": "Tomatillo","documentationURL": "","externalReferences": [],"leadPersonDbId": "50","leadPersonName": "Bob","objective": "Make a better tomatillo","programName": "Program4" }]';
$mech->post('http://localhost:3010/brapi/v2/programs/', Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Programs'},{'message' => '2 Programs were stored.','messageType' => 'INFO'}],'datafiles' => undef,'pagination' => {'totalCount' => 2,'totalPages' => 1,'currentPage' => 0,'pageSize' => 10}},'result' => {}} );

$mech->get_ok('http://localhost:3010/brapi/v2/programs/134');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'pageSize' => 10,'currentPage' => 0,'totalCount' => 1,'totalPages' => 1},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Programs'},{'message' => 'Program list result constructed','messageType' => 'INFO'}]},'result' => {'leadPersonName' => undef,'programDbId' => '134','externalReferences' => [],'abbreviation' => undef,'leadPersonDbId' => undef,'objective' => 'test','commonCropName' => 'Cassava','documentationURL' => undef,'additionalInfo' => {},'programName' => 'test'}} );

$data = '{ "abbreviation": "P1","additionalInfo": {},"commonCropName": "Tomatillo","documentationURL": "https://breedbase.org/","externalReferences": [],"leadPersonDbId": "fe6f5c50","leadPersonName": "Bob Robertson","objective": "Make a better tomatillo","programName": "Program5" }';
$resp = $ua->put("http://localhost:3010/brapi/v2/programs/167", Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'result' => {},'metadata' => {'datafiles' => undef,'pagination' => {'totalPages' => 1,'pageSize' => 10,'currentPage' => 0,'totalCount' => 1},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Programs','messageType' => 'INFO'},{'messageType' => 'INFO','message' => '1 Program updated.'}]}} );

$mech->post_ok('http://localhost:3010/brapi/v2/search/programs', ['programDbIds'=>'134']);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
$mech->get_ok('http://localhost:3010/brapi/v2/search/programs/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalPages' => 1,'totalCount' => 1},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::Results','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'search result constructed'}]},'result' => {'data' => [{'programName' => 'test','documentationURL' => undef,'additionalInfo' => {},'commonCropName' => undef,'objective' => 'test','leadPersonDbId' => '','abbreviation' => '','externalReferences' => [],'programDbId' => '134','leadPersonName' => ''}]}} );

$mech->get_ok('http://localhost:3010/brapi/v2/commoncropnames');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => ['Cassava']},'metadata' => {'datafiles' => [],'pagination' => {'totalPages' => 1,'currentPage' => 0,'pageSize' => 10,'totalCount' => 1},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::CommonCropNames'},{'messageType' => 'INFO','message' => 'Crops result constructed'}]}});


$mech->get_ok('http://localhost:3010/brapi/v2/studies/?pageSize=3');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'environmentParameters' => undef,'trialDbId' => '134','lastUpdate' => undef,'studyDescription' => 'Copy of trial with postcomposed phenotypes from cassbase.','observationLevels' => undef,'studyCode' => undef,'endDate' => undef,'seasons' => ['2017'],'studyPUI' => undef,'trialName' => 'test','observationUnitsDescription' => undef,'growthFacility' => undef,'studyType' => 'Preliminary Yield Trial','studyDbId' => '165','documentationURL' => '','locationName' => 'test_location','license' => '','contacts' => undef,'externalReferences' => undef,'locationDbId' => '23','active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'startDate' => undef,'studyName' => 'CASS_6Genotypes_Sampling_2015','commonCropName' => 'Cassava','dataLinks' => [],'additionalInfo' => {'programName' => 'test','companyDbId' => '1','programDbId' => '134','companyName' => 'ImageBreed'},'culturalPractices' => undef,'experimentalDesign' => {'PUI' => undef,'description' => 'RCBD'}},{'documentationURL' => '','studyDbId' => '139','locationDbId' => '23','externalReferences' => undef,'contacts' => undef,'locationName' => 'test_location','license' => '','commonCropName' => 'Cassava','studyName' => 'Kasese solgs trial','startDate' => undef,'active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'experimentalDesign' => {'description' => 'Alpha','PUI' => undef},'dataLinks' => [],'additionalInfo' => {'programName' => 'test','companyDbId' => '1','programDbId' => '134','companyName' => 'ImageBreed'},'culturalPractices' => undef,'trialDbId' => '134','environmentParameters' => undef,'observationLevels' => undef,'studyDescription' => 'This trial was loaded into the fixture to test solgs.','lastUpdate' => undef,'trialName' => 'test','seasons' => ['2014'],'studyPUI' => undef,'endDate' => undef,'studyCode' => undef,'studyType' => 'Clonal Evaluation','growthFacility' => undef,'observationUnitsDescription' => undef},{'studyDbId' => '135','documentationURL' => '','contacts' => undef,'externalReferences' => undef,'locationDbId' => undef,'locationName' => '','license' => '','startDate' => undef,'studyName' => 'new_test_cross','commonCropName' => 'Cassava','active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'experimentalDesign' => {},'culturalPractices' => undef,'additionalInfo' => {'companyName' => 'ImageBreed','programDbId' => '134','companyDbId' => '1','programName' => 'test'},'dataLinks' => [],'environmentParameters' => undef,'trialDbId' => '134','lastUpdate' => undef,'studyDescription' => 'new_test_cross','observationLevels' => undef,'trialName' => 'test','endDate' => undef,'studyCode' => undef,'seasons' => [undef],'studyPUI' => undef,'studyType' => undef,'observationUnitsDescription' => undef,'growthFacility' => undef}]},'metadata' => {'pagination' => {'totalPages' => 2,'currentPage' => 0,'pageSize' => 3,'totalCount' => 6},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=3','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Studies','messageType' => 'INFO'},{'message' => 'Studies search result constructed','messageType' => 'INFO'}]}} );

$mech->post_ok('http://localhost:3010/brapi/v2/search/studies', ['pageSize'=>'2', 'page'=>'2']);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
$mech->get_ok('http://localhost:3010/brapi/v2/search/studies/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalCount' => 2,'pageSize' => 10,'currentPage' => 0,'totalPages' => 1},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Results'},{'message' => 'search result constructed','messageType' => 'INFO'}],'datafiles' => []},'result' => {'data' => [{'studyDescription' => 'test trial','lastUpdate' => undef,'observationLevels' => undef,'environmentParameters' => undef,'trialDbId' => '134','studyType' => undef,'growthFacility' => undef,'observationUnitsDescription' => undef,'trialName' => 'test','studyCode' => undef,'endDate' => '2017-07-21T00:00:00Z','studyPUI' => undef,'seasons' => ['2014'],'externalReferences' => undef,'contacts' => undef,'locationDbId' => '23','locationName' => 'test_location','license' => '','studyDbId' => '137','documentationURL' => '','experimentalDesign' => {'description' => 'CRD','PUI' => undef},'culturalPractices' => undef,'additionalInfo' => {'companyName' => 'ImageBreed','programDbId' => '134','companyDbId' => '1','programName' => 'test'},'dataLinks' => [],'studyName' => 'test_trial','startDate' => '2017-07-04T00:00:00Z','commonCropName' => 'Cassava','active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' )},{'endDate' => undef,'studyCode' => undef,'studyPUI' => undef,'seasons' => ['2014'],'trialName' => 'test','observationUnitsDescription' => undef,'growthFacility' => undef,'studyType' => undef,'environmentParameters' => undef,'trialDbId' => '134','lastUpdate' => undef,'studyDescription' => 'another trial for solGS','observationLevels' => undef,'active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'startDate' => undef,'studyName' => 'trial2 NaCRRI','commonCropName' => 'Cassava','dataLinks' => [],'additionalInfo' => {'companyDbId' => '1','programName' => 'test','companyName' => 'ImageBreed','programDbId' => '134'},'culturalPractices' => undef,'experimentalDesign' => {'description' => 'CRD','PUI' => undef},'studyDbId' => '141','documentationURL' => '','license' => '','locationName' => 'test_location','contacts' => undef,'externalReferences' => undef,'locationDbId' => '23'}]}} );
$mech->get_ok('http://localhost:3010/brapi/v2/studies/139');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'environmentParameters' => undef,'trialDbId' => '134','lastUpdate' => undef,'studyDescription' => 'This trial was loaded into the fixture to test solgs.','observationLevels' => undef,'endDate' => undef,'studyCode' => undef,'studyPUI' => undef,'seasons' => ['2014'],'trialName' => 'test','observationUnitsDescription' => undef,'growthFacility' => undef,'studyType' => 'Clonal Evaluation','studyDbId' => '139','documentationURL' => '','license' => '','locationName' => 'test_location','contacts' => undef,'externalReferences' => undef,'locationDbId' => '23','active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'startDate' => undef,'studyName' => 'Kasese solgs trial','commonCropName' => 'Cassava','additionalInfo' => {'companyName' => 'ImageBreed','programDbId' => '134','companyDbId' => '1','programName' => 'test'},'dataLinks' => [],'experimentalDesign' => {'description' => 'Alpha','PUI' => undef},'culturalPractices' => undef},'metadata' => {'pagination' => {'pageSize' => 10,'totalCount' => 1,'currentPage' => 0,'totalPages' => 1},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Studies','messageType' => 'INFO'},{'message' => 'Studies search result constructed','messageType' => 'INFO'}],'datafiles' => []}} );

$mech->get_ok('http://localhost:3010/brapi/v2/locations?pageSize=3');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'coordinateDescription' => undef,'instituteName' => '','topography' => undef,'countryCode' => 'USA','environmentType' => undef,'locationDbId' => '23','abbreviation' => '','locationType' => '','countryName' => 'United States','coordinateUncertainty' => undef,'locationName' => 'test_location','coordinates' => {'geometry' => {'coordinates' => ['-115.86428','32.61359','109'],'type' => 'Point'},'type' => 'Feature'},'externalReferences' => undef,'additionalInfo' => {'breeding_program' => '134','geodetic datum' => undef},'instituteAddress' => '','siteStatus' => undef,'documentationURL' => undef,'exposure' => undef,'slope' => undef},{'locationName' => 'Cornell Biotech','coordinateUncertainty' => undef,'countryName' => 'United States','coordinates' => {'type' => 'Feature','geometry' => {'type' => 'Point','coordinates' => ['-76.4735','42.45345','274']}},'documentationURL' => undef,'siteStatus' => undef,'instituteAddress' => '','additionalInfo' => {'geodetic datum' => undef,'breeding_program' => '134'},'externalReferences' => undef,'slope' => undef,'exposure' => undef,'coordinateDescription' => undef,'countryCode' => 'USA','topography' => undef,'instituteName' => '','environmentType' => undef,'locationType' => '','abbreviation' => '','locationDbId' => '24'},{'countryCode' => '','topography' => undef,'instituteName' => '','coordinateDescription' => undef,'locationType' => '','abbreviation' => '','locationDbId' => '25','environmentType' => undef,'coordinates' => undef,'locationName' => 'NA','coordinateUncertainty' => undef,'countryName' => '','slope' => undef,'exposure' => undef,'documentationURL' => undef,'siteStatus' => undef,'instituteAddress' => '','additionalInfo' => {'geodetic datum' => undef},'externalReferences' => undef}]},'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=3','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Locations','messageType' => 'INFO'},{'message' => 'Locations list result constructed','messageType' => 'INFO'}],'pagination' => {'currentPage' => 0,'totalCount' => 4,'totalPages' => 2,'pageSize' => 3},'datafiles' => []}} );

$data = '[  {    "abbreviation": "L1",    "additionalInfo": {"noaaStationId" : "PALMIRA","programDbId" :"134"},    "coordinateDescription": "North East corner of greenhouse",    "coordinateUncertainty": "20",    "coordinates": {      "geometry": {        "coordinates": [          -76.506042,          42.417373,          123        ],        "type": "Point"      },      "type": "Feature"    },    "countryCode": "PER",    "countryName": "Peru",    "documentationURL": "https://brapi.org",    "environmentType": "Nursery",    "exposure": "Structure, no exposure",    "externalReferences": [      {        "referenceID": "doi:10.155454/12341234",        "referenceSource": "DOI"      },      {        "referenceID": "http://purl.obolibrary.org/obo/ro.owl",        "referenceSource": "OBO Library"      },      {        "referenceID": "75a50e76",        "referenceSource": "Remote Data Collection Upload Tool"      }    ],    "instituteAddress": "71 Pilgrim Avenue Chevy Chase MD 20815",    "instituteName": "Plant Science Institute",    "locationName": "Location 1",    "locationType": "Field",    "siteStatus": "Private",    "slope": "0",    "topography": "Valley"  }]';

$mech->post('http://localhost:3010/brapi/v2/locations?access_token='.$access_token, Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'topography' => undef,'locationName' => 'Location 1','countryName' => 'Peru','externalReferences' => undef,'locationType' => 'Field','countryCode' => 'PER','coordinates' => {'geometry' => {'type' => 'Point','coordinates' => ['-76.50604','42.417374','123']},'type' => 'Feature'},'instituteName' => '','locationDbId' => '27','abbreviation' => 'L1','slope' => undef,'documentationURL' => undef,'coordinateUncertainty' => undef,'siteStatus' => undef,'instituteAddress' => '','environmentType' => undef,'exposure' => undef,'additionalInfo' => {'breeding_program' => '134','geodetic datum' => undef,'noaa_station_id' => 'PALMIRA'},'coordinateDescription' => undef}]},'metadata' => {'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Locations'},{'message' => 'Locations list result constructed','messageType' => 'INFO'}],'pagination' => {'currentPage' => 0,'totalPages' => 1,'pageSize' => 10,'totalCount' => 1}}});

$mech->get_ok('http://localhost:3010/brapi/v2/locations/23?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Locations'},{'message' => 'Locations object result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'pageSize' => 10,'totalPages' => 1,'currentPage' => 0,'totalCount' => 1}},'result' => {'countryName' => 'United States','additionalInfo' => {'breeding_program' => '134','geodetic datum' => undef},'exposure' => undef,'slope' => undef,'locationType' => '','documentationURL' => undef,'coordinateDescription' => undef,'locationName' => 'test_location','environmentType' => undef,'topography' => undef,'instituteAddress' => '','locationDbId' => '23','siteStatus' => undef,'externalReferences' => undef,'coordinateUncertainty' => undef,'abbreviation' => '','instituteName' => '','coordinates' => {'geometry' => {'type' => 'Point','coordinates' => ['-115.86428','32.61359','109']},'type' => 'Feature'},'countryCode' => 'USA'}} );

$data = '{    "abbreviation": "L2",    "additionalInfo": {"noaaStationId" : "PALMIRA","programDbId" :"134"},    "coordinateDescription": "North East corner of greenhouse",    "coordinateUncertainty": "20",    "coordinates": {      "geometry": {        "coordinates": [          -76.506042,          42.417373,          123        ],        "type": "Point"      },      "type": "Feature"    },    "countryCode": "PER",    "countryName": "Peru",    "documentationURL": "https://brapi.org",    "environmentType": "Nursery",    "exposure": "Structure, no exposure",    "externalReferences": [      {        "referenceID": "doi:10.155454/12341234",        "referenceSource": "DOI"      },      {        "referenceID": "http://purl.obolibrary.org/obo/ro.owl",        "referenceSource": "OBO Library"      },      {        "referenceID": "75a50e76",        "referenceSource": "Remote Data Collection Upload Tool"      }    ],    "instituteAddress": "71 Pilgrim Avenue Chevy Chase MD 20815",    "instituteName": "Plant Science Institute",    "locationName": "Location 2",    "locationType": "Field",    "siteStatus": "Private",    "slope": "0",    "topography": "Valley"  }';

$resp = $ua->put("http://localhost:3010/brapi/v2/locations/25?access_token=".$access_token, Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Locations'},{'messageType' => 'INFO','message' => 'Locations list result constructed'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'currentPage' => 0,'totalCount' => 1,'pageSize' => 10}},'result' => {'data' => [{'coordinates' => {'type' => 'Feature','geometry' => {'coordinates' => ['-76.50604','42.417374','123'],'type' => 'Point'}},'topography' => undef,'countryCode' => 'PER','locationDbId' => '25','locationType' => 'Field','externalReferences' => undef,'countryName' => 'Peru','abbreviation' => 'L2','additionalInfo' => {'geodetic datum' => undef,'noaa_station_id' => 'PALMIRA','breeding_program' => '134'},'locationName' => 'Location 2','slope' => undef,'documentationURL' => undef,'instituteName' => '','coordinateUncertainty' => undef,'coordinateDescription' => undef,'environmentType' => undef,'instituteAddress' => '','exposure' => undef,'siteStatus' => undef}]}});

$mech->post_ok('http://localhost:3010/brapi/v2/search/locations?access_token='.$access_token, ['locationDbIds'=>['25','27']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
$mech->get_ok('http://localhost:3010/brapi/v2/search/locations/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Results','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'search result constructed'}],'pagination' => {'currentPage' => 0,'totalPages' => 1,'totalCount' => 2,'pageSize' => 10}},'result' => {'data' => [{'environmentType' => undef,'locationDbId' => '25','topography' => undef,'instituteAddress' => '','siteStatus' => undef,'coordinateUncertainty' => undef,'externalReferences' => undef,'instituteName' => '','abbreviation' => 'L2','countryCode' => 'PER','coordinates' => {'type' => 'Feature','geometry' => {'type' => 'Point','coordinates' => ['-76.50604','42.417374',123]}},'additionalInfo' => {'geodetic datum' => undef,'breeding_program' => '134','noaa_station_id' => 'PALMIRA'},'countryName' => 'Peru','exposure' => undef,'slope' => undef,'locationType' => 'Field','documentationURL' => undef,'coordinateDescription' => undef,'locationName' => 'Location 2'},{'coordinates' => {'type' => 'Feature','geometry' => {'type' => 'Point','coordinates' => ['-76.50604','42.417374',123]}},'countryCode' => 'PER','coordinateUncertainty' => undef,'externalReferences' => undef,'instituteName' => '','abbreviation' => 'L1','siteStatus' => undef,'environmentType' => undef,'locationDbId' => '27','instituteAddress' => '','topography' => undef,'coordinateDescription' => undef,'locationName' => 'Location 1','locationType' => 'Field','documentationURL' => undef,'exposure' => undef,'slope' => undef,'additionalInfo' => {'breeding_program' => '134','noaa_station_id' => 'PALMIRA','geodetic datum' => undef},'countryName' => 'Peru'}]}} );

$mech->get_ok('http://localhost:3010/brapi/v2/people');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'personDbId' => '40','mailingAddress' => undef,'userID' => 'johndoe','firstName' => 'John','emailAddress' => undef,'description' => undef,'phoneNumber' => undef,'additionalInfo' => {'country' => undef},'lastName' => 'Doe','externalReferences' => {'referenceSource' => undef,'referenceID' => undef},'middleName' => undef},{'middleName' => undef,'externalReferences' => {'referenceID' => undef,'referenceSource' => undef},'lastName' => 'Doe','additionalInfo' => {'country' => undef},'phoneNumber' => undef,'description' => undef,'emailAddress' => undef,'userID' => 'janedoe','firstName' => 'Jane','mailingAddress' => undef,'personDbId' => '41'},{'lastName' => 'Sanger','middleName' => undef,'emailAddress' => undef,'description' => undef,'phoneNumber' => undef,'additionalInfo' => {'country' => undef},'externalReferences' => {'referenceID' => undef,'referenceSource' => undef},'personDbId' => '42','mailingAddress' => undef,'firstName' => 'Fred','userID' => 'freddy'}]},'metadata' => {'pagination' => {'pageSize' => 10,'totalCount' => 3,'totalPages' => 1,'currentPage' => 0},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::People'},{'message' => 'People result constructed','messageType' => 'INFO'}]}});

$mech->get_ok('http://localhost:3010/brapi/v2/people/41');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'mailingAddress' => undef,'middleName' => undef,'personDbId' => '41','additionalInfo' => {'country' => undef},'externalReferences' => {'referenceID' => undef,'referenceSource' => undef},'description' => 'Organization: ','lastName' => 'Doe','firstName' => 'Jane','userID' => 'janedoe','phoneNumber' => undef,'emailAddress' => undef},'metadata' => {'datafiles' => [],'pagination' => {'pageSize' => 10,'currentPage' => 0,'totalCount' => 1,'totalPages' => 1},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::People','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'People result constructed'}]}} );

$mech->post_ok('http://localhost:3010/brapi/v2/search/people', ['personDbId'=>['40','41']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
$mech->get_ok('http://localhost:3010/brapi/v2/search/people/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'emailAddress' => undef,'personDbId' => '40','firstName' => 'John','mailingAddress' => undef,'additionalInfo' => {'country' => undef},'userID' => 'johndoe','lastName' => 'Doe','description' => undef,'phoneNumber' => undef,'externalReferences' => {'referenceID' => undef,'referenceSource' => undef},'middleName' => undef},{'description' => undef,'phoneNumber' => undef,'externalReferences' => {'referenceID' => undef,'referenceSource' => undef},'middleName' => undef,'emailAddress' => undef,'personDbId' => '41','firstName' => 'Jane','mailingAddress' => undef,'additionalInfo' => {'country' => undef},'userID' => 'janedoe','lastName' => 'Doe'}]},'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Results'},{'messageType' => 'INFO','message' => 'search result constructed'}],'datafiles' => [],'pagination' => {'totalPages' => 1,'pageSize' => 10,'currentPage' => 0,'totalCount' => 2}}});


$data = '[ { "accessionNumber": "fem_maleProgeny_002new", "acquisitionDate": "2018-01-01", "additionalInfo": {}, "biologicalStatusOfAccessionCode": "420", "biologicalStatusOfAccessionDescription": "Genetic stock", "breedingMethodDbId": "ffcce7ef",  "collection": "Rice Diversity Panel 1 (RDP1)",  "commonCropName": "Maize",  "countryOfOriginCode": "BES", "defaultDisplayName": "fem_maleProgeny_002", "documentationURL": "https://breedbase.org/", "donors": [ { "donorAccessionNumber": "A0000123", "donorInstituteCode": "PER001", "germplasmPUI": "http://pui.per/accession/A0000003" } ], "externalReferences": [], "genus": "Aspergillus", "germplasmName": "test_Germplasm9", "germplasmOrigin": [ { "coordinateUncertainty": "20", "coordinates": { "geometry": { "coordinates": [  -76.506042,  42.417373,  123 ], "type": "Point" }, "type": "Feature" } } ], "germplasmPUI": "http://pui.per/accession/fem_maleProgeny_002", "germplasmPreprocessing": "EO:0007210; transplanted from study 2351 observation unit ID: pot:894", "instituteCode": "PER001", "instituteName": "BTI", "pedigree": "A0000001/A0000002", "seedSource": "A0000001/A0000002", "seedSourceDescription": "Branches were collected from a 10-year-old", "species": "Solanum lycopersicum", "speciesAuthority": "Smith, 1822", "storageTypes": [ { "code": "20", "description": "Field collection" }, { "code": "10", "description": "Field collection" } ], "subtaxa": "Aspergillus fructus A", "subtaxaAuthority": "Smith, 1822", "synonyms": [ { "synonym": "variety_1", "type": "Pre-Code" } ], "taxonIds": [ { "sourceName": "NCBI", "taxonId": "2026747" } ]  } ]';

$mech->post('http://localhost:3010/brapi/v2/germplasm/', Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'biologicalStatusOfAccessionCode' => '420','germplasmName' => 'test_Germplasm9','germplasmPUI' => 'http://pui.per/accession/fem_maleProgeny_002,http://localhost:3010/stock/41785/view','speciesAuthority' => undef,'species' => 'Solanum lycopersicum','breedingMethodDbId' => 'unknown','biologicalStatusOfAccessionDescription' => undef,'acquisitionDate' => '2018-01-01','germplasmOrigin' => [],'additionalInfo' => undef,'accessionNumber' => 'fem_maleProgeny_002new','genus' => 'Lycopersicon','germplasmDbId' => '41785','countryOfOriginCode' => 'BES','seedSource' => 'A0000001/A0000002','documentationURL' => 'http://pui.per/accession/fem_maleProgeny_002,http://localhost:3010/stock/41785/view','instituteCode' => 'PER001','commonCropName' => 'tomato','defaultDisplayName' => 'fem_maleProgeny_002','germplasmPreprocessing' => undef,'instituteName' => 'BTI','seedSourceDescription' => 'A0000001/A0000002','collection' => undef,'subtaxaAuthority' => undef,'externalReferences' => [],'subtaxa' => undef,'storageTypes' => [{'description' => undef,'code' => '20'}],'pedigree' => 'NA/NA','synonyms' => [{'type' => undef,'synonym' => 'variety_1'}],'donors' => [{'donorInstituteCode' => 'PER001','donorAccessionNumber' => 'A0000123','germplasmPUI' => 'PER001'}],'taxonIds' => []}]},'metadata' => {'pagination' => {'pageSize' => 10,'totalCount' => 1,'totalPages' => 1,'currentPage' => 0},'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Germplasm','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Germplasm saved'}]}});

$data = '{"accessionNumber": "fem_maleProgeny_002", "acquisitionDate": "2018-01-07", "additionalInfo": {}, "biologicalStatusOfAccessionCode": "4207", "biologicalStatusOfAccessionDescription": "Genetic stock", "breedingMethodDbId": "ffcce7ef",  "collection": "Rice Diversity Panel 1 (RDP1)",  "commonCropName": "Maize", "countryOfOriginCode": "BES7", "defaultDisplayName": "fem_maleProgeny_0027", "documentationURL": "https://breedbase.org", "donors": [ { "donorAccessionNumber": "A0000123", "donorInstituteCode": "PER0017", "germplasmPUI": "http://accession/A00000037" } ], "externalReferences": [], "genus": "Aspergillus7",  "germplasmName": "test_Germplasm", "germplasmOrigin": [ { "coordinateUncertainty": "20", "coordinates": { "geometry": { "coordinates": [  -76.506042,  42.417373,  123 ], "type": "Point" }, "type": "Feature" } } ], "germplasmPUI": "http://accession/fem_maleProgeny_0027", "germplasmPreprocessing": "EO:0007210; transplanted from study 2351 observation unit ID: pot:894", "instituteCode": "PER0017", "instituteName": "BTI Ithaca", "pedigree": "A0000001/A00000027",  "seedSource": "A0000001/A00000027",  "seedSourceDescription": "Branches were collected from a 10-year-old tree growing in a progeny trial established in a loamy brown earth soil7.", "species": "Solanum lycopersicum", "speciesAuthority": "Smith, 1822", "storageTypes": [ { "code": "207", "description": "Field collection" }, { "code": "10", "description": "Field collection" } ], "subtaxa": "Aspergillus fructus A", "subtaxaAuthority": "Smith, 1822", "synonyms": [ { "synonym": "variety_17", "type": "Pre-Code" } ], "taxonIds": [ { "sourceName": "NCBI", "taxonId": "2026747" } ] }';

$resp = $ua->put("http://localhost:3010/brapi/v2/germplasm/41279", Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalCount' => 1,'currentPage' => 0,'pageSize' => 10,'totalPages' => 1},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Germplasm'},{'message' => 'Germplasm updated','messageType' => 'INFO'}]},'result' => {'subtaxaAuthority' => undef,'seedSourceDescription' => 'A0000001/A00000027','subtaxa' => undef,'storageTypes' => [{'description' => undef,'code' => '207'}],'breedingMethodDbId' => 'unknown','taxonIds' => [],'instituteCode' => 'PER0017','germplasmOrigin' => [],'externalReferences' => [],'speciesAuthority' => undef,'biologicalStatusOfAccessionDescription' => undef,'species' => 'Manihot esculenta','countryOfOriginCode' => 'BES7','germplasmDbId' => '41279','pedigree' => 'NA/NA','germplasmPUI' => 'http://accession/fem_maleProgeny_0027,http://localhost:3010/stock/41279/view','additionalInfo' => undef,'seedSource' => 'A0000001/A00000027','accessionNumber' => 'fem_maleProgeny_002','documentationURL' => 'http://accession/fem_maleProgeny_0027,http://localhost:3010/stock/41279/view','collection' => undef,'synonyms' => [{'type' => undef,'synonym' => 'variety_17'}],'defaultDisplayName' => 'IITA-TMS-IBA30572','germplasmPreprocessing' => undef,'commonCropName' => undef,'instituteName' => 'BTI Ithaca','germplasmName' => 'test_Germplasm','genus' => 'Manihot','biologicalStatusOfAccessionCode' => '4207','donors' => [{'germplasmPUI' => 'PER0017','donorInstituteCode' => 'PER0017','donorAccessionNumber' => 'A0000123'}],'acquisitionDate' => '2018-01-07'}});

# #post
$data = '[ {"active": "true","additionalInfo": {},"commonCropName": "Cassava","contacts": [],"datasetAuthorships": [],"documentationURL": "https://breedbase.org/","endDate": "2020-06-24","externalReferences": [],"programDbId": "134","programName": "test","publications": [],"startDate": "2020-06-24","trialDescription": "General drought resistance trial initiated in Peru","trialName": "Peru Yield Trial 2010","trialPUI": "https://doi.org/101093190"  }]';
$mech->post('http://localhost:3010/brapi/v2/trials?access_token='.$access_token, Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Trials'},{'message' => 'Trials result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'pageSize' => 10,'totalPages' => 1,'currentPage' => 0,'totalCount' => 1}},'result' => {'data' => [{'trialDescription' => 'General drought resistance trial initiated in Peru','programName' => 'test','trialDbId' => '168','endDate' => undef,'active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'externalReferences' => undef,'trialName' => 'Peru Yield Trial 2010','contacts' => undef,'programDbId' => '134','datasetAuthorships' => undef,'publications' => undef,'documentationURL' => undef,'additionalInfo' => {},'trialPUI' => undef,'commonCropName' => 'Cassava','startDate' => undef}]}});

$data = '[ { "active": "true", "additionalInfo": {}, "commonCropName": "Grape", "contacts": [], "culturalPractices": "Irrigation was applied according needs during summer to prevent water stress.", "dataLinks": [], "documentationURL": "https://breedbase.org/", "endDate": "2020-06-12T22:05:35.680Z", "environmentParameters": [], "experimentalDesign": {   "PUI": "RCBD",   "description": "Random" }, "externalReferences": [], "growthFacility": { }, "lastUpdate": {}, "license": "MIT License", "locationDbId": "23", "locationName": "test_location", "observationLevels": [], "observationUnitsDescription": "Observation units", "seasons": [   "2018" ], "startDate": "2020-06-12T22:05:35.680Z", "studyCode": "Grape_Yield_Spring_2018", "studyDescription": "This is a yield study for Spring 2018", "studyName": "Observation at Kenya 1", "studyPUI": "doi:10.155454/12349537312", "studyType": "phenotyping_trial", "trialDbId": "168", "trialName": "Peru Yield Trial 2010"} ]';
$mech->post('http://localhost:3010/brapi/v2/studies?access_token='.$access_token, Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'totalPages' => 1,'currentPage' => 0,'pageSize' => 10,'totalCount' => 1},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Studies'},{'message' => 'Studies stored successfully','messageType' => 'INFO'}],'datafiles' => []},'result' => {'data' => [{'studyPUI' => undef,'documentationURL' => '','trialName' => 'Peru Yield Trial 2010','seasons' => ['2018'],'license' => '','active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'observationUnitsDescription' => undef,'locationDbId' => '23','studyType' => 'phenotyping_trial','lastUpdate' => undef,'experimentalDesign' => {'PUI' => undef,'description' => 'RCBD'},'environmentParameters' => undef,'studyDescription' => 'This is a yield study for Spring 2018','endDate' => undef,'additionalInfo' => {'programName' => 'test','companyName' => 'ImageBreed','programDbId' => '134','companyDbId' => '1'},'studyCode' => undef,'studyName' => 'Observation at Kenya 1','growthFacility' => undef,'culturalPractices' => undef,'contacts' => undef,'locationName' => 'test_location','studyDbId' => '169','dataLinks' => [],'observationLevels' => undef,'externalReferences' => undef,'trialDbId' => '168','commonCropName' => 'Cassava','startDate' => undef}]}} );

$data = '{ "active": "true", "additionalInfo": {}, "commonCropName": "Grape", "contacts": [], "culturalPractices": "Irrigation was applied according needs during summer to prevent water stress.", "dataLinks": [], "documentationURL": "http://breedbase.org", "endDate": "2018-01-01", "environmentParameters": [   { "description": "the soil type was clay", "parameterName": "soil type", "parameterPUI": "PECO:0007155", "unit": "pH", "unitPUI": "PECO:0007059", "value": "clay soil", "valuePUI": "ENVO:00002262"   } ], "experimentalDesign": {   "PUI": "CRD",   "description": "Lines were repeated twice at each location using a complete block design. In order to limit competition effects, each block was organized into four sub-blocks corresponding to earliest groups based on a prior information." }, "externalReferences": [], "growthFacility": {   "PUI": "CO_715:0000162",   "description": "field environment condition, greenhouse" }, "lastUpdate": {   "timestamp": "2018-01-01T14:47:23-0600",   "version": "1.2.3" }, "license": "MIT License", "locationDbId": "23", "locationName": "test_location", "observationLevels": [], "observationUnitsDescription": "Observation units consisted in individual plots themselves consisting of a row of 15 plants at a density of approximately six plants per square meter.", "seasons": [   "Spring_2018" ], "startDate": "2018-01-01", "studyCode": "Grape_Yield_Spring_2018", "studyDescription": "This is a yield study for Spring 2018", "studyName": "INRAs Walnut Genetic Resources Observation at Kenya modified", "studyPUI": "doi:10.155454/12349537312", "studyType": "phenotyping_trial", "trialDbId": "168", "trialName": "Peru Yield Trial 2010"}';
$resp = $ua->put("http://localhost:3010/brapi/v2/studies/139?access_token=".$access_token, Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'pagination' => {'pageSize' => 10,'totalCount' => 1,'totalPages' => 1,'currentPage' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Studies','messageType' => 'INFO'},{'message' => 'Studies result constructed','messageType' => 'INFO'}],'datafiles' => []},'result' => {'contacts' => undef,'studyPUI' => undef,'observationLevels' => undef,'studyName' => 'INRAs Walnut Genetic Resources Observation at Kenya modified','dataLinks' => [],'environmentParameters' => undef,'lastUpdate' => undef,'commonCropName' => 'Cassava','experimentalDesign' => {'PUI' => undef,'description' => 'CRD'},'seasons' => ['Spring_2018'],'trialName' => 'Peru Yield Trial 2010','studyType' => 'phenotyping_trial','documentationURL' => '','growthFacility' => undef,'additionalInfo' => {'companyName' => 'ImageBreed','programName' => 'test','companyDbId' => '1','programDbId' => '134'},'studyDescription' => 'This is a yield study for Spring 2018','trialDbId' => '168','startDate' => '2018-01-01T00:00:00Z','observationUnitsDescription' => undef,'studyCode' => undef,'locationDbId' => '23','culturalPractices' => undef,'locationName' => 'test_location','studyDbId' => '139','endDate' => '2018-01-01T00:00:00Z','active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'externalReferences' => undef,'license' => ''}} );

#
$data = '{ "studyName": "Kasese solgs trial", "trialDbId": "139", "seasons": [   "2014" ], "locationDbId":23, "studyType":"phenotyping_trial", "experimentalDesign": {"PUI": "CRD"} }';
$resp = $ua->put("http://localhost:3010/brapi/v2/studies/139?access_token=".$access_token, Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response,  {'metadata' => {'pagination' => {'currentPage' => 0,'totalPages' => 1,'totalCount' => 1,'pageSize' => 10},'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Studies'},{'message' => 'Studies result constructed','messageType' => 'INFO'}]},'result' => {'additionalInfo' => {'companyDbId' => '1','programDbId' => '134','companyName' => 'ImageBreed','programName' => 'test'},'locationDbId' => '23','studyName' => 'Kasese solgs trial','lastUpdate' => undef,'trialName' => 'Peru Yield Trial 2010','observationUnitsDescription' => undef,'documentationURL' => '','studyDbId' => '139','culturalPractices' => undef,'seasons' => ['2014'],'trialDbId' => '168','endDate' => '2018-01-01T00:00:00Z','commonCropName' => 'Cassava','license' => '','startDate' => '2018-01-01T00:00:00Z','studyPUI' => undef,'studyCode' => undef,'studyDescription' => 'This is a yield study for Spring 2018','growthFacility' => undef,'environmentParameters' => undef,'dataLinks' => [],'externalReferences' => undef,'experimentalDesign' => {'PUI' => undef,'description' => 'CRD'},'studyType' => 'phenotyping_trial','observationLevels' => undef,'contacts' => undef,'locationName' => 'test_location','active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' )}} );

$data = '{ "41782":  { "observationUnitName":"CASS_6Genotypes_201", "studyDbId": "169","studyName": "Observation at Kenya 1", "germplasmDbId": "41280", "germplasmName": "TMEB693", "externalReferences" :[], "observationUnitPosition": {"entryType": "TEST", "geoCoordinates": { "geometry": { "coordinates": [ -76.506042, 42.417373, 10 ], "type": "Point" }, "type": "Feature" }, "observationLevel": { "levelName": "plot", "levelOrder": 2, "levelCode": "Plot_123" }, "observationLevelRelationships": [ { "levelCode": "Field_1", "levelName": "field", "levelOrder": 0 }, { "levelCode": "Block_12", "levelName": "block", "levelOrder": 1 }, { "levelCode": "Plot_123", "levelName": "plot", "levelOrder": 2 } ], "positionCoordinateX": "74", "positionCoordinateXType": "GRID_COL", "positionCoordinateY": "03", "positionCoordinateYType": "GRID_ROW" }  },  "41301":{ "germplasmDbId": "41282", "germplasmName": "IITA-TMS-IBA980002", "externalReferences" :[],  "observationUnitPosition": {"entryType": "TEST", "geoCoordinates": { "geometry": { "coordinates": [ -76.506042, 42.417373, 20 ], "type": "Point" }, "type": "Feature" }, "observationLevel": { "levelName": "plot", "levelOrder": 2, "levelCode": "Plot_123" }, "observationLevelRelationships": [ { "levelCode": "Field_1", "levelName": "field", "levelOrder": 0 }, { "levelCode": "Block_12", "levelName": "block", "levelOrder": 1 }, { "levelCode": "Plot_123", "levelName": "plot", "levelOrder": 2 } ], "positionCoordinateX": "74", "positionCoordinateXType": "GRID_COL", "positionCoordinateY": "03", "positionCoordinateYType": "GRID_ROW" } }}';

$resp = $ua->put("http://localhost:3010/brapi/v2/observationunits?access_token=".$access_token, Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::ObservationUnits'},{'message' => 'Observation Units search result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'currentPage' => 0,'pageSize' => 10,'totalPages' => 1,'totalCount' => 2}},'result' => {'data' => [{'observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observations' => [{'uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740408','value' => '245.679','additionalInfo' => {},'observationVariableDbId' => '77559','germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}]},{'season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41301','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationTimeStamp' => 'NA2017-04-21_21:11:28','germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002','additionalInfo' => {},'value' => '29.4029','observationVariableDbId' => '77557','uploadedBy' => undef,'observationDbId' => '740409','collector' => 'johndoe'},{'germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002','observationVariableDbId' => '77556','value' => '299.096','additionalInfo' => {},'observationDbId' => '740410','collector' => 'johndoe','uploadedBy' => undef,'observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => []},{'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationTimeStamp' => 'NA2017-04-21_21:11:28','germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740411','additionalInfo' => {},'value' => '1013.111','observationVariableDbId' => '77548'},{'observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','observationUnitDbId' => '41301','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740412','additionalInfo' => {},'value' => '17.04795','observationVariableDbId' => '77553','germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282'},{'studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002','value' => '202.893','additionalInfo' => {},'observationVariableDbId' => '77549','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740413','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41301','observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41301','observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationVariableDbId' => '77552','additionalInfo' => {},'value' => '40.306','observationDbId' => '740414','collector' => 'johndoe','uploadedBy' => undef,'germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002'},{'germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002','value' => '7.442495','additionalInfo' => {},'observationVariableDbId' => '77550','uploadedBy' => undef,'observationDbId' => '740415','collector' => 'johndoe','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41301','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165','uploadedBy' => undef,'observationDbId' => '740416','collector' => 'johndoe','value' => '75.2132','additionalInfo' => {},'observationVariableDbId' => '77551','observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationUnitDbId' => '41301','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002','observationVariableDbId' => '77558','additionalInfo' => {},'value' => '57.47695','observationDbId' => '740417','collector' => 'johndoe','uploadedBy' => undef,'observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => []},{'germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165','observationDbId' => '740418','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77554','value' => '20.43645','additionalInfo' => {},'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationUnitDbId' => '41301','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => []},{'studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002','additionalInfo' => {},'value' => '303.3225','observationVariableDbId' => '77555','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740419','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41301','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'}],'observationUnitPosition' => {'positionCoordinateXType' => 'LONGITUDE','positionCoordinateYType' => 'LATITUDE','positionCoordinateY' => undef,'observationLevelRelationships' => [{'levelCode' => '1','levelOrder' => 0,'levelName' => 'replicate'},{'levelName' => 'block','levelOrder' => 1,'levelCode' => '2'},{'levelOrder' => 2,'levelCode' => '203','levelName' => 'plot'}],'geoCoordinates' => {'geometry' => {'type' => 'Point','coordinates' => ['-76.506042','42.417373',20]},'type' => 'Feature'},'positionCoordinateX' => undef,'observationLevel' => {'levelCode' => '203','levelOrder' => 2,'levelName' => 'plot'},'entryType' => 'test'},'programDbId' => '134','treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'observationUnitDbId' => '41301','programName' => 'test','trialName' => 'CASS_6Genotypes_Sampling_2015','locationDbId' => '23','trialDbId' => '165','additionalInfo' => {},'seedLotDbId' => undef,'germplasmName' => 'IITA-TMS-IBA980002','observationUnitPUI' => 'localhost/stock/41301/view','locationName' => 'test_location','studyName' => 'CASS_6Genotypes_Sampling_2015','germplasmDbId' => '41282','studyDbId' => '165'},{'trialName' => 'CASS_6Genotypes_Sampling_2015','programName' => 'test','trialDbId' => '165','locationDbId' => '23','seedLotDbId' => undef,'additionalInfo' => {},'germplasmName' => 'IITA-TMS-IBA011412','locationName' => 'test_location','observationUnitPUI' => 'localhost/stock/41782/view','studyName' => 'CASS_6Genotypes_Sampling_2015','studyDbId' => '165','germplasmDbId' => '41281','externalReferences' => [],'observationUnitName' => 'Testing Plot','observations' => [],'programDbId' => '134','observationUnitPosition' => {'positionCoordinateXType' => 'LONGITUDE','positionCoordinateYType' => 'LATITUDE','positionCoordinateY' => 3,'observationLevelRelationships' => [{'levelName' => 'replicate','levelCode' => '1','levelOrder' => 0},{'levelName' => 'block','levelOrder' => 1,'levelCode' => 'Block_12'},{'levelOrder' => 2,'levelCode' => '1000','levelName' => 'plot'}],'positionCoordinateX' => 74,'geoCoordinates' => {'geometry' => {'type' => 'Point','coordinates' => ['-76.506042','42.417373',10]},'type' => 'Feature'},'entryType' => 'check','observationLevel' => {'levelName' => 'plot','levelCode' => '1000','levelOrder' => 2}},'observationUnitDbId' => '41782','treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}]}]}} );

$mech->get_ok('http://localhost:3010/brapi/v2/observationunits/41782?access_token='.$access_token);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'studyDbId' => '165','treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}],'studyName' => 'CASS_6Genotypes_Sampling_2015','observationUnitName' => 'Testing Plot','additionalInfo' => {},'locationName' => 'test_location','germplasmDbId' => '41281','observations' => [],'externalReferences' => [],'seedLotDbId' => undef,'programDbId' => '134','locationDbId' => '23','germplasmName' => 'IITA-TMS-IBA011412','programName' => 'test','trialDbId' => '165','observationUnitDbId' => '41782','trialName' => 'CASS_6Genotypes_Sampling_2015','observationUnitPosition' => {'entryType' => 'check','positionCoordinateY' => 3,'geoCoordinates' => {'geometry' => {'coordinates' => ['-76.506042','42.417373',10],'type' => 'Point'},'type' => 'Feature'},'positionCoordinateXType' => 'LONGITUDE','observationLevelRelationships' => [{'levelCode' => '1','levelName' => 'replicate','levelOrder' => 0},{'levelName' => 'block','levelOrder' => 1,'levelCode' => 'Block_12'},{'levelOrder' => 2,'levelName' => 'plot','levelCode' => '1000'}],'observationLevel' => {'levelCode' => '1000','levelOrder' => 2,'levelName' => 'plot'},'positionCoordinateX' => 74,'positionCoordinateYType' => 'LATITUDE'},'observationUnitPUI' => 'localhost/stock/41782/view'},'metadata' => {'pagination' => {'currentPage' => 0,'totalPages' => 1,'pageSize' => 10,'totalCount' => 1},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::ObservationUnits','messageType' => 'INFO'},{'message' => 'Observation Units search result constructed','messageType' => 'INFO'}],'datafiles' => []}} );


$mech->post_ok('http://localhost:3010/brapi/v2/search/observationunits?access_token='.$access_token, ['observationUnitDbIds'=>['41300','41301']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
$mech->get_ok('http://localhost:3010/brapi/v2/search/observationunits/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202','observations' => [{'germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693','observationVariableDbId' => '77559','value' => '250.228','additionalInfo' => {},'observationDbId' => '740396','collector' => 'johndoe','uploadedBy' => undef,'season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationUnitDbId' => '41300','observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => []},{'additionalInfo' => {},'value' => '39.2627','observationVariableDbId' => '77557','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740397','studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41300','observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011'},{'season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41300','observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202','germplasmDbId' => '41280','studyDbId' => '165','germplasmName' => 'TMEB693','observationVariableDbId' => '77556','value' => '478.0445','additionalInfo' => {},'observationDbId' => '740398','collector' => 'johndoe','uploadedBy' => undef},{'observationVariableDbId' => '77548','additionalInfo' => {},'value' => '1295.29','collector' => 'johndoe','observationDbId' => '740399','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'observationUnitDbId' => '41300','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002'},{'observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41300','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202','germplasmName' => 'TMEB693','studyDbId' => '165','germplasmDbId' => '41280','collector' => 'johndoe','observationDbId' => '740400','uploadedBy' => undef,'observationVariableDbId' => '77553','value' => '21.56485','additionalInfo' => {}},{'observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41300','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'germplasmName' => 'TMEB693','studyDbId' => '165','germplasmDbId' => '41280','collector' => 'johndoe','observationDbId' => '740401','uploadedBy' => undef,'observationVariableDbId' => '77549','value' => '169.757','additionalInfo' => {}},{'observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','observationUnitDbId' => '41300','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202','germplasmName' => 'TMEB693','studyDbId' => '165','germplasmDbId' => '41280','collector' => 'johndoe','observationDbId' => '740402','uploadedBy' => undef,'observationVariableDbId' => '77552','value' => '26.2744','additionalInfo' => {}},{'observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationUnitDbId' => '41300','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202','observationTimeStamp' => 'NA2017-04-21_21:11:28','germplasmName' => 'TMEB693','germplasmDbId' => '41280','studyDbId' => '165','uploadedBy' => undef,'observationDbId' => '740403','collector' => 'johndoe','additionalInfo' => {},'value' => '5.31292','observationVariableDbId' => '77550'},{'season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41300','observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693','additionalInfo' => {},'value' => '39.4774','observationVariableDbId' => '77551','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740404'},{'germplasmName' => 'TMEB693','germplasmDbId' => '41280','studyDbId' => '165','uploadedBy' => undef,'observationDbId' => '740405','collector' => 'johndoe','value' => '61.51325','additionalInfo' => {},'observationVariableDbId' => '77558','observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41300','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_202','externalReferences' => [],'observationUnitDbId' => '41300','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationVariableDbId' => '77554','value' => '36.2316','additionalInfo' => {},'collector' => 'johndoe','observationDbId' => '740406','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693'},{'observationUnitDbId' => '41300','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_202','observationTimeStamp' => 'NA2017-04-21_21:11:28','studyDbId' => '165','germplasmDbId' => '41280','germplasmName' => 'TMEB693','value' => '241.418','additionalInfo' => {},'observationVariableDbId' => '77555','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740407'}],'programDbId' => '134','observationUnitPosition' => {'observationLevelRelationships' => [{'levelOrder' => 0,'levelCode' => '1','levelName' => 'replicate'},{'levelCode' => '2','levelOrder' => 1,'levelName' => 'block'},{'levelName' => 'plot','levelOrder' => 2,'levelCode' => '202'}],'positionCoordinateY' => undef,'geoCoordinates' => undef,'positionCoordinateX' => undef,'observationLevel' => {'levelName' => 'plot','levelOrder' => 2,'levelCode' => '202'},'entryType' => 'test','positionCoordinateXType' => 'GRID_COL','positionCoordinateYType' => 'GRID_ROW'},'treatments' => [{'factor' => 'No ManagementFactor','modality' => undef}],'observationUnitDbId' => '41300','locationDbId' => '23','trialDbId' => '165','programName' => 'test','trialName' => 'CASS_6Genotypes_Sampling_2015','additionalInfo' => {},'seedLotDbId' => undef,'observationUnitPUI' => 'localhost/stock/41300/view','locationName' => 'test_location','germplasmName' => 'TMEB693','germplasmDbId' => '41280','studyDbId' => '165','studyName' => 'CASS_6Genotypes_Sampling_2015'},{'programDbId' => '134','observationUnitPosition' => {'positionCoordinateXType' => 'LONGITUDE','positionCoordinateYType' => 'LATITUDE','observationLevelRelationships' => [{'levelName' => 'replicate','levelOrder' => 0,'levelCode' => '1'},{'levelOrder' => 1,'levelCode' => '2','levelName' => 'block'},{'levelName' => 'plot','levelCode' => '203','levelOrder' => 2}],'positionCoordinateY' => undef,'positionCoordinateX' => undef,'geoCoordinates' => {'geometry' => {'coordinates' => ['-76.506042','42.417373',20],'type' => 'Point'},'type' => 'Feature'},'entryType' => 'test','observationLevel' => {'levelName' => 'plot','levelCode' => '203','levelOrder' => 2}},'treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'observationUnitDbId' => '41301','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observations' => [{'observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationVariableName' => 'cass sink leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000013','value' => '245.679','additionalInfo' => {},'observationVariableDbId' => '77559','uploadedBy' => undef,'observationDbId' => '740408','collector' => 'johndoe','germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002'},{'germplasmDbId' => '41282','studyDbId' => '165','germplasmName' => 'IITA-TMS-IBA980002','additionalInfo' => {},'value' => '29.4029','observationVariableDbId' => '77557','uploadedBy' => undef,'observationDbId' => '740409','collector' => 'johndoe','observationUnitDbId' => '41301','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationVariableName' => 'cass sink leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000011','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'observationVariableName' => 'cass sink leaf|ADP|ug/g|week 16|COMP:0000010','season' => [{'year' => '2017','seasonDbId' => undef,'season' => undef}],'observationUnitDbId' => '41301','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationTimeStamp' => 'NA2017-04-21_21:11:28','germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165','uploadedBy' => undef,'observationDbId' => '740410','collector' => 'johndoe','additionalInfo' => {},'value' => '299.096','observationVariableDbId' => '77556'},{'observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass source leaf|3-phosphoglyceric acid|ug/g|week 16|COMP:0000002','observationUnitDbId' => '41301','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'uploadedBy' => undef,'observationDbId' => '740411','collector' => 'johndoe','additionalInfo' => {},'value' => '1013.111','observationVariableDbId' => '77548','germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165'},{'observationVariableName' => 'cass source leaf|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000007','observationUnitDbId' => '41301','season' => [{'season' => undef,'seasonDbId' => undef,'year' => '2017'}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282','collector' => 'johndoe','observationDbId' => '740412','uploadedBy' => undef,'observationVariableDbId' => '77553','additionalInfo' => {},'value' => '17.04795'},{'germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165','uploadedBy' => undef,'observationDbId' => '740413','collector' => 'johndoe','value' => '202.893','additionalInfo' => {},'observationVariableDbId' => '77549','observationVariableName' => 'cass source leaf|ADP|ug/g|week 16|COMP:0000003','observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28'},{'germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282','collector' => 'johndoe','observationDbId' => '740414','uploadedBy' => undef,'observationVariableDbId' => '77552','additionalInfo' => {},'value' => '40.306','observationVariableName' => 'cass storage root|3-phosphoglyceric acid|ug/g|week 16|COMP:0000006','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41301','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => []},{'observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationTimeStamp' => 'NA2017-04-21_21:11:28','observationVariableName' => 'cass storage root|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000004','observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740415','additionalInfo' => {},'value' => '7.442495','observationVariableDbId' => '77550','germplasmName' => 'IITA-TMS-IBA980002','studyDbId' => '165','germplasmDbId' => '41282'},{'observationVariableDbId' => '77551','value' => '75.2132','additionalInfo' => {},'collector' => 'johndoe','observationDbId' => '740416','uploadedBy' => undef,'studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002','observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41301','observationVariableName' => 'cass storage root|ADP|ug/g|week 16|COMP:0000005'},{'observationDbId' => '740417','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77558','additionalInfo' => {},'value' => '57.47695','germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165','observationTimeStamp' => 'NA2017-04-21_21:11:28','observationUnitName' => 'CASS_6Genotypes_203','externalReferences' => [],'observationVariableName' => 'cass upper stem|3-phosphoglyceric acid|ug/g|week 16|COMP:0000012','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationUnitDbId' => '41301'},{'germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165','observationDbId' => '740418','collector' => 'johndoe','uploadedBy' => undef,'observationVariableDbId' => '77554','value' => '20.43645','additionalInfo' => {},'observationVariableName' => 'cass upper stem|ADP alpha-D-glucoside|ug/g|week 16|COMP:0000008','observationUnitDbId' => '41301','season' => [{'season' => undef,'year' => '2017','seasonDbId' => undef}],'observationTimeStamp' => 'NA2017-04-21_21:11:28','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203'},{'studyDbId' => '165','germplasmDbId' => '41282','germplasmName' => 'IITA-TMS-IBA980002','additionalInfo' => {},'value' => '303.3225','observationVariableDbId' => '77555','uploadedBy' => undef,'collector' => 'johndoe','observationDbId' => '740419','season' => [{'seasonDbId' => undef,'year' => '2017','season' => undef}],'observationUnitDbId' => '41301','observationVariableName' => 'cass upper stem|ADP|ug/g|week 16|COMP:0000009','externalReferences' => [],'observationUnitName' => 'CASS_6Genotypes_203','observationTimeStamp' => 'NA2017-04-21_21:11:28'}],'observationUnitPUI' => 'localhost/stock/41301/view','locationName' => 'test_location','germplasmName' => 'IITA-TMS-IBA980002','germplasmDbId' => '41282','studyDbId' => '165','studyName' => 'CASS_6Genotypes_Sampling_2015','locationDbId' => '23','trialDbId' => '165','programName' => 'test','trialName' => 'CASS_6Genotypes_Sampling_2015','additionalInfo' => {},'seedLotDbId' => undef}]},'metadata' => {'pagination' => {'totalPages' => 1,'totalCount' => 2,'pageSize' => 10,'currentPage' => 0},'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Results'},{'messageType' => 'INFO','message' => 'search result constructed'}],'datafiles' => []}} );

$data = '{ "additionalInfo": { "control": 1 }, "germplasmDbId": "41281", "germplasmName": "IITA-TMS-IBA011412", "locationDbId": "23", "locationName": "test_location", "observationUnitName": "Testing Plot", "observationUnitPUI": "1000", "programDbId": "134", "programName": "test", "seedLotDbId": "", "studyDbId": "165", "studyName": "CASS_6Genotypes_Sampling_2015", "treatments": [], "trialDbId": "165", "trialName": "", "observationUnitPosition": {"entryType": "TEST", "geoCoordinates": { "geometry": { "coordinates": [   -76.506042,   42.417373,   155 ], "type": "Point" }, "type": "Feature" }, "observationLevel": { "levelName": "plot", "levelOrder": 2, "levelCode": "10" }, "observationLevelRelationships": [ { "levelCode": "Field_1", "levelName": "field", "levelOrder": 0 }, { "levelCode": "Block_12", "levelName": "block", "levelOrder": 1 }, { "levelCode": "Plot_123", "levelName": "plot", "levelOrder": 2 } ], "positionCoordinateX": "74", "positionCoordinateXType": "GRID_COL", "positionCoordinateY": "03", "positionCoordinateYType": "GRID_ROW" } }';
$resp = $ua->put("http://localhost:3010/brapi/v2/observationunits/41783?access_token=".$access_token, Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::ObservationUnits','messageType' => 'INFO'},{'message' => 'Observation Units search result constructed','messageType' => 'INFO'}],'datafiles' => [],'pagination' => {'currentPage' => 0,'totalCount' => 1,'totalPages' => 1,'pageSize' => 10}},'result' => {'data' => [{'observationUnitName' => 'Testing Plot 2','treatments' => [{'modality' => undef,'factor' => 'No ManagementFactor'}],'studyDbId' => '165','studyName' => 'CASS_6Genotypes_Sampling_2015','locationName' => 'test_location','germplasmDbId' => '41281','additionalInfo' => {},'observations' => [],'externalReferences' => [],'seedLotDbId' => undef,'germplasmName' => 'IITA-TMS-IBA011412','programDbId' => '134','locationDbId' => '23','observationUnitPosition' => {'observationLevelRelationships' => [{'levelCode' => '1','levelOrder' => 0,'levelName' => 'replicate'},{'levelCode' => 'Block_12','levelOrder' => 1,'levelName' => 'block'},{'levelCode' => '1001','levelOrder' => 2,'levelName' => 'plot'}],'geoCoordinates' => {'type' => 'Feature','geometry' => {'coordinates' => ['-76.506042','42.417373',155],'type' => 'Point'}},'positionCoordinateY' => 3,'entryType' => 'check','positionCoordinateXType' => 'LONGITUDE','observationLevel' => {'levelOrder' => 2,'levelName' => 'plot','levelCode' => '1001'},'positionCoordinateX' => 100,'positionCoordinateYType' => 'LATITUDE'},'observationUnitPUI' => 'localhost/stock/41783/view','programName' => 'test','trialDbId' => '165','observationUnitDbId' => '41783','trialName' => 'CASS_6Genotypes_Sampling_2015'}]}} );


# $data = '[  {"additionalInfo": {},"copyright": "Copyright 2018 Bob","description": "Tomatoes","descriptiveOntologyTerms": [],"externalReferences": [],"imageFileName": "image_00G00231a.jpg","imageFileSize": 50000,"imageHeight": 550,"imageLocation": {  "geometry": {"coordinates": [  -76.506042,  42.417373,  9],"type": "Point"  },  "type": "Feature"},"imageName": "Tomato Imag-10","imageTimeStamp": "2020-06-17T16:20:00.217Z","imageURL": "https://breedbase.org/images/tomato","imageWidth": 700,"mimeType": "image/jpeg","observationDbIds": [],"observationUnitDbId": "38842"  }]';
# $mech->post('http://localhost:3010/brapi/v2/images', Content => $data);
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# is_deeply($response->{metadata}, {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Images'},{'message' => 'Image metadata stored','messageType' => 'INFO'}],'datafiles' => undef,'pagination' => {'pageSize' => 10,'totalPages' => 1,'currentPage' => 0,'totalCount' => 1}});

# $data = '{  "additionalInfo": {},  "copyright": "Copyright 2019 Bob",  "description": "picture of a tomato",  "descriptiveOntologyTerms": [],  "externalReferences": [],  "imageFileName": "image_0AA0231.jpg",  "imageFileSize": 50000,  "imageHeight": 550,  "imageLocation": {"geometry": {  "coordinates": [-76.506042,42.417373,123  ],  "type": "Point"},"type": "Feature"  },  "imageName": "Tomato Image-x1",  "imageTimeStamp": "2020-06-17T16:08:42.015Z",  "imageURL": "https://breedbase.org/images/tomato",  "imageWidth": 700,  "mimeType": "image/jpeg",  "observationDbIds": [],  "observationUnitDbId": "38843"}';

# $resp = $ua->put("http://localhost:3010/brapi/v2/images/2425", Content => $data);
# $response = decode_json $resp->{_content};
# print STDERR Dumper $response;
# is_deeply($response->{result}->{data}[0]->{observationUnitDbId} , '38843');
# my $image_timestamp = $response->{result}->{data}[0]->{imageTimeStamp} ;

# $mech->get_ok('http://localhost:3010/brapi/v2/images');
# $response = decode_json $mech->content;
# print STDERR Dumper $response;
# is_deeply($response, {'result' => {'data' => [{'descriptiveOntologyTerms' => [],'imageWidth' => undef,'imageLocation' => {'type' => '','geometry' => {'type' => '','coordinates' => []}},'imageFileName' => 'image_0AA0231.jpg','imageFileSize' => undef,'imageURL' => 'localhost/data/images/image_files/XX/XX/XX/XX/XXXXXXXXXXXXXXXXXXXXXXXX/medium.jpg','description' => 'picture of a tomato','copyright' => 'janedoe 2020','imageDbId' => '2425','imageTimeStamp' => $image_timestamp,'mimeType' => 'image/jpeg','additionalInfo' => {'observationLevel' => 'accession','tags' => [],'observationUnitName' => 'test_accession4'},'imageHeight' => undef,'observationUnitDbId' => '38843','observationDbIds' => [],'imageName' => 'Tomato Image-x1','externalReferences' => []}]},'metadata' => {'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::Images','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Image search result constructed'}],'pagination' => {'currentPage' => 0,'totalCount' => 1,'totalPages' => 1,'pageSize' => 10}}} );


#location and year is Needed
$data = '[ { "additionalInfo": { "locationName" : "test_location", "year" : "2019" }, "commonCropName": "Cassava", "crossingProjectDescription": "Crosses between germplasm X and germplasm Y", "crossingProjectName": "Ibadan_Crosses_2018", "externalReferences": [], "programDbId": "134", "programName": "test" },{ "additionalInfo": { "locationName" : "test_location", "year" : "2019" }, "commonCropName": "Cassava", "crossingProjectDescription": "Crosses between germplasm X and germplasm Y", "crossingProjectName": "Ibadan_Crosses_2018-2", "externalReferences": [], "programDbId": "134", "programName": "test" } ]';
$mech->post('http://localhost:3010/brapi/v2/crossingprojects?access_token='.$access_token, Content => $data);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Crossing','messageType' => 'INFO'},{'messageType' => 'INFO','message' => '2 Crossing projects stored'}],'pagination' => {'totalPages' => 1,'totalCount' => 2,'currentPage' => 0,'pageSize' => 10},'datafiles' => []},'result' => {}});

$data = '{ "additionalInfo": {"locationName" : "test_location" }, "commonCropName": "Cassava", "crossingProjectDescription": "Crosses germplasm X and Y", "crossingProjectName": "Ibadan_Crosses_2018 - 2", "externalReferences": [], "programDbId": "134", "programName": "test"}';
$resp = $ua->put("http://localhost:3010/brapi/v2/crossingprojects/140?access_token=".$access_token, Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Crossing','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'Crossing project updated'}],'pagination' => {'currentPage' => 0,'totalPages' => 1,'pageSize' => 10,'totalCount' => 1},'datafiles' => []},'result' => {'commonCropName' => undef,'crossingProjectDescription' => 'Ibadan_Crosses_2018 - 2','crossingProjectName' => 'Ibadan_Crosses_2018 - 2','additionalInfo' => {},'programName' => 'test','programDbId' => '134','externalReferences' => [],'crossingProjectDbId' => '140'}});



#ir doesn't update date or description
$data = '{ "active": "true","additionalInfo": {},"commonCropName": "Cassava","contacts": [],"datasetAuthorships": [],"documentationURL": "https://breedbase.org/","endDate": "2020-06-24","externalReferences": [],"programDbId": "134","programName": "test","publications": [],"startDate": "2020-06-24","trialDescription": "Trial initiated in Peru","trialName": "Peru Yield Trial 2020-1","trialPUI": "https://doi.org/101093190" }';
$resp = $ua->put("http://localhost:3010/brapi/v2/trials/168?access_token=".$access_token, Content => $data);
$response = decode_json $resp->{_content};
print STDERR Dumper $response;
is_deeply($response, {'result' => {'endDate' => undef,'trialName' => 'Peru Yield Trial 2020-1','datasetAuthorships' => undef,'programDbId' => '134','commonCropName' => 'Cassava','active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'startDate' => undef,'publications' => undef,'programName' => 'test','documentationURL' => undef,'contacts' => undef,'externalReferences' => undef,'trialDescription' => 'Trial initiated in Peru','trialPUI' => undef,'additionalInfo' => {},'trialDbId' => '168'},'metadata' => {'datafiles' => [],'status' => [{'message' => 'BrAPI base call found with page=0, pageSize=10','messageType' => 'INFO'},{'message' => 'Loading CXGN::BrAPI::v2::Trials','messageType' => 'INFO'},{'message' => 'Trial detail result constructed','messageType' => 'INFO'}],'pagination' => {'pageSize' => 10,'totalCount' => 1,'currentPage' => 0,'totalPages' => 1}}});

$mech->get_ok('http://localhost:3010/brapi/v2/trials/168');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response,  {'result' => {'trialPUI' => undef,'externalReferences' => undef,'documentationURL' => undef,'publications' => undef,'contacts' => undef,'programName' => 'test','commonCropName' => 'Cassava','datasetAuthorships' => undef,'endDate' => undef,'active' => JSON::true,'trialName' => 'Peru Yield Trial 2020-1','programDbId' => '134','startDate' => undef,'additionalInfo' => {},'trialDescription' => 'Trial initiated in Peru','trialDbId' => '168'},'metadata' => {'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'messageType' => 'INFO','message' => 'Loading CXGN::BrAPI::v2::Trials'},{'messageType' => 'INFO','message' => 'Trial detail result constructed'}],'pagination' => {'currentPage' => 0,'totalCount' => 1,'pageSize' => 10,'totalPages' => 1}}});

$mech->get_ok('http://localhost:3010/brapi/v2/trials/?trialDbId=168');
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'metadata' => {'datafiles' => [],'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::Trials','messageType' => 'INFO'},{'message' => 'Trials result constructed','messageType' => 'INFO'}],'pagination' => {'totalCount' => 1,'pageSize' => 10,'currentPage' => 0,'totalPages' => 1}},'result' => {'data' => [{'active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'trialDbId' => '168','programName' => 'test','documentationURL' => undef,'commonCropName' => 'Cassava','contacts' => undef,'trialPUI' => undef,'datasetAuthorships' => undef,'publications' => undef,'trialName' => 'Peru Yield Trial 2020-1','trialDescription' => 'Trial initiated in Peru','startDate' => undef,'programDbId' => '134','additionalInfo' => {},'endDate' => undef,'externalReferences' => undef}]}});

$mech->post_ok('http://localhost:3010/brapi/v2/search/trials?access_token='.$access_token, ['pageSize'=>'1', 'trialDbId' => ['168']]);
$response = decode_json $mech->content;
$searchId = $response->{result} ->{searchResultDbId};
print STDERR Dumper $response;
$mech->get_ok('http://localhost:3010/brapi/v2/search/trials/'. $searchId);
$response = decode_json $mech->content;
print STDERR Dumper $response;
is_deeply($response, {'result' => {'data' => [{'trialPUI' => undef,'datasetAuthorships' => undef,'contacts' => undef,'documentationURL' => undef,'commonCropName' => undef,'active' => bless( do{\(my $o = 1)}, 'JSON::PP::Boolean' ),'programName' => 'test','trialDbId' => '168','additionalInfo' => {},'externalReferences' => undef,'endDate' => undef,'trialName' => 'Peru Yield Trial 2020-1','publications' => undef,'programDbId' => '134','startDate' => undef,'trialDescription' => 'Trial initiated in Peru'}]},'metadata' => {'pagination' => {'currentPage' => 0,'totalPages' => 1,'totalCount' => 1,'pageSize' => 10},'status' => [{'messageType' => 'INFO','message' => 'BrAPI base call found with page=0, pageSize=10'},{'message' => 'Loading CXGN::BrAPI::v2::Results','messageType' => 'INFO'},{'messageType' => 'INFO','message' => 'search result constructed'}],'datafiles' => []}} );

done_testing();
