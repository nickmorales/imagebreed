<%args>
</%args>

<div class="modal fade" id="add_new_observation_variable_dialog" name="add_new_observation_variable_dialog" tabindex="-1" role="dialog" aria-labelledby="addNewObservationVariableDialog">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="addNewObservationVariableDialog">Add New Observation Variable</h4>
            </div>
            <div class="modal-body">
                <div class="container-fluid">

                    <&| /util/workflow.mas, id=> "add_new_trait_workflow" &>
                        <&| /util/workflow.mas:step, title=> "Intro" &>
                            <& /page/page_title.mas, title=>"Need a new observation variable?" &>
                            <ul>
                                <li>Please be sure the observation variable does not currently exist in the database using the trait search.</li>
                                <li>Having many observation variables that are in fact recording the same thing is dangerous and can cause the database data to become fragmented.</li>
                                <li>An observation variable is composed of a trait for the attribute being observed, a method describing how the attribute was measured, and a scale indicating the units of the observation.</li>
                                <li>Having descriptive observation variables is critical for downstream analysis.</li>
                            </ul>

                            <br/><br/>
                            <center>
                                <button class="btn btn-primary" name="add_new_observation_variable_ontology_add_button">Need a new ontology? Click here first.</button>
                            </center>

                            <br/><br/>
                            <center>
                                <button class="btn btn-primary" onclick="Workflow.complete(this);">Go to Next Step</button>
                            </center>
                        </&>

                        <&| /util/workflow.mas:step, title=> "Observation Variable" &>
                            <& /page/page_title.mas, title=>"Define your observation variable" &>

                            <p>An observation variable is composed of a trait for the attribute being observed, a method describing how the attribute was measured, and a scale indicating the units of the observation.</p>
                            <hr>

                            <center>
                                <button class="btn btn-primary" name="add_new_observation_variable_ontology_add_button">Need a new ontology? Click here first.</button>
                            </center>
                            <br/><br/>

                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Observation Variable Ontology Name: </label>
                                    <div class="col-sm-9">
                                        <div id="add_new_observation_variable_ontology_select_div">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Observation Variable Name: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_observation_variable_name" name="add_new_observation_variable_name" type="text" placeholder="e.g. total mass of fruit harvest from a plant using MachineX in kilograms"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Observation Variable Definition: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_observation_variable_definition" name="add_new_observation_variable_definition" type="text" placeholder="e.g. total mass of fruit harvest from a plant using MachineX in kilograms"/>
                                    </div>
                                </div>
                            </form>
                            <br/>

                            <center>
                                <button class="btn btn-primary" id="add_new_trait_observation_variable_step">Go to Next Step</button>
                            </center>

                        </&>
                        <&| /util/workflow.mas:step, title=> "Trait" &>
                            <& /page/page_title.mas, title=>"Define your trait" &>

                            <ul>
                                <li>A trait defines the attribute being measured. It is one component of an observation variable; the others are a method and a scale.</li>
                                <li>Here you can select a trait that already exists in an ontology in the database or you can add a new trait into an ontology.</li>
                            </ul>
                            <hr>

                            <center>
                                <button class="btn btn-primary" name="add_new_observation_variable_ontology_add_button">Need a new ontology? Click here first.</button>
                            </center>
                            <br/><br/>

                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Trait Ontology Name: </label>
                                    <div class="col-sm-9">
                                        <div id="add_new_trait_ontology_select_div">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Existing Traits in Selected Ontology: </label>
                                    <div class="col-sm-9">
                                        <div id="add_new_trait_existing_trait_select_div">
                                        </div>
                                    </div>
                                </div>
                                <hr>

                                <div class="well">
                                    <h3>If the trait does not exist in the ontology you selected above, you can add a new trait into the ontology here.</h3>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Trait Name: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_name" name="add_new_trait_name" type="text" placeholder="e.g. harvested fruit mass per plant"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Trait Definition: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_definition" name="add_new_trait_definition" type="text" placeholder="e.g. the total mass of fruit harvested from a plant"/>
                                    </div>
                                </div>
                            </form>

                            <center>
                                <button class="btn btn-primary" id="add_new_trait_trait_step">Go to Next Step</button>
                            </center>

                        </&>
                        <&| /util/workflow.mas:step, title=> "Method" &>
                            <p>A method defines the how it was measured measured. It is one component of an observation variable; the others are a trait and a scale.</p>
                            <hr>

                            <center>
                                <button class="btn btn-primary" name="add_new_observation_variable_ontology_add_button">Need a new ontology? Click here first.</button>
                            </center>
                            <br/><br/>

                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Method Ontology Name: </label>
                                    <div class="col-sm-9">
                                        <div id="add_new_trait_method_ontology_select_div">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Existing Methods in Selected Ontology: </label>
                                    <div class="col-sm-9">
                                        <div id="add_new_trait_existing_method_select_div">
                                        </div>
                                    </div>
                                </div>
                                <hr>

                                <div class="well">
                                    <h3>If the method does not exist in the ontology you selected above, you can add a new method into the ontology here.</h3>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Method Name: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_method_name" name="add_new_trait_method_name" type="text" placeholder="e.g. BrandA Mass Balance 0.001g Accuracy"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Method Definition: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_method_definition" name="add_new_trait_method_definition" type="text" placeholder="e.g. BrandA MachineX Mass Balance 0.001g Accuracy"/>
                                    </div>
                                </div>
                            </form>

                            <center>
                                <button type="button" class="btn btn-primary" id="add_new_trait_method_step">Go to Next Step</button>
                            </center>

                        </&>
                        <&| /util/workflow.mas:step, title=> "Scale" &>
                            <& /page/page_title.mas, title=>"Define your scale" &>

                            <center>
                                <button class="btn btn-primary" name="add_new_observation_variable_ontology_add_button">Need a new ontology? Click here first.</button>
                            </center>
                            <br/><br/>

                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Scale Ontology Name: </label>
                                    <div class="col-sm-9">
                                        <div id="add_new_trait_scale_ontology_select_div">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Existing Scales in Selected Ontology: </label>
                                    <div class="col-sm-9">
                                        <div id="add_new_trait_existing_scale_select_div">
                                        </div>
                                    </div>
                                </div>
                                <hr>

                                <div class="well">
                                    <h3>If the scale does not exist in the ontology you selected above, you can add a new scale into the ontology here.</h3>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Scale Name: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_scale_name" name="add_new_trait_scale_name" type="text" placeholder="e.g. mass in kilograms"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Scale Definition: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_scale_definition" name="add_new_trait_scale_definition" type="text" placeholder="e.g. the mass in kilograms"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Scale Format: </label>
                                    <div class="col-sm-9">
                                        <select class="form-control" id="add_new_trait_scale_format" name="add_new_trait_scale_format" >
                                            <option value="">Select One</option>
                                            <option value="qualitative">qualitative</option>
                                            <option value="quantitative">quantitative</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Scale Minimum: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_scale_minimum" name="add_new_trait_scale_minimum" type="text" placeholder="e.g. 1"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Scale Maximum: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_scale_maximum" name="add_new_trait_scale_maximum" type="text" placeholder="e.g. 10000"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Scale Categories ('/' separated): </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_scale_categories" name="add_new_trait_scale_categories" type="text" placeholder="e.g. 1/3/5/7"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Scale Default Value: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_trait_scale_default" name="add_new_trait_scale_default" type="text" placeholder="e.g. 5"/>
                                    </div>
                                </div>
                            </form>

                            <center>
                                <button type="button" class="btn btn-primary" id="add_new_trait_scale_step">Go to Next Step</button>
                            </center>

                        </&>
                        <&| /util/workflow.mas:step, title=> "Confirm" &>
                            <& /page/page_title.mas, title=>"Confirm you are creating this observation variable in the database" &>

                            <center>
                                <button class="btn btn-primary" id="add_new_trait_submit_button">Submit</button>
                            </center>
                        </&>
                        <&| /util/workflow.mas:complete, title=> "Complete" &>
                            <& /page/page_title.mas, title=>"Finished! Your observation variable is now in the database" &>

                            <div id="add_new_trait_added_observation_variable_div">
                            </div>
                        </&>

                    </&><!-- End of workflow -->

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="add_new_observation_variable_ontology_dialog" name="add_new_observation_variable_ontology_dialog" tabindex="-1" role="dialog" aria-labelledby="addNewObservationVariableOntologyDialog">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="addNewObservationVariableOntologyDialog">Add New Ontology</h4>
            </div>
            <div class="modal-body">
                <div class="container-fluid">

                    <&| /util/workflow.mas, id=> "add_new_ontology_workflow" &>
                        <&| /util/workflow.mas:step, title=> "Intro" &>
                            <& /page/page_title.mas, title=>"Start a new ontology" &>
                            <ul>
                                <li>In this workflow you can add a new ontology to the database. Once an ontology is added, you can add terms into it from the add observation variables workflow.</li>
                                <li>Ontologies are tagged as being either for traits, methods, or scales</li>
                            </ul>

                            <br/><br/>
                            <center>
                                <button class="btn btn-primary" onclick="Workflow.complete(this);">Go to Next Step</button>
                            </center>
                        </&>

                        <&| /util/workflow.mas:step, title=> "Ontology" &>
                            <& /page/page_title.mas, title=>"Define your ontology" &>

                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Ontology Name: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_observation_variable_ontology_name" name="add_new_observation_variable_ontology_name" type="text" placeholder="e.g. MyBreedingProgram Grape Ontology"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Ontology Definition: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_observation_variable_ontology_definition" name="add_new_observation_variable_ontology_definition" type="text" placeholder="e.g. description of the ontology"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">New Ontology Database Identifier: </label>
                                    <div class="col-sm-9">
                                        <input class="form-control" id="add_new_observation_variable_ontology_db_name" name="add_new_observation_variable_ontology_db_name" type="text" placeholder="a unique identifier for the terms in the ontology e.g. CO322"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Ontology Type: </label>
                                    <div class="col-sm-9">
                                        <select class="form-control" id="add_new_observation_variable_ontology_type" name="add_new_observation_variable_ontology_type"/>
                                            <option value="trait_ontology">Trait or Observation Variable</option>
                                            <option value="method_ontology">Method</option>
                                            <option value="unit_ontology">Scale</option>
                                        </select>
                                    </div>
                                </div>
                            </form>
                            <br/>

                            <center>
                                <button class="btn btn-primary" id="add_new_trait_observation_variable_ontology_step">Store Ontology</button>
                            </center>

                        </&>
                        <&| /util/workflow.mas:complete, title=> "Complete" &>
                            <& /page/page_title.mas, title=>"Finished! Your ontology is now in the database. Add new terms into it from the add observation variable workflow." &>
                        </&>

                    </&><!-- End of workflow -->

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
jQuery(document).ready(function() {

    jQuery('button[name="add_new_observation_variable_ontology_add_button"]').click(function(){
        jQuery('#add_new_observation_variable_ontology_dialog').modal('show');
    });

    jQuery('button[name="add_new_observation_variable_button"]').click(function(){
        jQuery('#add_new_observation_variable_dialog').modal('show');

        get_select_box('trait_variable_ontologies', 'add_new_observation_variable_ontology_select_div', { 'name':'add_new_observation_variable_ontology_select',    'id':'add_new_observation_variable_ontology_select', 'empty':1, 'hide_protected_onts':1, 'cvprop_type_name':JSON.stringify(['trait_ontology','composed_trait_ontology','attribute_ontology']) });
        get_select_box('trait_variable_ontologies', 'add_new_trait_ontology_select_div', { 'name':'add_new_trait_ontology_select', 'id':'add_new_trait_ontology_select', 'empty':1, 'hide_protected_onts':1, 'cvprop_type_name':JSON.stringify(['trait_ontology','composed_trait_ontology','attribute_ontology']) });
        get_select_box('trait_variable_ontologies', 'add_new_trait_method_ontology_select_div', { 'name':'add_new_trait_method_ontology_select', 'id':'add_new_trait_method_ontology_select', 'empty':1, 'hide_protected_onts':1, 'cvprop_type_name':JSON.stringify(['method_ontology']) });
        get_select_box('trait_variable_ontologies', 'add_new_trait_scale_ontology_select_div', { 'name':'add_new_trait_scale_ontology_select', 'id':'add_new_trait_scale_ontology_select', 'empty':1, 'hide_protected_onts':1, 'cvprop_type_name':JSON.stringify(['unit_ontology']) });

    });

    jQuery('button[name="upload_new_observation_variable_button"]').click(function(){
        jQuery('#upload_new_observation_variable_dialog').modal('show');

    });

    var add_new_trait_new_observation_variable_db_id;
    var add_new_trait_new_observation_variable_name;
    var add_new_trait_new_observation_variable_definition;
    jQuery('#add_new_trait_observation_variable_step').click(function() {
        if (jQuery('#add_new_observation_variable_name').val() == '') {
            alert('Please give a new observation variable name!');
            return false;
        }
        if (jQuery('#add_new_observation_variable_definition').val() == '') {
            alert('Please give a new observation variable definition!');
            return false;
        }
        var selected = [];
        jQuery('input[name="add_new_observation_variable_ontology_select"]:checked').each(function(){
            selected.push(jQuery(this).val());
        });
        if (selected.length < 1) {
            alert('Please select one observation variable ontology!');
        } else if (selected.length > 1) {
            alert('Only select one observation variable ontology!');
        } else {
            add_new_trait_new_observation_variable_name = jQuery('#add_new_observation_variable_name').val();
            add_new_trait_new_observation_variable_definition = jQuery('#add_new_observation_variable_definition').val();
            add_new_trait_new_observation_variable_db_id = selected[0];
            Workflow.complete('#add_new_trait_observation_variable_step');
            Workflow.focus('#add_new_trait_workflow', 2);
        }
        return false;
    });

    var add_new_trait_new_trait_db_id;
    jQuery(document).on('change', 'input[name="add_new_trait_ontology_select"]', function(){
        var selected = [];
        jQuery('input[name="add_new_trait_ontology_select"]:checked').each(function(){
            selected.push(jQuery(this).val());
        });
        if (selected.length > 1) {
            alert('Only select one trait ontology!');
        } else {
            add_new_trait_new_trait_db_id = selected[0];
            get_select_box('all_ontology_terms', 'add_new_trait_existing_trait_select_div', { 'selectbox_name':'add_new_trait_existing_trait_select',    'selectbox_id':'add_new_trait_existing_trait_select', 'empty':1, 'db_id':selected[0], 'exclude_top_term':1 });
        }
    });

    var add_new_trait_new_method_db_id;
    jQuery(document).on('change', 'input[name="add_new_trait_method_ontology_select"]', function(){
        var selected = [];
        jQuery('input[name="add_new_trait_method_ontology_select"]:checked').each(function(){
            selected.push(jQuery(this).val());
        });
        if (selected.length > 1) {
            alert('Only select one method ontology!');
        } else {
            add_new_trait_new_method_db_id = selected[0];
            get_select_box('all_ontology_terms', 'add_new_trait_existing_method_select_div', { 'selectbox_name':'add_new_trait_existing_method_select',    'selectbox_id':'add_new_trait_existing_method_select', 'empty':1, 'db_id':selected[0], 'exclude_top_term':1 });
        }
    });

    var add_new_trait_new_scale_db_id;
    jQuery(document).on('change', 'input[name="add_new_trait_scale_ontology_select"]', function(){
        var selected = [];
        jQuery('input[name="add_new_trait_scale_ontology_select"]:checked').each(function(){
            selected.push(jQuery(this).val());
        });
        if (selected.length > 1) {
            alert('Only select one scale ontology!');
        } else {
            add_new_trait_new_scale_db_id = selected[0];
            get_select_box('all_ontology_terms', 'add_new_trait_existing_scale_select_div', { 'selectbox_name':'add_new_trait_existing_scale_select',    'selectbox_id':'add_new_trait_existing_scale_select', 'empty':1, 'db_id':selected[0], 'exclude_top_term':1 });
        }
    });

    var add_new_trait_selected_trait_cvterm_id;
    var add_new_trait_new_trait_name;
    var add_new_trait_new_trait_definition;
    jQuery('#add_new_trait_trait_step').click(function() {
        var add_new_trait_selected_trait_val = jQuery('#add_new_trait_existing_trait_select').val();
        if (add_new_trait_selected_trait_val == '0') {
            add_new_trait_selected_trait_val = '';
        }
        if (add_new_trait_selected_trait_val == '' && jQuery('#add_new_trait_name').val() == '') {
            alert('Please select an existing trait or give a new trait name!');
            return false;
        }
        if (add_new_trait_selected_trait_val != '' && jQuery('#add_new_trait_name').val() != '') {
            alert('Please select an existing trait or give a new trait name, and not both!');
            return false;
        }
        var selected = [];
        jQuery('input[name="add_new_trait_ontology_select"]:checked').each(function(){
            selected.push(jQuery(this).val());
        });
        if (selected.length < 1) {
            alert('Please select one trait ontology!');
        } else if (selected.length > 1) {
            alert('Only select one trait ontology!');
        } else {
            if (add_new_trait_selected_trait_val == '') {
                if (jQuery('#add_new_trait_name').val() == ''){
                    alert('Please give a new trait name!');
                }
                else if (jQuery('#add_new_trait_definition').val() == ''){
                    alert('Please give a new trait definition!');
                }
                else {
                    add_new_trait_new_trait_name = jQuery('#add_new_trait_name').val();
                    add_new_trait_new_trait_definition = jQuery('#add_new_trait_definition').val();
                    Workflow.complete('#add_new_trait_trait_step');
                    Workflow.focus('#add_new_trait_workflow', 3);
                }
            } else {
                add_new_trait_selected_trait_cvterm_id = add_new_trait_selected_trait_val;
                Workflow.complete('#add_new_trait_trait_step');
                Workflow.focus('#add_new_trait_workflow', 3);
            }
        }
        return false;
    });

    var add_new_trait_selected_method_cvterm_id;
    var add_new_trait_new_method_name;
    var add_new_trait_new_method_definition;
    jQuery('#add_new_trait_method_step').click(function(){
        var add_new_trait_selected_method_val = jQuery('#add_new_trait_existing_method_select').val();
        if (add_new_trait_selected_method_val == '0') {
            add_new_trait_selected_method_val = '';
        }
        if (add_new_trait_selected_method_val == '' && jQuery('#add_new_trait_method_name').val() == '') {
            alert('Please select an existing method or give a new method name!');
            return false;
        }
        if (add_new_trait_selected_method_val != '' && jQuery('#add_new_trait_method_name').val() != '') {
            alert('Please select an existing method or give a new method name, and not both!');
            return false;
        }
        var selected = [];
        jQuery('input[name="add_new_trait_method_ontology_select"]:checked').each(function(){
            selected.push(jQuery(this).val());
        });
        if (selected.length < 1) {
            alert('Please select one method ontology!');
        } else if (selected.length > 1) {
            alert('Only select one method ontology!');
        } else {
            if (add_new_trait_selected_method_val == '') {
                if (jQuery('#add_new_trait_method_name').val() == ''){
                    alert('Please give a new method name!');
                }
                else if (jQuery('#add_new_trait_method_definition').val() == ''){
                    alert('Please give a new method definition!');
                }
                else {
                    add_new_trait_new_method_name = jQuery('#add_new_trait_method_name').val();
                    add_new_trait_new_method_definition = jQuery('#add_new_trait_method_definition').val();
                    Workflow.complete('#add_new_trait_method_step');
                    Workflow.focus('#add_new_trait_workflow', 4);
                }
            } else {
                add_new_trait_selected_method_cvterm_id = add_new_trait_selected_method_val;
                Workflow.complete('#add_new_trait_method_step');
                Workflow.focus('#add_new_trait_workflow', 4);
            }
        }
        return false;
    });

    var add_new_trait_selected_scale_cvterm_id;
    var add_new_trait_new_scale_name;
    var add_new_trait_new_scale_definition;
    var add_new_trait_new_scale_format;
    var add_new_trait_new_scale_minimum;
    var add_new_trait_new_scale_maximum;
    var add_new_trait_new_scale_default;
    var add_new_trait_new_scale_categories;
    jQuery('#add_new_trait_scale_step').click(function(){
        var add_new_trait_selected_scale_val = jQuery('#add_new_trait_existing_scale_select').val();
        if (add_new_trait_selected_scale_val == '0') {
            add_new_trait_selected_scale_val = '';
        }
        if (add_new_trait_selected_scale_val == '' && jQuery('#add_new_trait_scale_name').val() == '') {
            alert('Please select an existing scale or give a new scale name!');
            return false;
        }
        if (add_new_trait_selected_scale_val != '' && jQuery('#add_new_trait_scale_name').val() != '') {
            alert('Please select an existing scale or give a new scale name, and not both!');
            return false;
        }
        var selected = [];
        jQuery('input[name="add_new_trait_scale_ontology_select"]:checked').each(function(){
            selected.push(jQuery(this).val());
        });
        if (selected.length < 1) {
            alert('Please select one scale ontology!');
        } else if (selected.length > 1) {
            alert('Only select one scale ontology!');
        } else {
            if (add_new_trait_selected_scale_val == '') {
                if (jQuery('#add_new_trait_scale_name').val() == ''){
                    alert('Please give a new scale name!');
                }
                else if (jQuery('#add_new_trait_scale_definition').val() == ''){
                    alert('Please give a new scale definition!');
                }
                else if (jQuery('#add_new_trait_scale_format').val() == ''){
                    alert('Please give a new scale format!');
                }
                else if (jQuery('#add_new_trait_scale_minimum').val() == ''){
                    alert('Please give a new scale minimum!');
                }
                else if (jQuery('#add_new_trait_scale_maximum').val() == ''){
                    alert('Please give a new scale maximum!');
                }
                else {
                    add_new_trait_new_scale_name = jQuery('#add_new_trait_scale_name').val();
                    add_new_trait_new_scale_definition = jQuery('#add_new_trait_scale_definition').val();
                    add_new_trait_new_scale_format = jQuery('#add_new_trait_scale_format').val();
                    add_new_trait_new_scale_minimum = jQuery('#add_new_trait_scale_minimum').val();
                    add_new_trait_new_scale_maximum = jQuery('#add_new_trait_scale_maximum').val();
                    add_new_trait_new_scale_default = jQuery('#add_new_trait_scale_default').val();
                    add_new_trait_new_scale_categories = jQuery('#add_new_trait_scale_categories').val();
                    Workflow.complete('#add_new_trait_scale_step');
                    Workflow.focus('#add_new_trait_workflow', 5);
                }
            } else {
                add_new_trait_selected_scale_cvterm_id = add_new_trait_selected_scale_val;
                Workflow.complete('#add_new_trait_scale_step');
                Workflow.focus('#add_new_trait_workflow', 5);
            }
        }
        return false;
    });

    jQuery('#add_new_trait_submit_button').click(function(){
        jQuery.ajax ({
            url: '/ajax/onto/store_trait_method_scale_observation_variable',
            type: 'POST',
            data: {
                'selected_observation_variable_db_id':add_new_trait_new_observation_variable_db_id,
                'new_observation_variable_name':add_new_trait_new_observation_variable_name,
                'new_observation_variable_definition':add_new_trait_new_observation_variable_definition,
                'selected_trait_db_id':add_new_trait_new_trait_db_id,
                'selected_trait_cvterm_id':add_new_trait_selected_trait_cvterm_id,
                'new_trait_name':add_new_trait_new_trait_name,
                'new_trait_definition':add_new_trait_new_trait_definition,
                'selected_method_db_id':add_new_trait_new_method_db_id,
                'selected_method_cvterm_id':add_new_trait_selected_method_cvterm_id,
                'new_method_name':add_new_trait_new_method_name,
                'new_method_definition':add_new_trait_new_method_definition,
                'selected_scale_db_id':add_new_trait_new_scale_db_id,
                'selected_scale_cvterm_id':add_new_trait_selected_scale_cvterm_id,
                'new_scale_name':add_new_trait_new_scale_name,
                'new_scale_definition':add_new_trait_new_scale_definition,
                'new_scale_format':add_new_trait_new_scale_format,
                'new_scale_minimum':add_new_trait_new_scale_minimum,
                'new_scale_maximum':add_new_trait_new_scale_maximum,
                'new_scale_default':add_new_trait_new_scale_default,
                'new_scale_categories':add_new_trait_new_scale_categories,
            },
            beforeSend: function() {
                jQuery("#working_modal").modal("show");
            },
            success: function(response){
                console.log(response);
                jQuery("#working_modal").modal("hide");
                //if (response.message){
                //    jQuery('#add_new_trait_added_observation_variable_div').html(response.message);
                //    Workflow.complete('#add_new_trait_submit_button');
                //    Workflow.focus("#add_new_trait_workflow", -1); //go to success page
                //}
                if (response.success) {
                    alert(response.success);
                }
                if (response.error) {
                    alert(response.error);
                }
                location.reload();
            },
            error: function(response){
                jQuery("#working_modal").modal("hide");
                alert("Error saving observation variable.");
            }
        });
    });

    jQuery('#add_new_trait_observation_variable_ontology_step').click(function(){
        jQuery.ajax ({
            url: '/ajax/onto/store_ontology_identifier',
            type: 'POST',
            data: {
                'ontology_name':jQuery('#add_new_observation_variable_ontology_name').val(),
                'ontology_description':jQuery('#add_new_observation_variable_ontology_definition').val(),
                'ontology_identifier':jQuery('#add_new_observation_variable_ontology_db_name').val(),
                'ontology_type':jQuery('#add_new_observation_variable_ontology_type').val()
            },
            beforeSend: function() {
                jQuery("#working_modal").modal("show");
            },
            success: function(response){
                console.log(response);
                jQuery("#working_modal").modal("hide");
                //if (response.message){
                //    Workflow.complete('#add_new_trait_observation_variable_ontology_step');
                //    Workflow.focus("#add_new_ontology_workflow", -1); //go to success page
                //}
                if (response.success) {
                    alert(response.success);
                }
                if (response.error) {
                    alert(response.error);
                }
                location.reload();
            },
            error: function(response){
                jQuery("#working_modal").modal("hide");
                alert("Error saving ontology.");
            }
        });
    });
});
</script>
