
<%args>
$accessions
$preferred_species => ""
$list_id => undef
$editable_stock_props => {}
$editable_stock_props_definitions => {}
</%args>

<& /util/import_javascript.mas, classes => [ 'bootstrap_min.js', 'jquery.iframe-post-form','CXGN.List','CXGN.BreedersToolbox.Accessions', 'CXGN.BreedersToolbox.UploadPedigrees' ] &>

<& /page/page_title.mas, title=>"Manage Accessions" &>

<div class="container-fluid">

<div class="well">
<&| /page/info_section.mas, title=>'Accessions', collapsible=>1, collapsed=>0, subtitle=>'<button class="btn btn-sm btn-primary" style="margin:3px" name="add_accessions_link">Add Accessions Or Upload Accession Info</button> <button class="btn btn-sm btn-primary" style="margin:3px" id="upload_pedigrees_link">Upload Pedigree File</button>' &>

<& /breeders_toolbox/accessions.mas, accessions=>$accessions &>
<& /breeders_toolbox/add_accessions_dialogs.mas, preferred_species=>$preferred_species, editable_stock_props=>$editable_stock_props, editable_stock_props_definitions=>$editable_stock_props_definitions &>
<& /breeders_toolbox/upload_pedigrees_dialogs.mas &>
<& /breeders_toolbox/manage_populations_dialogs.mas &>

<div>
  </br>
  <a href="/search/stocks">Search Accessions</a>
</div>

</&>
</div><!-- closes well -->

<div class="well">
    <&| /page/info_section.mas, title=>"Accessions with Pedigree Information", id=> "accessions_with_pedigree", collapsible=>1, collapsed=>1&>
        <table class="table table-hover table-bordered" id="accessions_with_pedigree_table">
            <thead>
                <tr>
                    <th>Accession Name</th>
                    <th>Female Parent</th>
                    <th>Male Parent</th>
                    <th>Cross Type</th>
                </tr>
            </thead>
        </table>
        <br>
        <br>
        <&| /page/info_section.mas, title => 'Copy accessions to a List', collapsible=>1, collapsed=>1, subtitle=>'<i>Copy the accession names to a new or exisiting list</i>'&>
            <br>
            <div style="text-align:right" id="accessions_with_pedigree_to_list_menu"></div>
            <div id="accession_names_with_pedigree" style="display: none;"></div>
        </&>
    </&>
</div><!-- closes well -->

<div class="well">
<&| /page/info_section.mas, title=>"Populations", id=> "manage_accessions_populations", collapsible=>1, collapsed=>1, subtitle=>'<button class="btn btn-sm btn-primary" style="margin:3px" id="manage_accessions_populations_new">Create Population</button>' &>
<div class="panel-group" id="accordion"></div>
</&>
</div><!-- closes well -->

</div>

<style>
  div.left {
    float: left;
    clear: both;
  }
</style>

<script>
jQuery(document).ready(function (){
%  if ($list_id){
    verify_accession_list(<% $list_id %>);
%  }

    jQuery('#accessions_with_pedigree_onswitch').one("click", function(){
        var result_table = jQuery('#accessions_with_pedigree_table').DataTable({
            'ajax': { 'url': '/ajax/stock/accessions_with_pedigree' },
            "fnInitComplete": function(oSettings, json) {
                if (!isLoggedIn()) {
                    jQuery('#accessions_with_pedigree_to_list_menu').html("<div class='well well-sm'><h3>Please login to use lists!</h3></div>");
                } else {
                    var html = "";
                    for(var i=0; i<json.data.length; i++){
                        html += json.data[i][4]+"\n";
                    }
                    jQuery("#accession_names_with_pedigree").html(html);
                    addToListMenu("accessions_with_pedigree_to_list_menu", "accession_names_with_pedigree", {
                        selectText: true,
                        listType:'accessions'
                    });
                }
            }
        });
    });

});
</script>
